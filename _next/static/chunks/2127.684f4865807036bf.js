(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2127],{50265:function(e,t,r){"use strict";e=r.nmd(e);let i=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,a=(e=0)=>(t,r,i)=>`\u001B[${38+e};2;${t};${r};${i}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[r,i]of(t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright,Object.entries(t))){for(let[r,a]of Object.entries(i))t[r]={open:`\u001B[${a[0]}m`,close:`\u001B[${a[1]}m`},i[r]=t[r],e.set(a[0],a[1]);Object.defineProperty(t,r,{value:i,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",t.color.ansi256=i(),t.color.ansi16m=a(),t.bgColor.ansi256=i(10),t.bgColor.ansi16m=a(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{let t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map(e=>e+e).join(""));let i=Number.parseInt(r,16);return[i>>16&255,i>>8&255,255&i]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},92261:function(e,t,r){"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i=r(67294),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=i.useState,s=i.useEffect,o=i.useLayoutEffect,l=i.useDebugValue;function u(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!a(e,r)}catch(e){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),i=n({inst:{value:r,getSnapshot:t}}),a=i[0].inst,c=i[1];return o(function(){a.value=r,a.getSnapshot=t,u(a)&&c({inst:a})},[e,r,t]),s(function(){return u(a)&&c({inst:a}),e(function(){u(a)&&c({inst:a})})},[e]),l(r),r};t.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:c},89234:function(e,t,r){"use strict";e.exports=r(92261)},79742:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],i=t[1];return(r+i)*3/4-i},t.toByteArray=function(e){var t,r,n=l(e),s=n[0],o=n[1],u=new a((s+o)*3/4-o),c=0,d=o>0?s-4:s;for(r=0;r<d;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===o&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,u[c++]=255&t),1===o&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,i=e.length,a=i%3,n=[],s=0,o=i-a;s<o;s+=16383)n.push(function(e,t,i){for(var a,n=[],s=t;s<i;s+=3)n.push(r[(a=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return n.join("")}(e,s,s+16383>o?o:s+16383));return 1===a?n.push(r[(t=e[i-1])>>2]+r[t<<4&63]+"=="):2===a&&n.push(r[(t=(e[i-2]<<8)+e[i-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),n.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,o=n.length;s<o;++s)r[s]=n[s],i[n.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var i=r===t?0:4-r%4;return[r,i]}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},23204:function(e){"use strict";let t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,i=/^[\p{Lu}](?![\p{Lu}])/gu,a=/([\p{Alpha}\p{N}_]|$)/u,n=/[_.\- ]+/,s=RegExp("^"+n.source),o=RegExp(n.source+a.source,"gu"),l=RegExp("\\d+"+a.source,"gu"),u=(e,i,a)=>{let n=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){let u=e[l];n&&t.test(u)?(e=e.slice(0,l)+"-"+e.slice(l),n=!1,o=s,s=!0,l++):s&&o&&r.test(u)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,n=!0):(n=i(u)===u&&a(u)!==u,o=s,s=a(u)===u&&i(u)!==u)}return e},c=(e,t)=>(i.lastIndex=0,e.replace(i,e=>t(e))),d=(e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,(e,r)=>t(r)).replace(l,e=>t(e))),h=(e,t)=>{if(!("string"==typeof e||Array.isArray(e)))throw TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,...t},0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim()).length)return"";let r=!1===t.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(t.locale),i=!1===t.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(t.locale);return 1===e.length?t.pascalCase?i(e):r(e):(e!==r(e)&&(e=u(e,r,i)),e=e.replace(s,""),e=t.preserveConsecutiveUppercase?c(e,r):r(e),t.pascalCase&&(e=i(e.charAt(0))+e.slice(1)),d(e,i))};e.exports=h,e.exports.default=h},2466:function(e){"use strict";e.exports=function(e,t){if("string"!=typeof e)throw TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},26729:function(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function i(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function n(e,t,i,n,s){if("function"!=typeof i)throw TypeError("The listener must be a function");var o=new a(i,n||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1)),o.prototype.eventNames=function(){var e,i,a=[];if(0===this._eventsCount)return a;for(i in e=this._events)t.call(e,i)&&a.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(e)):a},o.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var a=0,n=i.length,s=Array(n);a<n;a++)s[a]=i[a].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},o.prototype.emit=function(e,t,i,a,n,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,a),!0;case 5:return c.fn.call(c.context,t,i,a,n),!0;case 6:return c.fn.call(c.context,t,i,a,n,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,i);break;case 4:c[u].fn.call(c[u].context,t,i,a);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,r){return n(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return n(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,i,a){var n=r?r+e:e;if(!this._events[n])return this;if(!t)return s(this,n),this;var o=this._events[n];if(o.fn)o.fn!==t||a&&!o.once||i&&o.context!==i||s(this,n);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||a&&!o[l].once||i&&o[l].context!==i)&&u.push(o[l]);u.length?this._events[n]=1===u.length?u[0]:u:s(this,n)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o},27345:function(e){"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},45860:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=r(26729),a=r(58147),n=r(66506),s=()=>{},o=new a.TimeoutError;class l extends i{constructor(e){var t,r,i,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:n.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(a=null===(i=e.interval)||void 0===i?void 0:i.toString())&&void 0!==a?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,i)=>{let n=async()=>{this._pendingCount++,this._intervalCount++;try{let n=void 0===this._timeout&&void 0===t.timeout?e():a.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&i(o)});r(await n)}catch(e){i(e)}this._next()};this._queue.enqueue(n,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}t.default=l},87489:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let i=0,a=e.length;for(;a>0;){let n=a/2|0,s=i+n;0>=r(e[s],t)?(i=++s,a-=n+1):a=n}return i}},66506:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let i=r(87489);class a{constructor(){this._queue=[]}enqueue(e,t){let r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let a=i.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(a,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}t.default=a},42693:function(e,t,r){"use strict";let i=r(99353),a=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class n extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let s=(e,t,r)=>{let i=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=i,e},o=e=>a.includes(e),l=(e,t)=>new Promise((r,a)=>{t={onFailedAttempt:()=>{},retries:10,...t};let l=i.operation(t);l.attempt(async i=>{try{r(await e(i))}catch(e){if(!(e instanceof Error)){a(TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));return}if(e instanceof n)l.stop(),a(e.originalError);else if(e instanceof TypeError&&!o(e.message))l.stop(),a(e);else{s(e,i,t);try{await t.onFailedAttempt(e)}catch(e){a(e);return}l.retry(e)||a(l.mainError())}}})});e.exports=l,e.exports.default=l,e.exports.AbortError=n},58147:function(e,t,r){"use strict";let i=r(27345);class a extends Error{constructor(e){super(e),this.name="TimeoutError"}}let n=(e,t,r)=>new Promise((n,s)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0){n(e);return}let o=setTimeout(()=>{if("function"==typeof r){try{n(r())}catch(e){s(e)}return}let i="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,o=r instanceof Error?r:new a(i);"function"==typeof e.cancel&&e.cancel(),s(o)},t);i(e.then(n,s),()=>{clearTimeout(o)})});e.exports=n,e.exports.default=n,e.exports.TimeoutError=a},99353:function(e,t,r){e.exports=r(71846)},71846:function(e,t,r){var i=r(41960);t.operation=function(e){return new i(t.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<t.retries;a++)i.push(this.createTimeout(a,t));return e&&e.forever&&!i.length&&i.push(this.createTimeout(a,t)),i.sort(function(e,t){return e-t}),i},t.createTimeout=function(e,t){return Math.min(Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e)),t.maxTimeout)},t.wrap=function(e,r,i){if(r instanceof Array&&(i=r,r=null),!i)for(var a in i=[],e)"function"==typeof e[a]&&i.push(a);for(var n=0;n<i.length;n++){var s=i[n],o=e[s];e[s]=(function(i){var a=t.operation(r),n=Array.prototype.slice.call(arguments,1),s=n.pop();n.push(function(e){a.retry(e)||(e&&(arguments[0]=a.mainError()),s.apply(this,arguments))}),a.attempt(function(){i.apply(e,n)})}).bind(e,o),e[s].options=r}}},41960:function(e){function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,i=0;i<this._errors.length;i++){var a=this._errors[i],n=a.message,s=(e[n]||0)+1;e[n]=s,s>=r&&(t=a,r=s)}return t}},22257:function(e,t,r){"use strict";let i=Symbol("SemVer ANY");class a{static get ANY(){return i}constructor(e,t){if(t=n(t),e instanceof a){if(!!t.loose===e.loose)return e;e=e.value}u("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===i?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){let t=this.options.loose?s[o.COMPARATORLOOSE]:s[o.COMPARATOR],r=e.match(t);if(!r)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new c(r[2],this.options.loose):this.semver=i}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===i||e===i)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof a))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=n(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}e.exports=a;let n=r(12893),{safeRe:s,t:o}=r(55765),l=r(7539),u=r(74225),c=r(26376),d=r(66902)},66902:function(e,t,r){"use strict";let i=/\s+/g;class a{constructor(e,t){if(t=s(t),e instanceof a){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;return new a(e.raw,t)}if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(i," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let e=this.set[0];if(this.set=this.set.filter(e=>!y(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(let e of this.set)if(1===e.length&&b(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&m)|(this.options.loose&&g))+":"+e,r=n.get(t);if(r)return r;let i=this.options.loose,a=i?c[d.HYPHENRANGELOOSE]:c[d.HYPHENRANGE];l("hyphen replace",e=e.replace(a,R(this.options.includePrerelease))),l("comparator trim",e=e.replace(c[d.COMPARATORTRIM],h)),l("tilde trim",e=e.replace(c[d.TILDETRIM],p)),l("caret trim",e=e.replace(c[d.CARETTRIM],f));let s=e.split(" ").map(e=>v(e,this.options)).join(" ").split(/\s+/).map(e=>$(e,this.options));i&&(s=s.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(c[d.COMPARATORLOOSE])))),l("range list",s);let u=new Map;for(let e of s.map(e=>new o(e,this.options))){if(y(e))return[e];u.set(e.value,e)}u.size>1&&u.has("")&&u.delete("");let b=[...u.values()];return n.set(t,b),b}intersects(e,t){if(!(e instanceof a))throw TypeError("a Range is required");return this.set.some(r=>_(r,t)&&e.set.some(e=>_(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(P(this.set[t],e,this.options))return!0;return!1}}e.exports=a;let n=new(r(99659)),s=r(12893),o=r(22257),l=r(74225),u=r(26376),{safeRe:c,t:d,comparatorTrimReplace:h,tildeTrimReplace:p,caretTrimReplace:f}=r(55765),{FLAG_INCLUDE_PRERELEASE:m,FLAG_LOOSE:g}=r(83295),y=e=>"<0.0.0-0"===e.value,b=e=>""===e.value,_=(e,t)=>{let r=!0,i=e.slice(),a=i.pop();for(;r&&i.length;)r=i.every(e=>a.intersects(e,t)),a=i.pop();return r},v=(e,t)=>(l("comp",e,t),l("caret",e=S(e,t)),l("tildes",e=E(e,t)),l("xrange",e=A(e,t)),l("stars",e=I(e,t)),e),w=e=>!e||"x"===e.toLowerCase()||"*"===e,E=(e,t)=>e.trim().split(/\s+/).map(e=>O(e,t)).join(" "),O=(e,t)=>{let r=t.loose?c[d.TILDELOOSE]:c[d.TILDE];return e.replace(r,(t,r,i,a,n)=>{let s;return l("tilde",e,t,r,i,a,n),w(r)?s="":w(i)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:w(a)?s=`>=${r}.${i}.0 <${r}.${+i+1}.0-0`:n?(l("replaceTilde pr",n),s=`>=${r}.${i}.${a}-${n} <${r}.${+i+1}.0-0`):s=`>=${r}.${i}.${a} <${r}.${+i+1}.0-0`,l("tilde return",s),s})},S=(e,t)=>e.trim().split(/\s+/).map(e=>T(e,t)).join(" "),T=(e,t)=>{l("caret",e,t);let r=t.loose?c[d.CARETLOOSE]:c[d.CARET],i=t.includePrerelease?"-0":"";return e.replace(r,(t,r,a,n,s)=>{let o;return l("caret",e,t,r,a,n,s),w(r)?o="":w(a)?o=`>=${r}.0.0${i} <${+r+1}.0.0-0`:w(n)?o="0"===r?`>=${r}.${a}.0${i} <${r}.${+a+1}.0-0`:`>=${r}.${a}.0${i} <${+r+1}.0.0-0`:s?(l("replaceCaret pr",s),o="0"===r?"0"===a?`>=${r}.${a}.${n}-${s} <${r}.${a}.${+n+1}-0`:`>=${r}.${a}.${n}-${s} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${n}-${s} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===a?`>=${r}.${a}.${n}${i} <${r}.${a}.${+n+1}-0`:`>=${r}.${a}.${n}${i} <${r}.${+a+1}.0-0`:`>=${r}.${a}.${n} <${+r+1}.0.0-0`),l("caret return",o),o})},A=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>x(e,t)).join(" ")),x=(e,t)=>{e=e.trim();let r=t.loose?c[d.XRANGELOOSE]:c[d.XRANGE];return e.replace(r,(r,i,a,n,s,o)=>{l("xRange",e,r,i,a,n,s,o);let u=w(a),c=u||w(n),d=c||w(s);return"="===i&&d&&(i=""),o=t.includePrerelease?"-0":"",u?r=">"===i||"<"===i?"<0.0.0-0":"*":i&&d?(c&&(n=0),s=0,">"===i?(i=">=",c?(a=+a+1,n=0):n=+n+1,s=0):"<="===i&&(i="<",c?a=+a+1:n=+n+1),"<"===i&&(o="-0"),r=`${i+a}.${n}.${s}${o}`):c?r=`>=${a}.0.0${o} <${+a+1}.0.0-0`:d&&(r=`>=${a}.${n}.0${o} <${a}.${+n+1}.0-0`),l("xRange return",r),r})},I=(e,t)=>(l("replaceStars",e,t),e.trim().replace(c[d.STAR],"")),$=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),R=e=>(t,r,i,a,n,s,o,l,u,c,d,h)=>(r=w(i)?"":w(a)?`>=${i}.0.0${e?"-0":""}`:w(n)?`>=${i}.${a}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`,l=w(u)?"":w(c)?`<${+u+1}.0.0-0`:w(d)?`<${u}.${+c+1}.0-0`:h?`<=${u}.${c}.${d}-${h}`:e?`<${u}.${c}.${+d+1}-0`:`<=${l}`,`${r} ${l}`.trim()),P=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){let i=e[r].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0}},26376:function(e,t,r){"use strict";let i=r(74225),{MAX_LENGTH:a,MAX_SAFE_INTEGER:n}=r(83295),{safeRe:s,t:o}=r(55765),l=r(12893),{compareIdentifiers:u}=r(86742);class c{constructor(e,t){if(t=l(t),e instanceof c){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>a)throw TypeError(`version is longer than ${a} characters`);i("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?s[o.LOOSE]:s[o.FULL]);if(!r)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>n||this.major<0)throw TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<n)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(i("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],a=e.prerelease[t];if(i("prerelease compare",t,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return -1;if(r===a)continue;else return u(r,a)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{let r=this.build[t],a=e.build[t];if(i("build compare",t,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return -1;if(r===a)continue;else return u(r,a)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw Error("invalid increment argument: identifier is empty");if(t){let e=`-${t}`.match(this.options.loose?s[o.PRERELEASELOOSE]:s[o.PRERELEASE]);if(!e||e[1]!==t)throw Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=Number(r)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let i=this.prerelease.length;for(;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);if(-1===i){if(t===this.prerelease.join(".")&&!1===r)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let i=[t,e];!1===r&&(i=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=c},13507:function(e,t,r){"use strict";let i=r(33959);e.exports=(e,t)=>{let r=i(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},7539:function(e,t,r){"use strict";let i=r(58718),a=r(81194),n=r(71312),s=r(25903),o=r(21544),l=r(12056);e.exports=(e,t,r,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return i(e,r,u);case"!=":return a(e,r,u);case">":return n(e,r,u);case">=":return s(e,r,u);case"<":return o(e,r,u);case"<=":return l(e,r,u);default:throw TypeError(`Invalid operator: ${t}`)}}},99038:function(e,t,r){"use strict";let i=r(26376),a=r(33959),{safeRe:n,t:s}=r(55765);e.exports=(e,t)=>{if(e instanceof i)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let i;let a=t.includePrerelease?n[s.COERCERTLFULL]:n[s.COERCERTL];for(;(i=a.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&i.index+i[0].length===r.index+r[0].length||(r=i),a.lastIndex=i.index+i[1].length+i[2].length;a.lastIndex=-1}else r=e.match(t.includePrerelease?n[s.COERCEFULL]:n[s.COERCE]);if(null===r)return null;let o=r[2],l=r[3]||"0",u=r[4]||"0",c=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return a(`${o}.${l}.${u}${c}${d}`,t)}},88880:function(e,t,r){"use strict";let i=r(26376);e.exports=(e,t,r)=>{let a=new i(e,r),n=new i(t,r);return a.compare(n)||a.compareBuild(n)}},27880:function(e,t,r){"use strict";let i=r(46269);e.exports=(e,t)=>i(e,t,!0)},46269:function(e,t,r){"use strict";let i=r(26376);e.exports=(e,t,r)=>new i(e,r).compare(new i(t,r))},62378:function(e,t,r){"use strict";let i=r(33959);e.exports=(e,t)=>{let r=i(e,null,!0),a=i(t,null,!0),n=r.compare(a);if(0===n)return null;let s=n>0,o=s?r:a,l=s?a:r,u=!!o.prerelease.length;if(l.prerelease.length&&!u){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}let c=u?"pre":"";return r.major!==a.major?c+"major":r.minor!==a.minor?c+"minor":r.patch!==a.patch?c+"patch":"prerelease"}},58718:function(e,t,r){"use strict";let i=r(46269);e.exports=(e,t,r)=>0===i(e,t,r)},71312:function(e,t,r){"use strict";let i=r(46269);e.exports=(e,t,r)=>i(e,t,r)>0},25903:function(e,t,r){"use strict";let i=r(46269);e.exports=(e,t,r)=>i(e,t,r)>=0},20253:function(e,t,r){"use strict";let i=r(26376);e.exports=(e,t,r,a,n)=>{"string"==typeof r&&(n=a,a=r,r=void 0);try{return new i(e instanceof i?e.version:e,r).inc(t,a,n).version}catch(e){return null}}},21544:function(e,t,r){"use strict";let i=r(46269);e.exports=(e,t,r)=>0>i(e,t,r)},12056:function(e,t,r){"use strict";let i=r(46269);e.exports=(e,t,r)=>0>=i(e,t,r)},38679:function(e,t,r){"use strict";let i=r(26376);e.exports=(e,t)=>new i(e,t).major},87789:function(e,t,r){"use strict";let i=r(26376);e.exports=(e,t)=>new i(e,t).minor},81194:function(e,t,r){"use strict";let i=r(46269);e.exports=(e,t,r)=>0!==i(e,t,r)},33959:function(e,t,r){"use strict";let i=r(26376);e.exports=(e,t,r=!1)=>{if(e instanceof i)return e;try{return new i(e,t)}catch(e){if(!r)return null;throw e}}},52358:function(e,t,r){"use strict";let i=r(26376);e.exports=(e,t)=>new i(e,t).patch},57559:function(e,t,r){"use strict";let i=r(33959);e.exports=(e,t)=>{let r=i(e,t);return r&&r.prerelease.length?r.prerelease:null}},79795:function(e,t,r){"use strict";let i=r(46269);e.exports=(e,t,r)=>i(t,e,r)},63657:function(e,t,r){"use strict";let i=r(88880);e.exports=(e,t)=>e.sort((e,r)=>i(r,e,t))},45712:function(e,t,r){"use strict";let i=r(66902);e.exports=(e,t,r)=>{try{t=new i(t,r)}catch(e){return!1}return t.test(e)}},21100:function(e,t,r){"use strict";let i=r(88880);e.exports=(e,t)=>e.sort((e,r)=>i(e,r,t))},76397:function(e,t,r){"use strict";let i=r(33959);e.exports=(e,t)=>{let r=i(e,t);return r?r.version:null}},81249:function(e,t,r){"use strict";let i=r(55765),a=r(83295),n=r(26376),s=r(86742),o=r(33959),l=r(76397),u=r(13507),c=r(20253),d=r(62378),h=r(38679),p=r(87789),f=r(52358),m=r(57559),g=r(46269),y=r(79795),b=r(27880),_=r(88880),v=r(21100),w=r(63657),E=r(71312),O=r(21544),S=r(58718),T=r(81194),A=r(25903),x=r(12056),I=r(7539),$=r(99038),R=r(22257),P=r(66902),j=r(45712),N=r(51042),C=r(85775),k=r(71657),L=r(95316),M=r(89042),D=r(6826),U=r(97606),F=r(50032),z=r(82937),B=r(17908),H=r(50799);e.exports={parse:o,valid:l,clean:u,inc:c,diff:d,major:h,minor:p,patch:f,prerelease:m,compare:g,rcompare:y,compareLoose:b,compareBuild:_,sort:v,rsort:w,gt:E,lt:O,eq:S,neq:T,gte:A,lte:x,cmp:I,coerce:$,Comparator:R,Range:P,satisfies:j,toComparators:N,maxSatisfying:C,minSatisfying:k,minVersion:L,validRange:M,outside:D,gtr:U,ltr:F,intersects:z,simplifyRange:B,subset:H,SemVer:n,re:i.re,src:i.src,tokens:i.t,SEMVER_SPEC_VERSION:a.SEMVER_SPEC_VERSION,RELEASE_TYPES:a.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},83295:function(e){"use strict";let t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},74225:function(e,t,r){"use strict";var i=r(83454);let a="object"==typeof i&&i.env&&i.env.NODE_DEBUG&&/\bsemver\b/i.test(i.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=a},86742:function(e){"use strict";let t=/^[0-9]+$/,r=(e,r)=>{let i=t.test(e),a=t.test(r);return i&&a&&(e=+e,r=+r),e===r?0:i&&!a?-1:a&&!i?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},99659:function(e){"use strict";class t{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}e.exports=t},12893:function(e){"use strict";let t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},55765:function(e,t,r){"use strict";let{MAX_SAFE_COMPONENT_LENGTH:i,MAX_SAFE_BUILD_LENGTH:a,MAX_LENGTH:n}=r(83295),s=r(74225),o=(t=e.exports={}).re=[],l=t.safeRe=[],u=t.src=[],c=t.safeSrc=[],d=t.t={},h=0,p="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",n],[p,a]],m=e=>{for(let[t,r]of f)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e},g=(e,t,r)=>{let i=m(t),a=h++;s(e,a,t),d[e]=a,u[a]=t,c[a]=i,o[a]=new RegExp(t,r?"g":void 0),l[a]=new RegExp(i,r?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),g("MAINVERSION",`(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASE",`(?:-(${u[d.PRERELEASEIDENTIFIER]}(?:\\.${u[d.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${u[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[d.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${p}+`),g("BUILD",`(?:\\+(${u[d.BUILDIDENTIFIER]}(?:\\.${u[d.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${u[d.MAINVERSION]}${u[d.PRERELEASE]}?${u[d.BUILD]}?`),g("FULL",`^${u[d.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${u[d.MAINVERSIONLOOSE]}${u[d.PRERELEASELOOSE]}?${u[d.BUILD]}?`),g("LOOSE",`^${u[d.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${u[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${u[d.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:${u[d.PRERELEASE]})?${u[d.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:${u[d.PRERELEASELOOSE]})?${u[d.BUILD]}?)?)?`),g("XRANGE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?`),g("COERCE",`${u[d.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",u[d.COERCEPLAIN]+`(?:${u[d.PRERELEASE]})?`+`(?:${u[d.BUILD]})?`+"(?:$|[^\\d])"),g("COERCERTL",u[d.COERCE],!0),g("COERCERTLFULL",u[d.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${u[d.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",g("TILDE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${u[d.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",g("CARET",`^${u[d.LONECARET]}${u[d.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${u[d.LONECARET]}${u[d.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${u[d.GTLT]}\\s*(${u[d.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]}|${u[d.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${u[d.XRANGEPLAIN]})\\s+-\\s+(${u[d.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${u[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[d.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},97606:function(e,t,r){"use strict";let i=r(6826);e.exports=(e,t,r)=>i(e,t,">",r)},82937:function(e,t,r){"use strict";let i=r(66902);e.exports=(e,t,r)=>(e=new i(e,r),t=new i(t,r),e.intersects(t,r))},50032:function(e,t,r){"use strict";let i=r(6826);e.exports=(e,t,r)=>i(e,t,"<",r)},85775:function(e,t,r){"use strict";let i=r(26376),a=r(66902);e.exports=(e,t,r)=>{let n=null,s=null,o=null;try{o=new a(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!n||-1===s.compare(e))&&(s=new i(n=e,r))}),n}},71657:function(e,t,r){"use strict";let i=r(26376),a=r(66902);e.exports=(e,t,r)=>{let n=null,s=null,o=null;try{o=new a(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!n||1===s.compare(e))&&(s=new i(n=e,r))}),n}},95316:function(e,t,r){"use strict";let i=r(26376),a=r(66902),n=r(71312);e.exports=(e,t)=>{e=new a(e,t);let r=new i("0.0.0");if(e.test(r)||(r=new i("0.0.0-0"),e.test(r)))return r;r=null;for(let t=0;t<e.set.length;++t){let a=e.set[t],s=null;a.forEach(e=>{let t=new i(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!s||n(t,s))&&(s=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),s&&(!r||n(r,s))&&(r=s)}return r&&e.test(r)?r:null}},6826:function(e,t,r){"use strict";let i=r(26376),a=r(22257),{ANY:n}=a,s=r(66902),o=r(45712),l=r(71312),u=r(21544),c=r(12056),d=r(25903);e.exports=(e,t,r,h)=>{let p,f,m,g,y;switch(e=new i(e,h),t=new s(t,h),r){case">":p=l,f=c,m=u,g=">",y=">=";break;case"<":p=u,f=d,m=l,g="<",y="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,h))return!1;for(let r=0;r<t.set.length;++r){let i=t.set[r],s=null,o=null;if(i.forEach(e=>{e.semver===n&&(e=new a(">=0.0.0")),s=s||e,o=o||e,p(e.semver,s.semver,h)?s=e:m(e.semver,o.semver,h)&&(o=e)}),s.operator===g||s.operator===y||(!o.operator||o.operator===g)&&f(e,o.semver)||o.operator===y&&m(e,o.semver))return!1}return!0}},17908:function(e,t,r){"use strict";let i=r(45712),a=r(46269);e.exports=(e,t,r)=>{let n=[],s=null,o=null,l=e.sort((e,t)=>a(e,t,r));for(let e of l)i(e,t,r)?(o=e,s||(s=e)):(o&&n.push([s,o]),o=null,s=null);s&&n.push([s,null]);let u=[];for(let[e,t]of n)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");let c=u.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},50799:function(e,t,r){"use strict";let i=r(66902),a=r(22257),{ANY:n}=a,s=r(45712),o=r(46269),l=[new a(">=0.0.0-0")],u=[new a(">=0.0.0")],c=(e,t,r)=>{let i,a,c,p,f,m,g;if(e===t)return!0;if(1===e.length&&e[0].semver===n){if(1===t.length&&t[0].semver===n)return!0;e=r.includePrerelease?l:u}if(1===t.length&&t[0].semver===n){if(r.includePrerelease)return!0;t=u}let y=new Set;for(let t of e)">"===t.operator||">="===t.operator?i=d(i,t,r):"<"===t.operator||"<="===t.operator?a=h(a,t,r):y.add(t.semver);if(y.size>1||i&&a&&((c=o(i.semver,a.semver,r))>0||0===c&&(">="!==i.operator||"<="!==a.operator)))return null;for(let e of y){if(i&&!s(e,String(i),r)||a&&!s(e,String(a),r))return null;for(let i of t)if(!s(e,String(i),r))return!1;return!0}let b=!!a&&!r.includePrerelease&&!!a.semver.prerelease.length&&a.semver,_=!!i&&!r.includePrerelease&&!!i.semver.prerelease.length&&i.semver;for(let e of(b&&1===b.prerelease.length&&"<"===a.operator&&0===b.prerelease[0]&&(b=!1),t)){if(g=g||">"===e.operator||">="===e.operator,m=m||"<"===e.operator||"<="===e.operator,i){if(_&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===_.major&&e.semver.minor===_.minor&&e.semver.patch===_.patch&&(_=!1),">"===e.operator||">="===e.operator){if((p=d(i,e,r))===e&&p!==i)return!1}else if(">="===i.operator&&!s(i.semver,String(e),r))return!1}if(a){if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),"<"===e.operator||"<="===e.operator){if((f=h(a,e,r))===e&&f!==a)return!1}else if("<="===a.operator&&!s(a.semver,String(e),r))return!1}if(!e.operator&&(a||i)&&0!==c)return!1}return(!i||!m||!!a||0===c)&&(!a||!g||!!i||0===c)&&!_&&!b},d=(e,t,r)=>{if(!e)return t;let i=o(e.semver,t.semver,r);return i>0?e:i<0?t:">"===t.operator&&">="===e.operator?t:e},h=(e,t,r)=>{if(!e)return t;let i=o(e.semver,t.semver,r);return i<0?e:i>0?t:"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new i(e,r),t=new i(t,r);let a=!1;e:for(let i of e.set){for(let e of t.set){let t=c(i,e,r);if(a=a||null!==t,t)continue e}if(a)return!1}return!0}},51042:function(e,t,r){"use strict";let i=r(66902);e.exports=(e,t)=>new i(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},89042:function(e,t,r){"use strict";let i=r(66902);e.exports=(e,t)=>{try{return new i(e,t).range||"*"}catch(e){return null}}},49623:function(e){e.exports=function(e,t){let r;if("function"!=typeof e)throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof e}\`.`);let i=0;return function(...a){clearTimeout(r);let n=Date.now(),s=t-(n-i);s<=0?(i=n,e.apply(this,a)):r=setTimeout(()=>{i=Date.now(),e.apply(this,a)},s)}}},74790:function(e,t,r){"use strict";r.d(t,{RJ:function(){return E}});var i,a,n,s,o,l,u,c,d,h,p=r(67294),f=r(73652),m=r(49623),g=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},y=(e,t,r)=>(g(e,t,"read from private field"),r?r.call(e):t.get(e)),b=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},_=(e,t,r,i)=>(g(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),v=class{constructor(e=[]){b(this,i,void 0),b(this,a,"ready"),b(this,n,void 0),b(this,s,new Set),b(this,o,new Set),b(this,l,new Set),this.pushMessage=e=>{_(this,i,y(this,i).concat(e)),y(this,u).call(this)},this.popMessage=()=>{_(this,i,y(this,i).slice(0,-1)),y(this,u).call(this)},this.replaceMessage=(e,t)=>{_(this,i,[...y(this,i).slice(0,e),this.snapshot(t),...y(this,i).slice(e+1)]),y(this,u).call(this)},this.snapshot=e=>structuredClone(e),this["~registerMessagesCallback"]=(e,t)=>{let r=t&&null!=t?m(e,t):e;return y(this,s).add(r),()=>{y(this,s).delete(r)}},this["~registerStatusCallback"]=e=>(y(this,o).add(e),()=>{y(this,o).delete(e)}),this["~registerErrorCallback"]=e=>(y(this,l).add(e),()=>{y(this,l).delete(e)}),b(this,u,()=>{y(this,s).forEach(e=>e())}),b(this,c,()=>{y(this,o).forEach(e=>e())}),b(this,d,()=>{y(this,l).forEach(e=>e())}),_(this,i,e)}get status(){return y(this,a)}set status(e){_(this,a,e),y(this,c).call(this)}get error(){return y(this,n)}set error(e){_(this,n,e),y(this,d).call(this)}get messages(){return y(this,i)}set messages(e){_(this,i,[...e]),y(this,u).call(this)}};i=new WeakMap,a=new WeakMap,n=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap;var w=class extends f.Pu{constructor({messages:e,...t}){let r=new v(e);super({...t,state:r}),b(this,h,void 0),this["~registerMessagesCallback"]=(e,t)=>y(this,h)["~registerMessagesCallback"](e,t),this["~registerStatusCallback"]=e=>y(this,h)["~registerStatusCallback"](e),this["~registerErrorCallback"]=e=>y(this,h)["~registerErrorCallback"](e),_(this,h,r)}};function E({experimental_throttle:e,resume:t=!1,...r}={}){let i=(0,p.useRef)("chat"in r?r.chat:new w(r));("chat"in r&&r.chat!==i.current||"id"in r&&i.current.id!==r.id)&&(i.current="chat"in r?r.chat:new w(r));let a="id"in r?r.id:null,n=(0,p.useCallback)(t=>i.current["~registerMessagesCallback"](t,e),[e,a]),s=(0,p.useSyncExternalStore)(n,()=>i.current.messages,()=>i.current.messages),o=(0,p.useSyncExternalStore)(i.current["~registerStatusCallback"],()=>i.current.status,()=>i.current.status),l=(0,p.useSyncExternalStore)(i.current["~registerErrorCallback"],()=>i.current.error,()=>i.current.error),u=(0,p.useCallback)(e=>{"function"==typeof e&&(e=e(i.current.messages)),i.current.messages=e},[i]);return(0,p.useEffect)(()=>{t&&i.current.resumeStream()},[t,i]),{id:i.current.id,messages:s,setMessages:u,sendMessage:i.current.sendMessage,regenerate:i.current.regenerate,clearError:i.current.clearError,stop:i.current.stop,error:l,resumeStream:i.current.resumeStream,status:o,addToolResult:i.current.addToolResult}}h=new WeakMap},58447:function(e,t,r){"use strict";let i,a,n,s,o,l,u;r.d(t,{s9:function(){return iB}});var c,d,h,p,f,m,g={};r.r(g),r.d(g,{JsonPatchError:function(){return M},_areEquals:function(){return Z},applyOperation:function(){return B},applyPatch:function(){return H},applyReducer:function(){return G},deepClone:function(){return D},getValueByPointer:function(){return z},validate:function(){return W},validator:function(){return q}});class y{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=void 0!==e.pageContent?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}}for(var b=r(63448),_=r(42693),v={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},w=new Uint8Array(16),E=[],O=0;O<256;++O)E.push((O+256).toString(16).slice(1));function S(e,t=0){return(E[e[t+0]]+E[e[t+1]]+E[e[t+2]]+E[e[t+3]]+"-"+E[e[t+4]]+E[e[t+5]]+"-"+E[e[t+6]]+E[e[t+7]]+"-"+E[e[t+8]]+E[e[t+9]]+"-"+E[e[t+10]]+E[e[t+11]]+E[e[t+12]]+E[e[t+13]]+E[e[t+14]]+E[e[t+15]]).toLowerCase()}var T=function(e,t,r){if(v.randomUUID&&!t&&!e)return v.randomUUID();var i=(e=e||{}).random||(e.rng||function(){if(!f&&!(f="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return f(w)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=i[a];return t}return S(i)};class A{getStore(){}run(e,t){return t()}}let x=Symbol.for("ls:tracing_async_local_storage"),I=new A;class ${getInstance(){return globalThis[x]??I}initializeGlobalInstance(e){void 0===globalThis[x]&&(globalThis[x]=e)}}let R=new $;function P(e){return"function"==typeof e&&"langsmith:traceable"in e}Symbol.for("langsmith:traceable:root");/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */let j=Object.prototype.hasOwnProperty;function N(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function C(e){let t,r=0,i=e.length;for(;r<i;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function k(e,t){let r=[e];for(let e in t){let i="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==i&&r.push(`${e}: ${i}`)}return r.join("\n")}class L extends Error{constructor(e,t,r,i,a){super(k(e,{name:t,index:r,operation:i,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=k(e,{name:t,index:r,operation:i,tree:a})}}let M=L,D=N,U={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var i=e[t];return delete e[t],{newDocument:r,removed:i}},replace:function(e,t,r){var i=e[t];return e[t]=this.value,{newDocument:r,removed:i}},move:function(e,t,r){let i=z(r,this.path);i&&(i=N(i));let a=B(r,{op:"remove",path:this.from}).removed;return B(r,{op:"add",path:this.path,value:a}),{newDocument:r,removed:i}},copy:function(e,t,r){let i=z(r,this.from);return B(r,{op:"add",path:this.path,value:N(i)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:Z(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var F={add:function(e,t,r){return C(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var i=e[t];return e[t]=this.value,{newDocument:r,removed:i}},move:U.move,copy:U.copy,test:U.test,_get:U._get};function z(e,t){if(""==t)return e;var r={op:"_get",path:t};return B(e,r),r.value}function B(e,t,r=!1,i=!0,a=!0,n=0){if(r&&("function"==typeof r?r(t,0,e,t.path):q(t,0)),""===t.path){let i={newDocument:e};if("add"===t.op)return i.newDocument=t.value,i;if("replace"===t.op)return i.newDocument=t.value,i.removed=e,i;if("move"===t.op||"copy"===t.op)return i.newDocument=z(e,t.from),"move"===t.op&&(i.removed=e),i;if("test"===t.op){if(i.test=Z(e,t.value),!1===i.test)throw new M("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument=e,i}else{if("remove"===t.op)return i.removed=e,i.newDocument=null,i;if("_get"===t.op)return t.value=e,i;if(!r)return i;throw new M("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,e)}}{let s,o,l;i||(e=N(e));let u=(t.path||"").split("/"),c=e,d=1,h=u.length;for(o="function"==typeof r?r:q;;){if((s=u[d])&&-1!=s.indexOf("~")&&(s=s.replace(/~1/g,"/").replace(/~0/g,"~")),a&&("__proto__"==s||"prototype"==s&&d>0&&"constructor"==u[d-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===l&&(void 0===c[s]?l=u.slice(0,d).join("/"):d==h-1&&(l=t.path),void 0!==l&&o(t,0,e,l)),d++,Array.isArray(c)){if("-"===s)s=c.length;else{if(r&&!C(s))throw new M("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",n,t,e);C(s)&&(s=~~s)}if(d>=h){if(r&&"add"===t.op&&s>c.length)throw new M("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",n,t,e);let i=F[t.op].call(t,c,s,e);if(!1===i.test)throw new M("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i}}else if(d>=h){let r=U[t.op].call(t,c,s,e);if(!1===r.test)throw new M("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r}if(c=c[s],r&&d<h&&(!c||"object"!=typeof c))throw new M("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",n,t,e)}}}function H(e,t,r,i=!0,a=!0){if(r&&!Array.isArray(t))throw new M("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=N(e));let n=Array(t.length);for(let i=0,s=t.length;i<s;i++)n[i]=B(e,t[i],r,!0,a,i),e=n[i].newDocument;return n.newDocument=e,n}function G(e,t,r){let i=B(e,t);if(!1===i.test)throw new M("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return i.newDocument}function q(e,t,r,i){if("object"!=typeof e||null===e||Array.isArray(e))throw new M("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(U[e.op]){if("string"!=typeof e.path)throw new M("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new M('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new M("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new M("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t){if(Array.isArray(t)){for(let r=0,i=t.length;r<i;r++)if(e(t[r]))return!0}else if("object"==typeof t){let i=function(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)j.call(e,r)&&t.push(r);return t}(t),a=i.length;for(var r=0;r<a;r++)if(e(t[i[r]]))return!0}}return!1}(e.value))throw new M("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var a=e.path.split("/").length,n=i.split("/").length;if(a!==n+1&&a!==n)throw new M("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==i)throw new M("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var s=W([{op:"_get",path:e.from,value:void 0}],r);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new M("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new M("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function W(e,t,r){try{if(!Array.isArray(e))throw new M("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)H(N(t),N(e),r||!0);else{r=r||q;for(var i=0;i<e.length;i++)r(e[i],i,t,void 0)}}catch(e){if(e instanceof M)return e;throw e}}function Z(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,i,a,n=Array.isArray(e),s=Array.isArray(t);if(n&&s){if((i=e.length)!=t.length)return!1;for(r=i;0!=r--;)if(!Z(e[r],t[r]))return!1;return!0}if(n!=s)return!1;var o=Object.keys(e);if((i=o.length)!==Object.keys(t).length)return!1;for(r=i;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=i;0!=r--;)if(!Z(e[a=o[r]],t[a]))return!1;return!0}return e!=e&&t!=t}new WeakMap;var J=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,V=function(e){return"string"==typeof e&&J.test(e)},K=function(e){if(!V(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};function X(e,t){return e<<t|e>>>32-t}var Y=function(e,t,r){function i(e,t,i,a){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof t&&(t=K(t)),(null===(n=t)||void 0===n?void 0:n.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var n,s=new Uint8Array(16+e.length);if(s.set(t),s.set(e,t.length),(s=r(s))[6]=15&s[6]|80,s[8]=63&s[8]|128,i){a=a||0;for(var o=0;o<16;++o)i[a+o]=s[o];return i}return S(s)}try{i.name="v5"}catch(e){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i}(0,0,function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var i=unescape(encodeURIComponent(e));e=[];for(var a=0;a<i.length;++a)e.push(i.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var n=Math.ceil((e.length/4+2)/16),s=Array(n),o=0;o<n;++o){for(var l=new Uint32Array(16),u=0;u<16;++u)l[u]=e[64*o+4*u]<<24|e[64*o+4*u+1]<<16|e[64*o+4*u+2]<<8|e[64*o+4*u+3];s[o]=l}s[n-1][14]=(e.length-1)*8/4294967296,s[n-1][14]=Math.floor(s[n-1][14]),s[n-1][15]=(e.length-1)*8&4294967295;for(var c=0;c<n;++c){for(var d=new Uint32Array(80),h=0;h<16;++h)d[h]=s[c][h];for(var p=16;p<80;++p)d[p]=X(d[p-3]^d[p-8]^d[p-14]^d[p-16],1);for(var f=r[0],m=r[1],g=r[2],y=r[3],b=r[4],_=0;_<80;++_){var v=Math.floor(_/20),w=X(f,5)+function(e,t,r,i){switch(e){case 0:return t&r^~t&i;case 1:case 3:return t^r^i;case 2:return t&r^t&i^r&i}}(v,m,g,y)+b+t[v]+d[_]>>>0;b=y,y=g,g=X(m,30)>>>0,m=f,f=w}r[0]=r[0]+f>>>0,r[1]=r[1]+m>>>0,r[2]=r[2]+g>>>0,r[3]=r[3]+y>>>0,r[4]=r[4]+b>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]});let Q="gen_ai.request.model",ee="gen_ai.usage.input_tokens",et="gen_ai.usage.output_tokens",er="gen_ai.usage.total_tokens",ei="langsmith.span.tags",ea=(...e)=>fetch(...e),en=Symbol.for("ls:fetch_implementation"),es=()=>{let e=globalThis[en];return!!e&&"function"==typeof e&&"Headers"in e&&"Request"in e&&"Response"in e},eo=e=>async(...t)=>{if(e||"true"===e_("DEBUG")){let[e,r]=t;console.log(` ${r?.method||"GET"} ${e}`)}let r=await (globalThis[en]??ea)(...t);return(e||"true"===e_("DEBUG"))&&console.log(` ${r.status} ${r.statusText} ${r.url}`),r},el=()=>e_("PROJECT")??eb("LANGCHAIN_SESSION")??"default",eu="0.3.67";var ec=r(83454);let ed=()=>"undefined"!=typeof window&&void 0!==window.document,eh=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,ep=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom"),ef=()=>"undefined"!=typeof Deno,em=()=>void 0!==ec&&void 0!==ec.versions&&void 0!==ec.versions.node&&!ef(),eg=()=>i||(i="undefined"!=typeof Bun?"bun":ed()?"browser":em()?"node":eh()?"webworker":ep()?"jsdom":ef()?"deno":"other");function ey(){return void 0===a&&(a={library:"langsmith",runtime:eg(),sdk:"langsmith-js",sdk_version:eu,...function(){if(void 0!==n)return n;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=eb(t);void 0!==r&&(e[t]=r)}return n=e,e}()}),a}function eb(e){try{return void 0!==ec?ec.env?.[e]:void 0}catch(e){return}}function e_(e){return eb(`LANGSMITH_${e}`)||eb(`LANGCHAIN_${e}`)}function ev(){return"true"===eb("OTEL_ENABLED")||"true"===e_("OTEL_ENABLED")}class ew{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){let r;if(!this.hasWarned&&ev()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0),1===t.length&&"function"==typeof t[0]?r=t[0]:2===t.length&&"function"==typeof t[1]?r=t[1]:3===t.length&&"function"==typeof t[2]&&(r=t[2]),"function"==typeof r)return r()}}class eE{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new ew})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}}class eO{active(){return{}}with(e,t){return t()}}let eS=Symbol.for("ls:otel_trace"),eT=Symbol.for("ls:otel_context"),eA=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),ex=new eE,eI=new eO;class e${getTraceInstance(){return globalThis[eS]??ex}getContextInstance(){return globalThis[eT]??eI}initializeGlobalInstances(e){void 0===globalThis[eS]&&(globalThis[eS]=e.trace),void 0===globalThis[eT]&&(globalThis[eT]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[eA]=e}getDefaultOTLPTracerComponents(){return globalThis[eA]??void 0}}let eR=new e$;function eP(){return eR.getTraceInstance()}let ej={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};class eN{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let r of e)try{if(!r.run)continue;if("post"===r.operation){let e=this.createSpanForRun(r,r.run,t.get(r.id));e&&!r.run.end_time&&this.spans.set(r.id,e)}else this.updateSpanForRun(r,r.run)}catch(e){console.error(`Error processing operation ${r.id}:`,e)}}createSpanForRun(e,t,r){let i=r&&eP().getSpan(r);if(i)try{return this.finishSpanSetup(i,t,e)}catch(t){console.error(`Failed to create span for run ${e.id}:`,t);return}}finishSpanSetup(e,t,r){return this.setSpanAttributes(e,t,r),t.error?(e.setStatus({code:2}),e.recordException(Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let r=this.spans.get(e.id);if(!r){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(r,t,e),t.error?(r.setStatus({code:2}),r.recordException(Error(t.error))):r.setStatus({code:1});let i=t.end_time;i&&(r.end(new Date(i)),this.spans.delete(e.id))}catch(t){console.error(`Failed to update span for run ${e.id}:`,t)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let e=t.invocation_params;if(e.model)return e.model;if(e.model_name)return e.model_name}}}setSpanAttributes(e,t,r){if("run_type"in t&&t.run_type){var i;e.setAttribute("langsmith.span.kind",t.run_type);let r=ej[i=t.run_type||"chain"]||i;e.setAttribute("gen_ai.operation.name",r)}"name"in t&&t.name&&e.setAttribute("langsmith.trace.name",t.name),"session_id"in t&&t.session_id&&e.setAttribute("langsmith.trace.session_id",t.session_id),"session_name"in t&&t.session_name&&e.setAttribute("langsmith.trace.session_name",t.session_name),this.setGenAiSystem(e,t);let a=this.extractModelName(t);for(let[r,i]of(a&&e.setAttribute(Q,a),"prompt_tokens"in t&&"number"==typeof t.prompt_tokens&&e.setAttribute(ee,t.prompt_tokens),"completion_tokens"in t&&"number"==typeof t.completion_tokens&&e.setAttribute(et,t.completion_tokens),"total_tokens"in t&&"number"==typeof t.total_tokens&&e.setAttribute(er,t.total_tokens),this.setInvocationParameters(e,t),Object.entries(t.extra?.metadata||{})))null!=i&&e.setAttribute(`langsmith.metadata.${r}`,String(i));let n=t.tags;if(n&&Array.isArray(n)?e.setAttribute(ei,n.join(", ")):n&&e.setAttribute(ei,String(n)),"serialized"in t&&"object"==typeof t.serialized){let r=t.serialized;r.name&&e.setAttribute("gen_ai.serialized.name",String(r.name)),r.signature&&e.setAttribute("gen_ai.serialized.signature",String(r.signature)),r.doc&&e.setAttribute("gen_ai.serialized.doc",String(r.doc))}this.setIOAttributes(e,r)}setGenAiSystem(e,t){let r="langchain",i=this.extractModelName(t);if(i){let e=i.toLowerCase();e.includes("anthropic")||e.startsWith("claude")?r="anthropic":e.includes("bedrock")?r="aws.bedrock":e.includes("azure")&&e.includes("openai")?r="az.ai.openai":e.includes("azure")&&e.includes("inference")?r="az.ai.inference":e.includes("cohere")?r="cohere":e.includes("deepseek")?r="deepseek":e.includes("gemini")?r="gemini":e.includes("groq")?r="groq":e.includes("watson")||e.includes("ibm")?r="ibm.watsonx.ai":e.includes("mistral")?r="mistral_ai":e.includes("gpt")||e.includes("openai")?r="openai":e.includes("perplexity")||e.includes("sonar")?r="perplexity":e.includes("vertex")?r="vertex_ai":(e.includes("xai")||e.includes("grok"))&&(r="xai")}e.setAttribute("gen_ai.system",r)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let r=t.extra.metadata.invocation_params;void 0!==r.max_tokens&&e.setAttribute("gen_ai.request.max_tokens",r.max_tokens),void 0!==r.temperature&&e.setAttribute("gen_ai.request.temperature",r.temperature),void 0!==r.top_p&&e.setAttribute("gen_ai.request.top_p",r.top_p),void 0!==r.frequency_penalty&&e.setAttribute("gen_ai.request.frequency_penalty",r.frequency_penalty),void 0!==r.presence_penalty&&e.setAttribute("gen_ai.request.presence_penalty",r.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let r=t.run.inputs;"object"==typeof r&&null!==r&&(r.model&&Array.isArray(r.messages)&&e.setAttribute(Q,r.model),void 0!==r.stream&&e.setAttribute("langsmith.request.streaming",r.stream),r.extra_headers&&e.setAttribute("langsmith.request.headers",JSON.stringify(r.extra_headers)),r.extra_query&&e.setAttribute("gen_ai.request.extra_query",JSON.stringify(r.extra_query)),r.extra_body&&e.setAttribute("gen_ai.request.extra_body",JSON.stringify(r.extra_body))),e.setAttribute("gen_ai.prompt",JSON.stringify(r))}catch(e){console.debug(`Failed to process inputs for run ${t.id}`,e)}if(t.run.outputs)try{let r=t.run.outputs,i=this.getUnifiedRunTokens(r);if(i&&(e.setAttribute(ee,i[0]),e.setAttribute(et,i[1]),e.setAttribute(er,i[0]+i[1])),r&&"object"==typeof r){if(r.model&&e.setAttribute("gen_ai.response.model",String(r.model)),r.id&&e.setAttribute("gen_ai.response.id",r.id),r.choices&&Array.isArray(r.choices)){let t=r.choices.map(e=>e.finish_reason).filter(e=>e).map(String);t.length>0&&e.setAttribute("gen_ai.response.finish_reasons",t.join(", "))}if(r.service_tier&&e.setAttribute("gen_ai.response.service_tier",r.service_tier),r.system_fingerprint&&e.setAttribute("gen_ai.response.system_fingerprint",r.system_fingerprint),r.usage_metadata&&"object"==typeof r.usage_metadata){let t=r.usage_metadata;t.input_token_details&&e.setAttribute("gen_ai.usage.input_token_details",JSON.stringify(t.input_token_details)),t.output_token_details&&e.setAttribute("gen_ai.usage.output_token_details",JSON.stringify(t.output_token_details))}}e.setAttribute("gen_ai.completion",JSON.stringify(r))}catch(e){console.debug(`Failed to process outputs for run ${t.id}`,e)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;for(let r of Object.keys(e)){let i=e[r];if(i&&"object"==typeof i&&((t=this.extractUnifiedRunTokens(i.usage_metadata))||1===i.lc&&i.kwargs&&"object"==typeof i.kwargs&&(t=this.extractUnifiedRunTokens(i.kwargs.usage_metadata))))return t}let r=e.generations||[];if(!Array.isArray(r))return null;for(let e of Array.isArray(r[0])?r.flat():r)if("object"==typeof e&&e.message&&"object"==typeof e.message&&e.message.kwargs&&"object"==typeof e.message.kwargs&&(t=this.extractUnifiedRunTokens(e.message.kwargs.usage_metadata)))return t;return null}extractUnifiedRunTokens(e){return e&&"object"==typeof e&&"number"==typeof e.input_tokens&&"number"==typeof e.output_tokens?[e.input_tokens,e.output_tokens]:null}}var eC=r(45860);let ek=[429,500,502,503,504];class eL{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.queue=new eC.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>_(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response;if(r&&await r(t))return;let i=t?.status??e?.status;if(i&&!ek.includes(+i))throw e},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}}function eM(e){return"function"==typeof e?._getType}function eD(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}let eU=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function eF(e,t){if(!eU.test(e))throw Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`);return e}let ez={};function eB(e){ez[e]||(console.warn(e),ez[e]=!0)}function eH(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw Error(`Invalid identifier format: ${e}`);let[t,r]=e.split(":"),i=r||"latest";if(t.includes("/")){let[r,a]=t.split("/",2);if(!r||!a)throw Error(`Invalid identifier format: ${e}`);return[r,a,i]}if(!t)throw Error(`Invalid identifier format: ${e}`);return["-",t,i]}r(81249);class eG extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function eq(e,t,r){let i;if(e.ok){r&&(i=await e.text());return}if(403===e.status)try{let t=await e.json(),r=t?.error;if("org_scoped_key_requires_workspace"===r)throw Error("This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch(t){throw Error(`${e.status} ${e.statusText}`)}i=await e.text();let a=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Server response: ${i}`;if(409===e.status)throw new eG(a);let n=Error(a);throw n.status=e.status,n}let eW="ERR_CONFLICTING_ENDPOINTS";class eZ extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:eW}),this.name="ConflictingEndpointsError"}}var eJ={result:"[Circular]"},eV=[],eK=[];let eX=new TextEncoder;function eY(e){return eX.encode(e)}function eQ(e){if(e&&"object"==typeof e&&null!==e){if(e instanceof Map)return Object.fromEntries(e);if(e instanceof Set)return Array.from(e);if(e instanceof Date)return e.toISOString();if(e instanceof RegExp)return e.toString();else if(e instanceof Error)return{name:e.name,message:e.message}}else if("bigint"==typeof e)return e.toString();return e}function e0(e,t,r,i,a){try{let t=JSON.stringify(e,function(e,t){if(r){let i=r.call(this,e,t);if(void 0!==i)return i}return eQ(t)},i);return eY(t)}catch(o){let s;if(!o.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${t?`
Context: ${t}`:""}`),eY("[Unserializable]");"true"!==e_("SUPPRESS_CIRCULAR_JSON_WARNINGS")&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${t?`
Context: ${t}`:""}`),void 0===a&&(a={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function e(t,r,i,a,n,s,o){if(s+=1,"object"==typeof t&&null!==t){for(l=0;l<a.length;l++)if(a[l]===t){e1(eJ,t,r,n);return}if(void 0!==o.depthLimit&&s>o.depthLimit||void 0!==o.edgesLimit&&i+1>o.edgesLimit){e1("[...]",t,r,n);return}if(a.push(t),Array.isArray(t))for(l=0;l<t.length;l++)e(t[l],l,l,a,t,s,o);else{var l,u=Object.keys(t=eQ(t));for(l=0;l<u.length;l++){var c=u[l];e(t[c],c,l,a,t,s,o)}}a.pop()}}(e,"",0,[],void 0,0,a);try{var n;s=0===eK.length?JSON.stringify(e,r,i):JSON.stringify(e,(n=r,n=void 0!==n?n:function(e,t){return t},function(e,t){if(eK.length>0)for(var r=0;r<eK.length;r++){var i=eK[r];if(i[1]===e&&i[0]===t){t=i[2],eK.splice(r,1);break}}return n.call(this,e,t)}),i)}catch(e){return eY("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==eV.length;){let e=eV.pop();4===e.length?Object.defineProperty(e[0],e[1],e[3]):e[0][e[1]]=e[2]}}return eY(s)}}function e1(e,t,r,i){var a=Object.getOwnPropertyDescriptor(i,r);void 0!==a.get?a.configurable?(Object.defineProperty(i,r,{value:e}),eV.push([i,r,t,a])):eK.push([t,r,e]):(i[r]=e,eV.push([i,r,t]))}function e2(e){let t=ey(),r=function(){let e=function(){try{if(void 0!==ec&&ec.env)return Object.entries(ec.env).reduce((e,[t,r])=>(e[t]=String(r),e),{});return}catch(e){return}}()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[i,a]of Object.entries(e))(i.startsWith("LANGCHAIN_")||i.startsWith("LANGSMITH_"))&&"string"==typeof a&&!r.includes(i)&&!i.toLowerCase().includes("key")&&!i.toLowerCase().includes("secret")&&!i.toLowerCase().includes("token")&&("LANGCHAIN_REVISION_ID"===i?t.revision_id=a:t[i]=a);return t}(),i=e.extra??{},a=i.metadata;return e.extra={...i,runtime:{...t,...i?.runtime},metadata:{...r,...r.revision_id||"revision_id"in e&&e.revision_id?{revision_id:("revision_id"in e?e.revision_id:void 0)??r.revision_id}:{},...a}},e}let e9=e=>{let t=e?.toString()??e_("TRACING_SAMPLING_RATE");if(void 0===t)return;let r=parseFloat(t);if(r<0||r>1)throw Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${r}`);return r},e4=e=>{let t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t};async function e5(e){let t=[];for await(let r of e)t.push(r);return t}function e3(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}let e6=async e=>{if(e?.status===429){let t=1e3*parseInt(e.headers.get("retry-after")??"10",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};function e8(e){return"number"==typeof e?Number(e.toFixed(4)):e}class e7{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;let r=new Promise(e=>{t=e}),i=e0(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:r,size:i}),this.sizeBytes+=i,r}pop(e){if(e<1)throw Error("Number of bytes to pop off may not be less than 1.");let t=[],r=0;for(;r+(this.peek()?.size??0)<e&&this.items.length>0;){let e=this.items.shift();e&&(t.push(e),r+=e.size,this.sizeBytes-=e.size)}if(0===t.length&&this.items.length>0){let e=this.items.shift();t.push(e),r+=e.size,this.sizeBytes-=e.size}return[t.map(e=>({action:e.action,item:e.payload,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl})),()=>t.forEach(e=>e.itemPromiseResolve())]}}let te="https://api.smith.langchain.com";class tt{get _fetch(){return this.fetchImplementation||eo(this.debug)}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new e7}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===eb("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:"true"===eb("LANGSMITH_DEBUG")});let t=tt.getDefaultClientConfig();if(this.tracingSampleRate=e9(e.tracingSamplingRate),this.apiUrl=e3(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=e3(e.apiKey??t.apiKey),this.webUrl=e3(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=e3(e.workspaceId??e_("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new eL({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation,this.batchIngestCaller=new eL({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:e6,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,ev()&&(this.langSmithToOTELTranslator=new eN)}static getDefaultClientConfig(){let e=e_("API_KEY");return{apiUrl:e_("ENDPOINT")??te,apiKey:e,webUrl:void 0,hideInputs:"true"===e_("HIDE_INPUTS"),hideOutputs:"true"===e_("HIDE_OUTPUTS")}}getHostUrl(){if(this.webUrl)return this.webUrl;if(e4(this.apiUrl))return this.webUrl="http://localhost:3000",this.webUrl;if(this.apiUrl.endsWith("/api/v1"))return this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl;if(this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api"))return this.webUrl=this.apiUrl.replace("/api",""),this.webUrl;if(this.apiUrl.split(".",1)[0].includes("dev"))return this.webUrl="https://dev.smith.langchain.com",this.webUrl;if(this.apiUrl.split(".",1)[0].includes("eu"))return this.webUrl="https://eu.smith.langchain.com",this.webUrl;if(this.apiUrl.split(".",1)[0].includes("beta"))return this.webUrl="https://beta.smith.langchain.com",this.webUrl;else return this.webUrl="https://smith.langchain.com",this.webUrl}get headers(){let e={"User-Agent":`langsmith-js/${eu}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return"/v1"!==this.apiUrl.slice(-3)&&"/v1/"!==this.apiUrl.slice(-4)?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}async processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=await this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",i=`${this.apiUrl}${e}?${r}`;return await this.caller.call(async()=>{let t=await this._fetch(i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,`Failed to fetch ${e}`),t})}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams,r){let i=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(i)),t.set("limit",String(a));let n=`${this.apiUrl}${e}?${t}`,s=await this.caller.call(async()=>{let t=await this._fetch(n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,`Failed to fetch ${e}`),t}),o=r?r(await s.json()):await s.json();if(0===o.length||(yield o,o.length<a))break;i+=o.length}}async *_getCursorPaginatedList(e,t=null,r="POST",i="runs"){let a=t?{...t}:{};for(;;){let t=JSON.stringify(a),n=await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:t});return await eq(i,`Failed to fetch ${e}`),i}),s=await n.json();if(!s||!s[i])break;yield s[i];let o=s.cursors;if(!o||!o.next)break;a.cursor=o.next}}_shouldSample(){return void 0===this.tracingSampleRate||Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let r of e)this.filteredPostUuids.has(r.trace_id)?r.id===r.trace_id&&this.filteredPostUuids.delete(r.trace_id):t.push(r);return t}{let t=[];for(let r of e){let e=r.trace_id??r.id;this.filteredPostUuids.has(e)||(r.id===e?this._shouldSample()?t.push(r):this.filteredPostUuids.add(e):t.push(r))}return t}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??25165824}async _getDatasetExamplesMultiPartSupport(){let e=await this._ensureServerInfo();return e.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue(e){let t=[];for(;this.autoBatchQueue.items.length>0;){let[r,i]=this.autoBatchQueue.pop(e);if(!r.length){i();break}let a=r.reduce((e,t)=>{let r=t.apiUrl??this.apiUrl,i=t.apiKey??this.apiKey,a=t.apiKey===this.apiKey&&t.apiUrl===this.apiUrl?"default":`${r}|${i}`;return e[a]||(e[a]=[]),e[a].push(t),e},{}),n=[];for(let[e,t]of Object.entries(a)){let r=this._processBatch(t,{apiUrl:"default"===e?void 0:e.split("|")[0],apiKey:"default"===e?void 0:e.split("|")[1]});n.push(r)}let s=Promise.all(n).finally(i);t.push(s)}return Promise.all(t)}async _processBatch(e,t){if(e.length)try{if(void 0!==this.langSmithToOTELTranslator)this._sendBatchToOTELTranslator(e);else{let r={runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)},i=await this._ensureServerInfo();if(i?.batch_ingest_config?.use_multipart_endpoint){let e=i?.instance_flags?.gzip_body_enabled;await this.multipartIngestRuns(r,{...t,useGzip:e})}else await this.batchIngestRuns(r,t)}}catch(e){console.error("Error exporting batch:",e)}}_sendBatchToOTELTranslator(e){if(void 0!==this.langSmithToOTELTranslator){let t=new Map,r=[];for(let i of e)i.item.id&&i.otelContext&&(t.set(i.item.id,i.otelContext),"create"===i.action?r.push({operation:"post",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}):r.push({operation:"patch",id:i.item.id,trace_id:i.item.trace_id??i.item.id,run:i.item}));this.langSmithToOTELTranslator.exportBatch(r,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=e2(e.item);let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){let e=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4),...this.fetchOptions});return await eq(e,"get server info"),e}),t=await e.json();return this.debug&&console.log("\n=== LangSmith Server Configuration ===\n"+JSON.stringify(t,null,2)+"\n"),t}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}_cloneCurrentOTELContext(){let e=eP(),t=eR.getContextInstance();if(void 0!==this.langSmithToOTELTranslator){let r=e.getActiveSpan();if(r)return e.setSpan(t.active(),r)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;let r={...this.headers,"Content-Type":"application/json"},i=e.project_name;delete e.project_name;let a=await this.prepareRunCreateOrUpdateInputs({session_name:i,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==a.trace_id&&void 0!==a.dotted_order){let e=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:a,otelContext:e,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let n=e2(a);t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey),t?.workspaceId!==void 0&&(r["x-tenant-id"]=t.workspaceId);let s=e0(n,`Creating run with id: ${n.id}`);await this.caller.call(async()=>{let e=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await eq(e,"create run",!0),e})}async batchIngestRuns({runCreates:e,runUpdates:t},r){if(void 0===e&&void 0===t)return;let i=await Promise.all(e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]),a=await Promise.all(t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]);if(i.length>0&&a.length>0){let e=i.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of a)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);i=Object.values(e),a=t}let n={post:i,patch:a};if(!n.post.length&&!n.patch.length)return;let s={post:[],patch:[]};for(let e of["post","patch"]){let t=n[e].reverse(),r=t.pop();for(;void 0!==r;)s[e].push(r),r=t.pop()}if(s.post.length>0||s.patch.length>0){let e=s.post.map(e=>e.id).concat(s.patch.map(e=>e.id)).join(",");await this._postBatchIngestRuns(e0(s,`Ingesting runs with ids: ${e}`),r)}}async _postBatchIngestRuns(e,t){let r={...this.headers,"Content-Type":"application/json",Accept:"application/json"};t?.apiKey!==void 0&&(r["x-api-key"]=t.apiKey),await this.batchIngestCaller.call(async()=>{let i=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await eq(i,"batch create run",!0),i})}async multipartIngestRuns({runCreates:e,runUpdates:t},r){if(void 0===e&&void 0===t)return;let i={},a=[];for(let t of e??[]){let e=await this.prepareRunCreateOrUpdateInputs(t);void 0!==e.id&&void 0!==e.attachments&&(i[e.id]=e.attachments),delete e.attachments,a.push(e)}let n=[];for(let e of t??[])n.push(await this.prepareRunCreateOrUpdateInputs(e));if(void 0!==a.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==n.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&n.length>0){let e=a.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of n)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);a=Object.values(e),n=t}if(0===a.length&&0===n.length)return;let s=[],o=[];for(let[e,t]of[["post",a],["patch",n]])for(let r of t){let{inputs:t,outputs:a,events:n,extra:l,error:u,serialized:c,attachments:d,...h}=r,p={inputs:t,outputs:a,events:n,extra:l,error:u,serialized:c},f=e0(h,`Serializing for multipart ingestion of run with id: ${h.id}`);for(let[t,r]of(o.push({name:`${e}.${h.id}`,payload:new Blob([f],{type:`application/json; length=${f.length}`})}),Object.entries(p))){if(void 0===r)continue;let i=e0(r,`Serializing ${t} for multipart ingestion of run with id: ${h.id}`);o.push({name:`${e}.${h.id}.${t}`,payload:new Blob([i],{type:`application/json; length=${i.length}`})})}if(void 0!==h.id){let e=i[h.id];if(e)for(let[t,r]of(delete i[h.id],Object.entries(e))){let e,i;if(Array.isArray(r)?[e,i]=r:(e=r.mimeType,i=r.data),t.includes(".")){console.warn(`Skipping attachment '${t}' for run ${h.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}o.push({name:`attachment.${h.id}.${t}`,payload:new Blob([i],{type:`${e}; length=${i.byteLength}`})})}}s.push(`trace=${h.trace_id},id=${h.id}`)}await this._sendMultipartRequest(o,s.join("; "),r)}async _createNodeFetchBody(e,t){let r=[];for(let i of e)r.push(new Blob([`--${t}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${i.name}"\r
`,`Content-Type: ${i.payload.type}\r
\r
`])),r.push(i.payload),r.push(new Blob(["\r\n"]));r.push(new Blob([`--${t}--\r
`]));let i=new Blob(r);return await i.arrayBuffer()}async _createMultipartStream(e,t){let r=new TextEncoder;return new ReadableStream({async start(i){let a=async e=>{"string"==typeof e?i.enqueue(r.encode(e)):i.enqueue(e)};for(let r of e){await a(`--${t}\r
`),await a(`Content-Disposition: form-data; name="${r.name}"\r
`),await a(`Content-Type: ${r.payload.type}\r
\r
`);let e=r.payload.stream().getReader();try{let t;for(;!(t=await e.read()).done;)i.enqueue(t.value)}finally{e.releaseLock()}await a("\r\n")}await a(`--${t}--\r
`),i.close()}})}async _sendMultipartRequest(e,t,r){let i="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=es(),n=()=>this._createNodeFetchBody(e,i),s=async e=>this.batchIngestCaller.call(async()=>{let t=await e(),a={...this.headers,"Content-Type":`multipart/form-data; boundary=${i}`};r?.apiKey!==void 0&&(a["x-api-key"]=r.apiKey);let n=t;r?.useGzip&&"object"==typeof t&&"pipeThrough"in t&&(n=t.pipeThrough(new CompressionStream("gzip")),a["Content-Encoding"]="gzip");let s=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:a,body:n,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(s,"Failed to send multipart request",!0),s});try{let o;let l=!1;a||this.multipartStreamingDisabled||"bun"===eg()?o=await s(n):(l=!0,o=await s(()=>this._createMultipartStream(e,i))),(!this.multipartStreamingDisabled||l)&&422===o.status&&(r?.apiUrl??this.apiUrl)!==te&&(console.warn(`Streaming multipart upload to ${r?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,o=await s(n))}catch(e){console.warn(`${e.message.trim()}

Context: ${t}`)}}async updateRun(e,t,r){eF(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));let i={...t,id:e};if(!this._filterForSampling([i],!0).length)return;if(this.autoBatchTracing&&void 0!==i.trace_id&&void 0!==i.dotted_order){let e=this._cloneCurrentOTELContext();void 0!==t.end_time&&void 0===i.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?await this.processRunOperation({action:"update",item:i,otelContext:e,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error):this.processRunOperation({action:"update",item:i,otelContext:e,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error);return}let a={...this.headers,"Content-Type":"application/json"};r?.apiKey!==void 0&&(a["x-api-key"]=r.apiKey),r?.workspaceId!==void 0&&(a["x-tenant-id"]=r.workspaceId);let n=e0(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{let t=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await eq(t,"update run",!0),t})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){eF(e);let r=await this._get(`/runs/${e}`);return t&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:e_("PROJECT")||"default"})).id;let i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await e5(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},i={};for(let a of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===a.parent_run_id||void 0===a.parent_run_id)throw Error(`Child run ${a.id} has no parent`);a.dotted_order?.startsWith(e.dotted_order??"")&&a.id!==e.id&&(a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),i[a.id]=a)}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(i[t].child_runs=r[t]);return e}async *listRuns(e){let{projectId:t,projectName:r,parentRunId:i,traceId:a,referenceExampleId:n,startTime:s,executionOrder:o,isRoot:l,runType:u,error:c,id:d,query:h,filter:p,traceFilter:f,treeFilter:m,limit:g,select:y,order:b}=e,_=[];if(t&&(_=Array.isArray(t)?t:[t]),r){let e=Array.isArray(r)?r:[r],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));_.push(...t)}let v={session:_.length?_:null,run_type:u,reference_example:n,query:h,filter:p,trace_filter:f,tree_filter:m,execution_order:o,parent_run:i,start_time:s?s.toISOString():null,error:c,id:d,limit:g,trace:a,select:y||["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l,order:b},w=0;for await(let e of this._getCursorPaginatedList("/runs/query",v))if(g){if(w>=g)break;if(e.length+w>g){let t=e.slice(0,g-w);yield*t;break}w+=e.length,yield*e}else yield*e}async *listGroupRuns(e){let{projectId:t,projectName:r,groupBy:i,filter:a,startTime:n,endTime:s,limit:o,offset:l}=e,u={session_id:t||(await this.readProject({projectName:r})).id,group_by:i,filter:a,start_time:n?n.toISOString():null,end_time:s?s.toISOString():null,limit:Number(o)||100},c=Number(l)||0,d="/runs/group",h=`${this.apiUrl}${d}`;for(;;){let e=JSON.stringify(Object.fromEntries(Object.entries({...u,offset:c}).filter(([e,t])=>void 0!==t))),t=await this.caller.call(async()=>{let t=await this._fetch(h,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await eq(t,`Failed to fetch ${d}`),t}),{groups:r,total:i}=await t.json();if(0===r.length)break;for(let e of r)yield e;if((c+=r.length)>=i)break}}async getRunStats({id:e,trace:t,parentRun:r,runType:i,projectNames:a,projectIds:n,referenceExampleIds:s,startTime:o,endTime:l,error:u,query:c,filter:d,traceFilter:h,treeFilter:p,isRoot:f,dataSourceType:m}){let g=n||[];a&&(g=[...n||[],...await Promise.all(a.map(e=>this.readProject({projectName:e}).then(e=>e.id)))]);let y=JSON.stringify(Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:i,session:g,reference_example:s,start_time:o,end_time:l,error:u,query:c,filter:d,trace_filter:h,tree_filter:p,is_root:f,data_source_type:m}).filter(([e,t])=>void 0!==t))),b=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await eq(e,"get run stats"),e});return await b.json()}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||T()};eF(e);let i=JSON.stringify(r),a=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await eq(t,"share run"),t}),n=await a.json();if(null===n||!("share_token"in n))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${n.share_token}/r`}async unshareRun(e){eF(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,"unshare run",!0),t})}async readRunSharedLink(e){eF(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,"read run shared link"),t}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);eF(e);let i=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,"list shared runs"),t});return await i.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),eF(e);let r=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,"read dataset shared schema"),t}),i=await r.json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};eF(e);let i=JSON.stringify(r),a=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await eq(t,"share dataset"),t}),n=await a.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async unshareDataset(e){eF(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,"unshare dataset",!0),t})}async readSharedDataset(e){eF(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,"read shared dataset"),t});return await t.json()}async listSharedExamples(e,t){let r={};t?.exampleIds&&(r.id=t.exampleIds);let i=new URLSearchParams;Object.entries(r).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>i.append(e,t)):i.append(e,t)});let a=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,"list shared examples"),t}),n=await a.json();if(!a.ok){if("detail"in n)throw Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${Array.isArray(n.detail)?n.detail.join("\n"):"Unspecified error"}`);throw Error(`Failed to list shared examples: ${a.status} ${a.statusText}`)}return n.map(e=>({...e,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:i=!1,projectExtra:a=null,referenceDatasetId:n=null}){let s=`${this.apiUrl}/sessions${i?"?upsert=true":""}`,o=a||{};r&&(o.metadata=r);let l={name:e,extra:o,description:t};null!==n&&(l.reference_dataset_id=n);let u=JSON.stringify(l),c=await this.caller.call(async()=>{let e=await this._fetch(s,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await eq(e,"create project"),e});return await c.json()}async updateProject(e,{name:t=null,description:r=null,metadata:i=null,projectExtra:a=null,endTime:n=null}){let s=`${this.apiUrl}/sessions/${e}`,o=a;i&&(o={...o||{},metadata:i});let l=JSON.stringify({name:t,extra:o,description:r,end_time:n?new Date(n).toISOString():null}),u=await this.caller.call(async()=>{let e=await this._fetch(s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await eq(e,"update project"),e});return await u.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions",i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)eF(e),r+=`/${e}`;else if(void 0!==t)i.append("name",t);else throw Error("Must provide projectName or projectId");let a=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${r}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(e,"has project"),e});try{let e=await a.json();if(!a.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let i,a="/sessions",n=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)eF(e),a+=`/${e}`;else if(void 0!==t)n.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==r&&n.append("include_stats",r.toString());let s=await this._get(a,n);if(Array.isArray(s)){if(0===s.length)throw Error(`Project[id=${e}, name=${t}] not found`);i=s[0]}else i=s;return i}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${r.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:i,referenceDatasetName:a,includeStats:n,datasetVersion:s,referenceFree:o,metadata:l}={}){let u=new URLSearchParams;if(void 0!==e)for(let t of e)u.append("id",t);if(void 0!==t&&u.append("name",t),void 0!==r&&u.append("name_contains",r),void 0!==i)u.append("reference_dataset",i);else if(void 0!==a){let e=await this.readDataset({datasetName:a});u.append("reference_dataset",e.id)}for await(let e of(void 0!==n&&u.append("include_stats",n.toString()),void 0!==s&&u.append("dataset_version",s),void 0!==o&&u.append("reference_free",o.toString()),void 0!==l&&u.append("metadata",JSON.stringify(l)),this._getPaginated("/sessions",u)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");eF(r=void 0===e?(await this.readProject({projectName:t})).id:e),await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(e,`delete session ${r} (${t})`,!0),e})}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:i,description:a,dataType:n,name:s}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(e=>{l.append("input_keys",e)}),i.forEach(e=>{l.append("output_keys",e)}),a&&l.append("description",a),n&&l.append("data_type",n),s&&l.append("name",s);let u=await this.caller.call(async()=>{let e=await this._fetch(o,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await eq(e,"upload CSV"),e});return await u.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:i,outputsSchema:a,metadata:n}={}){let s={name:e,description:t,extra:n?{metadata:n}:void 0};r&&(s.data_type=r),i&&(s.inputs_schema_definition=i),a&&(s.outputs_schema_definition=a);let o=JSON.stringify(s),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await eq(e,"create dataset"),e});return await l.json()}async readDataset({datasetId:e,datasetName:t}){let r,i="/datasets",a=new URLSearchParams({limit:"1"});if(e&&t)throw Error("Must provide either datasetName or datasetId, not both");if(e)eF(e),i+=`/${e}`;else if(t)a.append("name",t);else throw Error("Must provide datasetName or datasetId");let n=await this._get(i,a);if(Array.isArray(n)){if(0===n.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=n[0]}else r=n;return r}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:i}){let a=e;if(void 0===a&&void 0===t)throw Error("Must provide either datasetName or datasetId");if(void 0!==a&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");void 0===a&&(a=(await this.readDataset({datasetName:t})).id);let n=new URLSearchParams({from_version:"string"==typeof r?r:r.toISOString(),to_version:"string"==typeof i?i:i.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,n)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide either datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:i,datasetNameContains:a,metadata:n}={}){let s=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)s.append("id",e);for await(let e of(void 0!==i&&s.append("name",i),void 0!==a&&s.append("name_contains",a),void 0!==n&&s.append("metadata",JSON.stringify(n)),this._getPaginated("/datasets",s)))yield*e}async updateDataset(e){let{datasetId:t,datasetName:r,...i}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:r})).id;eF(a);let n=JSON.stringify(i),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await eq(e,"update dataset"),e});return await s.json()}async updateDatasetTag(e){let{datasetId:t,datasetName:r,asOf:i,tag:a}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let n=t??(await this.readDataset({datasetName:r})).id;eF(n);let s=JSON.stringify({as_of:"string"==typeof i?i:i.toISOString(),tag:a});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${n}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await eq(e,"update dataset tags",!0),e})}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",i=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(i=(await this.readDataset({datasetName:t})).id),void 0!==i)eF(i),r+=`/${i}`;else throw Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(e,`delete ${r}`,!0),e})}async indexDataset({datasetId:e,datasetName:t,tag:r}){let i=e;if(i||t){if(i&&t)throw Error("Must provide either datasetName or datasetId, not both");i||(i=(await this.readDataset({datasetName:t})).id)}else throw Error("Must provide either datasetName or datasetId");eF(i);let a=JSON.stringify({tag:r}),n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await eq(e,"index dataset"),e});await n.json()}async similarExamples(e,t,r,{filter:i}={}){let a={limit:r,inputs:e};void 0!==i&&(a.filter=i),eF(t);let n=JSON.stringify(a),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:n});return await eq(e,"fetch similar examples"),e});return(await s.json()).examples}async createExample(e,t,r){let i;if(tr(e)&&(void 0!==t||void 0!==r))throw Error("Cannot provide outputs or options when using ExampleCreate object");let a=t?r?.datasetId:e.dataset_id,n=t?r?.datasetName:e.dataset_name;if(void 0===a&&void 0===n)throw Error("Must provide either datasetName or datasetId");if(void 0!==a&&void 0!==n)throw Error("Must provide either datasetName or datasetId, not both");void 0===a&&(a=(await this.readDataset({datasetName:n})).id);let s=(t?r?.createdAt:e.created_at)||new Date;i=tr(e)?e:{inputs:e,outputs:t,created_at:s?.toISOString(),id:r?.exampleId,metadata:r?.metadata,split:r?.split,source_run_id:r?.sourceRunId,use_source_run_io:r?.useSourceRunIO,use_source_run_attachments:r?.useSourceRunAttachments,attachments:r?.attachments};let o=await this._uploadExamplesMultipart(a,[i]);return await this.readExample(o.example_ids?.[0]??T())}async createExamples(e){if(Array.isArray(e)){if(0===e.length)return[];let t=e[0].dataset_id,r=e[0].dataset_name;if(void 0===t&&void 0===r)throw Error("Must provide either datasetName or datasetId");if(void 0!==t&&void 0!==r)throw Error("Must provide either datasetName or datasetId, not both");void 0===t&&(t=(await this.readDataset({datasetName:r})).id);let i=await this._uploadExamplesMultipart(t,e);return await Promise.all(i.example_ids.map(e=>this.readExample(e)))}let{inputs:t,outputs:r,metadata:i,splits:a,sourceRunIds:n,useSourceRunIOs:s,useSourceRunAttachments:o,attachments:l,exampleIds:u,datasetId:c,datasetName:d}=e;if(void 0===t)throw Error("Must provide inputs when using legacy parameters");let h=c;if(void 0===h&&void 0===d)throw Error("Must provide either datasetName or datasetId");if(void 0!==h&&void 0!==d)throw Error("Must provide either datasetName or datasetId, not both");void 0===h&&(h=(await this.readDataset({datasetName:d})).id);let p=t.map((e,t)=>({dataset_id:h,inputs:e,outputs:r?.[t],metadata:i?.[t],split:a?.[t],id:u?.[t],attachments:l?.[t],source_run_id:n?.[t],use_source_run_io:s?.[t],use_source_run_attachments:o?.[t]})),f=await this._uploadExamplesMultipart(h,p);return await Promise.all(f.example_ids.map(e=>this.readExample(e)))}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let i=e.map(e=>eM(e)?eD(e):e),a=eM(t)?eD(t):t;return this.createExample({input:i},{output:a},r)}async readExample(e){eF(e);let t=`/examples/${e}`,{attachment_urls:r,...i}=await this._get(t);return r&&(i.attachments=Object.entries(r).reduce((e,[t,r])=>(e[t.slice("attachment.".length)]={presigned_url:r.presigned_url,mime_type:r.mime_type},e),{})),i}async *listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:i,splits:a,inlineS3Urls:n,metadata:s,limit:o,offset:l,filter:u,includeAttachments:c}={}){let d;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)d=e;else if(void 0!==t)d=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let h=new URLSearchParams({dataset:d}),p=i?"string"==typeof i?i:i?.toISOString():void 0;if(p&&h.append("as_of",p),h.append("inline_s3_urls",(n??!0).toString()),void 0!==r)for(let e of r)h.append("id",e);if(void 0!==a)for(let e of a)h.append("splits",e);if(void 0!==s){let e=JSON.stringify(s);h.append("metadata",e)}void 0!==o&&h.append("limit",o.toString()),void 0!==l&&h.append("offset",l.toString()),void 0!==u&&h.append("filter",u),!0===c&&["attachment_urls","outputs","metadata"].forEach(e=>h.append("select",e));let f=0;for await(let e of this._getPaginated("/examples",h)){for(let t of e){let{attachment_urls:e,...r}=t;e&&(r.attachments=Object.entries(e).reduce((e,[t,r])=>(e[t.slice("attachment.".length)]={presigned_url:r.presigned_url,mime_type:r.mime_type||void 0},e),{})),yield r,f++}if(void 0!==o&&f>=o)break}}async deleteExample(e){eF(e);let t=`/examples/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(e,`delete ${t}`,!0),e})}async updateExample(e,t){let r,i,a;return eF(r=t?e:e.id),a=void 0!==(i=t?{id:r,...t}:e).dataset_id?i.dataset_id:(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(a,[i])}async updateExamples(e){let t;return t=void 0===e[0].dataset_id?(await this.readExample(e[0].id)).dataset_id:e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:i}){let a;if(eF(a=e||(await this.readDataset({datasetName:t})).id),r&&i||!r&&!i)throw Error("Exactly one of asOf and tag must be specified.");let n=new URLSearchParams;void 0!==r&&n.append("as_of","string"==typeof r?r:r.toISOString()),void 0!==i&&n.append("tag",i);let s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${a}/version?${n.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(e,"read dataset version"),e});return await s.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let i;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");eF(i=void 0===e?(await this.readDataset({datasetName:t})).id:e);let a=new URLSearchParams,n=r?"string"==typeof r?r:r?.toISOString():void 0;return n&&a.append("as_of",n),await this._get(`/datasets/${i}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:i,remove:a=!1}){let n;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");eF(n=void 0===e?(await this.readDataset({datasetName:t})).id:e);let s=JSON.stringify({split_name:r,examples:i.map(e=>(eF(e),e)),remove:a});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${n}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await eq(e,"update dataset splits",!0),e})}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:i,referenceExample:a}={loadChildRuns:!1}){let n;if(eB("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof e)n=await this.readRun(e,{loadChildRuns:i});else if("object"==typeof e&&"id"in e)n=e;else throw Error(`Invalid run type: ${typeof e}`);null!==n.reference_example_id&&void 0!==n.reference_example_id&&(a=await this.readExample(n.reference_example_id));let s=await t.evaluateRun(n,a),[o,l]=await this._logEvaluationFeedback(s,n,r);return l[0]}async createFeedback(e,t,{score:r,value:i,correction:a,comment:n,sourceInfo:s,feedbackSourceType:o="api",sourceRunId:l,feedbackId:u,feedbackConfig:c,projectId:d,comparativeExperimentId:h}){if(!e&&!d)throw Error("One of runId or projectId must be provided");if(e&&d)throw Error("Only one of runId or projectId can be provided");let p={type:o??"api",metadata:s??{}};void 0===l||p?.metadata===void 0||p.metadata.__run||(p.metadata.__run={run_id:l}),p?.metadata!==void 0&&p.metadata.__run?.run_id!==void 0&&eF(p.metadata.__run.run_id);let f={id:u??T(),run_id:e,key:t,score:e8(r),value:i,correction:a,comment:n,feedback_source:p,comparative_experiment_id:h,feedbackConfig:c,session_id:d},m=JSON.stringify(f),g=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{let e=await this._fetch(g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:m});return await eq(e,"create feedback",!0),e}),f}async updateFeedback(e,{score:t,value:r,correction:i,comment:a}){let n={};null!=t&&(n.score=e8(t)),null!=r&&(n.value=r),null!=i&&(n.correction=i),null!=a&&(n.comment=a),eF(e);let s=JSON.stringify(n);await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await eq(t,"update feedback",!0),t})}async readFeedback(e){eF(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){eF(e);let t=`/feedback/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(e,`delete ${t}`,!0),e})}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let i=new URLSearchParams;if(e)for(let t of e)eF(t),i.append("run",t);if(t)for(let e of t)i.append("key",e);if(r)for(let e of r)i.append("source",e);for await(let e of this._getPaginated("/feedback",i))yield*e}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:i}={}){let a={run_id:e,feedback_key:t,feedback_config:i};r?"string"==typeof r?a.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(a.expires_in=r):a.expires_in={hours:3};let n=JSON.stringify(a),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await eq(e,"create presigned feedback token"),e});return await s.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:i,description:a,metadata:n,id:s}){if(0===t.length)throw Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!r)throw Error("A reference dataset is required");let o={id:s,name:e,experiment_ids:t,reference_dataset_id:r,description:a,created_at:(i??new Date)?.toISOString(),extra:{}};n&&(o.extra.metadata=n);let l=JSON.stringify(o);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await eq(e,"create comparative experiment"),e})).json()}async *listPresignedFeedbackTokens(e){eF(e);let t=new URLSearchParams({run_id:e});for await(let e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){return"results"in e?e.results:Array.isArray(e)?e:[e]}async _logEvaluationFeedback(e,t,r){let i=this._selectEvalResults(e),a=[];for(let e of i){let i=r||{};e.evaluatorInfo&&(i={...e.evaluatorInfo,...i});let n=null;e.targetRunId?n=e.targetRunId:t&&(n=t.id),a.push(await this.createFeedback(n,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:i,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[i,a]}async logEvaluationFeedback(e,t,r){let[i]=await this._logEvaluationFeedback(e,t,r);return i}async *listAnnotationQueues(e={}){let{queueIds:t,name:r,nameContains:i,limit:a}=e,n=new URLSearchParams;t&&t.forEach((e,t)=>{eF(e,`queueIds[${t}]`),n.append("ids",e)}),r&&n.append("name",r),i&&n.append("name_contains",i),n.append("limit",(void 0!==a?Math.min(a,100):100).toString());let s=0;for await(let e of this._getPaginated("/annotation-queues",n))if(yield*e,s++,void 0!==a&&s>=a)break}async createAnnotationQueue(e){let{name:t,description:r,queueId:i,rubricInstructions:a}=e,n=JSON.stringify(Object.fromEntries(Object.entries({name:t,description:r,id:i||T(),rubric_instructions:a}).filter(([e,t])=>void 0!==t)));return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await eq(e,"create annotation queue"),e})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${eF(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,"read annotation queue"),t})).json()}async updateAnnotationQueue(e,t){let{name:r,description:i,rubricInstructions:a}=t,n=JSON.stringify({name:r,description:i,rubric_instructions:a});await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${eF(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await eq(t,"update annotation queue",!0),t})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${eF(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){let r=JSON.stringify(t.map((e,t)=>eF(e,`runIds[${t}]`).toString()));await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${eF(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await eq(t,"add runs to annotation queue",!0),t})}async getRunFromAnnotationQueue(e,t){let r=`/annotation-queues/${eF(e,"queueId")}/run`;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(e,"get run from annotation queue"),e})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{let r=await this._fetch(`${this.apiUrl}/annotation-queues/${eF(e,"queueId")}/runs/${eF(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(r,"delete run from annotation queue",!0),r})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${eF(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,"get size from annotation queue"),t})).json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){let r=await this._getSettings();return Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(t,"get latest commit hash"),t}),r=await t.json();if(0!==r.commits.length)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[r,i,a]=eH(e),n=JSON.stringify({like:t});return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/likes/${r}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await eq(e,`${t?"like":"unlike"} prompt`),e})).json()}async _getPromptUrl(e){let[t,r,i]=eH(e);if(await this._currentTenantIsOwner(t)){let e=await this._getSettings();return"latest"!==i?`${this.getHostUrl()}/prompts/${r}/${i.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${e.id}`}return"latest"!==i?`${this.getHostUrl()}/hub/${t}/${r}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async *listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,e=>e.commits))yield*t}async *listPrompts(e){let t=new URLSearchParams;for await(let r of(t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query),this._getPaginated("/repos",t,e=>e.repos)))yield*r}async getPrompt(e){let[t,r,i]=eH(e),a=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return e?.status===404?null:(await eq(e,"get prompt"),e)}),n=await a?.json();return n?.repo?n.repo:null}async createPrompt(e,t){let r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[i,a,n]=eH(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);let s=JSON.stringify({repo_handle:a,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic}),o=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await eq(e,"create prompt"),e}),{repo:l}=await o.json();return l}async createCommit(e,t,r){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[i,a,n]=eH(e),s=r?.parentCommitHash!=="latest"&&r?.parentCommitHash?r?.parentCommitHash:await this._getLatestCommitHash(`${i}/${a}`),o=JSON.stringify({manifest:JSON.parse(JSON.stringify(t)),parent_commit:s}),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${i}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await eq(e,"create commit"),e}),u=await l.json();return this._getPromptUrl(`${i}/${a}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=e.id,i=e0({...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split}},`Serializing body for example with id: ${t}`),a=new Blob([i],{type:"application/json"});if(r.append(t,a),e.inputs){let i=e0(e.inputs,`Serializing inputs for example with id: ${t}`),a=new Blob([i],{type:"application/json"});r.append(`${t}.inputs`,a)}if(e.outputs){let i=e0(e.outputs,`Serializing outputs whle updating example with id: ${t}`),a=new Blob([i],{type:"application/json"});r.append(`${t}.outputs`,a)}if(e.attachments)for(let[i,a]of Object.entries(e.attachments)){let e,n;Array.isArray(a)?[e,n]=a:(e=a.mimeType,n=a.data);let s=new Blob([n],{type:`${e}; length=${n.byteLength}`});r.append(`${t}.attachment.${i}`,s)}if(e.attachments_operations){let i=e0(e.attachments_operations,`Serializing attachments while updating example with id: ${t}`),a=new Blob([i],{type:"application/json"});r.append(`${t}.attachments_operations`,a)}}let i=e??t[0]?.dataset_id;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${i}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await eq(e,"update examples"),e})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=(e.id??T()).toString(),i=e0({created_at:e.created_at,...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split},...e.source_run_id&&{source_run_id:e.source_run_id},...e.use_source_run_io&&{use_source_run_io:e.use_source_run_io},...e.use_source_run_attachments&&{use_source_run_attachments:e.use_source_run_attachments}},`Serializing body for uploaded example with id: ${t}`),a=new Blob([i],{type:"application/json"});if(r.append(t,a),e.inputs){let i=e0(e.inputs,`Serializing inputs for uploaded example with id: ${t}`),a=new Blob([i],{type:"application/json"});r.append(`${t}.inputs`,a)}if(e.outputs){let i=e0(e.outputs,`Serializing outputs for uploaded example with id: ${t}`),a=new Blob([i],{type:"application/json"});r.append(`${t}.outputs`,a)}if(e.attachments)for(let[i,a]of Object.entries(e.attachments)){let e,n;Array.isArray(a)?[e,n]=a:(e=a.mimeType,n=a.data);let s=new Blob([n],{type:`${e}; length=${n.byteLength}`});r.append(`${t}.attachment.${i}`,s)}}return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await eq(t,"upload examples"),t})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[r,i]=eH(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let a={};if(t?.description!==void 0&&(a.description=t.description),t?.readme!==void 0&&(a.readme=t.readme),t?.tags!==void 0&&(a.tags=t.tags),t?.isPublic!==void 0&&(a.is_public=t.isPublic),t?.isArchived!==void 0&&(a.is_archived=t.isArchived),0===Object.keys(a).length)throw Error("No valid update options provided");let n=JSON.stringify(a);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${r}/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await eq(e,"update prompt"),e})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[t,r,i]=eH(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(e,"delete prompt"),e})).json()}async pullPromptCommit(e,t){let[r,i,a]=eH(e),n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${r}/${i}/${a}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await eq(e,"pull prompt commit"),e}),s=await n.json();return{owner:r,repo:i,commit_hash:s.commit_hash,manifest:s.manifest,examples:s.examples}}async _pullPrompt(e,t){return JSON.stringify((await this.pullPromptCommit(e,{includeModel:t?.includeModel})).manifest)}async pushPrompt(e,t){return(await this.promptExists(e)?t&&Object.keys(t).some(e=>"object"!==e)&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object)?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:r=this.apiUrl,datasetName:i}=t,[a,n]=this.parseTokenOrUrl(e,r),s=new tt({apiUrl:a,apiKey:"placeholder"}),o=await s.readSharedDataset(n),l=i||o.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch(e){}let u=await s.listSharedExamples(n),c=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(e=>e.inputs),outputs:u.flatMap(e=>e.outputs?[e.outputs]:[]),datasetId:c.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,r=2,i="dataset"){try{return eF(e),[t,e]}catch(e){}try{let a=new URL(e).pathname.split("/").filter(e=>""!==e);if(a.length>=r){let e=a[a.length-r];return[t,e]}throw Error(`Invalid public ${i} URL: ${e}`)}catch(t){throw Error(`Invalid public ${i} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),void 0!==this.langSmithToOTELTranslator&&await eR.getDefaultOTLPTracerComponents()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}}function tr(e){return"dataset_id"in e||"dataset_name"in e}let ti=e=>void 0!==e?e:!!["TRACING_V2","TRACING"].find(e=>"true"===e_(e)),ta=Symbol.for("lc:context_variables");function tn(e,t,r=1){let i=r.toFixed(0).slice(0,3).padStart(3,"0"),a=`${new Date(e).toISOString().slice(0,-1)}${i}Z`;return{dottedOrder:a.replace(/[-:.]/g,"")+t,microsecondPrecisionDatestring:a}}class ts{constructor(e,t,r,i){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=r,this.replicas=i}static fromHeader(e){let t,r;let i=e.split(","),a={},n=[];for(let e of i){let[i,s]=e.split("="),o=decodeURIComponent(s);"langsmith-metadata"===i?a=JSON.parse(o):"langsmith-tags"===i?n=o.split(","):"langsmith-project"===i?t=o:"langsmith-replicas"===i&&(r=JSON.parse(o))}return new ts(a,n,t,r)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class to{constructor(e){var t;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),null!=e&&"function"==typeof e.createChild&&"function"==typeof e.postRun){Object.assign(this,{...e});return}let r=to.getDefaultConfig(),{metadata:i,...a}=e,n=a.client??to.getSharedClient(),s={...i,...a?.extra?.metadata};if(a.extra={...a.extra,metadata:s},Object.assign(this,{...r,...a,client:n}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=(t=this.replicas)?t.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):function(){let e=eb("LANGSMITH_RUNS_ENDPOINTS");if(!e)return[];try{let t=JSON.parse(e);if(Array.isArray(t)){let e=[];for(let r of t){if("object"!=typeof r||null===r){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof r}`);continue}if("string"!=typeof r.api_url){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_url}`);continue}if("string"!=typeof r.api_key){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_key}`);continue}e.push({apiUrl:r.api_url.replace(/\/$/,""),apiKey:r.api_key})}return e}if("object"!=typeof t||null===t)return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof t}`),[];{(function(e){if(Object.keys(e).length>0&&e_("ENDPOINT"))throw new eZ})(t);let e=[];for(let[r,i]of Object.entries(t)){let t=r.replace(/\/$/,"");if("string"==typeof i)e.push({apiUrl:t,apiKey:i});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${r}: expected string, got ${typeof i}`);continue}}return e}}catch(e){if("object"==typeof e&&null!==e&&e.code===eW)throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}(),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let{dottedOrder:e,microsecondPrecisionDatestring:t}=tn(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e,this._serialized_start_time=t}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:T(),run_type:"chain",project_name:el(),child_runs:[],api_url:eb("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:eb("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return to.sharedClient||(to.sharedClient=new tt),to.sharedClient}createChild(e){var t;let r=this.child_execution_order+1,i=new to({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:r,child_execution_order:r});ta in this&&(i[ta]=this[ta]);let a=Symbol.for("lc:child_config"),n=e.extra?.[a]??this.extra[a];if(null!=n&&"object"==typeof n.callbacks&&(tu(n.callbacks?.handlers)||tu(n.callbacks))){let e={...n},r="object"==typeof(t=e.callbacks)&&null!=t&&Array.isArray(t.handlers)?e.callbacks.copy?.():void 0;r&&(Object.assign(r,{_parentRunId:i.id}),r.handlers?.find(tl)?.updateFromRunTree?.(i),e.callbacks=r),i.extra[a]=e}let s=new Set,o=this;for(;null!=o&&!s.has(o.id);)s.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,r),o=o.parent_run;return this.child_runs.push(i),i}async end(e,t,r=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,i&&Object.keys(i).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...i}}:{metadata:i})}_convertToCreate(e,t,r=!0){let i,a;let n=e.extra??{};if(n?.runtime?.library===void 0&&(n.runtime||(n.runtime={}),t))for(let[e,r]of Object.entries(t))n.runtime[e]||(n.runtime[e]=r);return r?(a=e.parent_run?.id??e.parent_run_id,i=[]):(i=e.child_runs.map(e=>this._convertToCreate(e,t,r)),a=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:n,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,r=!0){let i;let a=this._convertToCreate(this,t,r);if(e===this.project_name)return a;let n=t=>Y(`${t}:${e}`,Y.DNS),s=n(a.id),o=a.trace_id?n(a.trace_id):void 0,l=a.parent_run_id?n(a.parent_run_id):void 0;if(a.dotted_order){let e=a.dotted_order.split(".").map(e=>{let t=e.slice(0,-36),r=e.slice(-36),i=parseInt(t.slice(0,4)),a=parseInt(t.slice(4,6))-1,n=parseInt(t.slice(6,8)),s=parseInt(t.slice(9,11));return[new Date(i,a,n,s,parseInt(t.slice(11,13)),parseInt(t.slice(13,15)),parseInt(t.slice(15,21))/1e3),r]}),t=[];for(let r=0;r<e.length-1;r++){let[i,a]=e[r],s=n(a);t.push(i.toISOString().replace(/[-:]/g,"").replace(".","")+s)}let[r]=e[e.length-1];t.push(r.toISOString().replace(/[-:]/g,"").replace(".","")+s),i=t.join(".")}else i=void 0;return{...a,id:s,trace_id:o,parent_run_id:l,dotted_order:i,session_name:e}}async postRun(e=!0){try{let t=ey();if(this.replicas&&this.replicas.length>0)for(let{projectName:e,apiKey:r,apiUrl:i,workspaceId:a}of this.replicas){let n=this._remapForProject(e??this.project_name,t,!0);await this.client.createRun(n,{apiKey:r,apiUrl:i,workspaceId:a})}else{let r=this._convertToCreate(this,t,e);await this.client.createRun(r)}if(!e)for(let e of(eB("Posting with excludeChildRuns=false is deprecated and will be removed in a future version."),this.child_runs))await e.postRun(!1)}catch(e){console.error(`Error in postRun for run ${this.id}:`,e)}}async patchRun(e){if(this.replicas&&this.replicas.length>0)for(let{projectName:t,apiKey:r,apiUrl:i,workspaceId:a,updates:n}of this.replicas){let s=this._remapForProject(t??this.project_name),o={id:s.id,outputs:s.outputs,error:s.error,parent_run_id:s.parent_run_id,session_name:s.session_name,reference_example_id:s.reference_example_id,end_time:s.end_time,dotted_order:s.dotted_order,trace_id:s.trace_id,events:s.events,tags:s.tags,extra:s.extra,attachments:this.attachments,...n};e?.excludeInputs||(o.inputs=s.inputs),await this.client.updateRun(s.id,o,{apiKey:r,apiUrl:i,workspaceId:a})}else try{let t={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(t.inputs=this.inputs),await this.client.updateRun(this.id,t)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),"string"==typeof e?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){let r,i,a;let n=e?.callbacks,s=ti();if(n){let e=n?.getParentRunId?.()??"",t=n?.handlers?.find(e=>e?.name=="langchain_tracer");r=t?.getRun?.(e),i=t?.projectName,a=t?.client,s=s||!!t}return r?new to({name:r.name,id:r.id,trace_id:r.trace_id,dotted_order:r.dotted_order,client:a,tracingEnabled:s,project_name:i,tags:[...new Set((r?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...r?.extra?.metadata,...e?.metadata}}}).createChild(t):new to({...t,client:a,tracingEnabled:s,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=r["langsmith-trace"];if(!i||"string"!=typeof i)return;let a=i.trim(),n=a.split(".").map(e=>{let[t,r]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:r}}),s=n[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:n.at(-1)?.uuid,trace_id:s,dotted_order:a};if(r.baggage&&"string"==typeof r.baggage){let e=ts.fromHeader(r.baggage);o.metadata=e.metadata,o.tags=e.tags,o.project_name=e.project_name,o.replicas=e.replicas}return new to(o)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new ts(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[r,i]of Object.entries(t))e.set(r,i);return t}}function tl(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function tu(e){return Array.isArray(e)&&e.some(e=>tl(e))}Object.defineProperty(to,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});var tc=r(2466);function td(e,t){return t?.[e]||tc(e)}function th(e){return Array.isArray(e)?[...e]:{...e}}function tp(e){let t=Object.getPrototypeOf(e);return"function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}r(23204);class tf{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,tp(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),void 0!==this.lc_serializable_keys?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([e])=>this.lc_serializable_keys?.includes(e))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof tf||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(t,Reflect.get(i,"lc_secrets",this)),Object.assign(r,Reflect.get(i,"lc_attributes",this));return Object.keys(t).forEach(e=>{let t=this,i=r,[a,...n]=e.split(".").reverse();for(let e of n.reverse()){if(!(e in t)||void 0===t[e])return;e in i&&void 0!==i[e]||("object"==typeof t[e]&&null!=t[e]?i[e]={}:Array.isArray(t[e])&&(i[e]=[])),t=t[e],i=i[e]}a in t&&void 0!==t[a]&&(i[a]=i[a]||t[a])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:function(e,t,r){let i={};for(let a in e)Object.hasOwn(e,a)&&(i[t(a,r)]=e[a]);return i}(Object.keys(t).length?function(e,t){let r=th(e);for(let[e,i]of Object.entries(t)){let[t,...a]=e.split(".").reverse(),n=r;for(let e of a.reverse()){if(void 0===n[e])break;n[e]=th(n[e]),n=n[e]}void 0!==n[t]&&(n[t]={lc:1,type:"secret",id:[i]})}return r}(r,t):r,td,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}var tm=r(83454);let tg=()=>"undefined"!=typeof window&&void 0!==window.document,ty=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,tb=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom"),t_=()=>"undefined"!=typeof Deno,tv=()=>void 0!==tm&&void 0!==tm.versions&&void 0!==tm.versions.node&&!t_(),tw=()=>tg()?"browser":tv()?"node":ty()?"webworker":tb()?"jsdom":t_()?"deno":"other";function tE(e){try{if(void 0!==tm)return tm.env?.[e];if(t_())return Deno?.env.get(e);return}catch(e){return}}class tO{}class tS extends tO{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,tp(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"false"===tE("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return tf.prototype.toJSON.call(this)}toJSONNotImplemented(){return tf.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends tS{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:T()}),Object.assign(this,e)}}return new t}}let tT=e=>void 0!==e&&"function"==typeof e.copy&&"string"==typeof e.name&&"boolean"==typeof e.awaitHandlers,tA=e=>{if(e)return e.events=e.events??[],e.child_runs=e.child_runs??[],e};function tx(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}function tI(e){return"function"==typeof e._addRunToRunMap}class t$ extends tS{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(void 0!==e)return this.usesRunTreeMap?tA(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let{dottedOrder:t,microsecondPrecisionDatestring:r}=tn(new Date(e.start_time).getTime(),e.id,e.execution_order),i={...e},a=this.getRunById(i.parent_run_id);if(void 0!==i.parent_run_id?a&&(this._addChildRun(a,i),a.child_execution_order=Math.max(a.child_execution_order,i.child_execution_order),i.trace_id=a.trace_id,void 0!==a.dotted_order&&(i.dotted_order=[a.dotted_order,t].join("."),i._serialized_start_time=r)):(i.trace_id=i.id,i.dotted_order=t,i._serialized_start_time=r),this.usesRunTreeMap){let e=function e(t,r){if(t)return new to({...t,start_time:t._serialized_start_time??t.start_time,parent_run:e(r),child_runs:t.child_runs.map(t=>e(t)).filter(e=>void 0!==e),extra:{...t.extra,runtime:(void 0===s&&(s={library:"langchain-js",runtime:tw()}),s)},tracingEnabled:!1})}(i,a);void 0!==e&&this.runTreeMap.set(i.id,e)}else this.runMap.set(i.id,i);return i}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){let t=void 0!==e&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,i,a,n,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c=s?{...a,metadata:s}:a,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:n||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,r,i,a,n,s,o){let l=this.getRunById(r)??this._createRunForLLMStart(e,t,r,i,a,n,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}_createRunForChatModelStart(e,t,r,i,a,n,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c=s?{...a,metadata:s}:a,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:n||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,r,i,a,n,s,o){let l=this.getRunById(r)??this._createRunForChatModelStart(e,t,r,i,a,n,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}async handleLLMEnd(e,t,r,i,a){let n=this.getRunById(t);if(!n||n?.run_type!=="llm")throw Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),n.extra={...n.extra,...a},await this.onLLMEnd?.(n),await this._endTrace(n),n}async handleLLMError(e,t,r,i,a){let n=this.getRunById(t);if(!n||n?.run_type!=="llm")throw Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),n.extra={...n.extra,...a},await this.onLLMError?.(n),await this._endTrace(n),n}_createRunForChainStart(e,t,r,i,a,n,s,o){let l=this._getExecutionOrder(i),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:n?{metadata:n}:{},tags:a||[]};return this._addRunToRunMap(c)}async handleChainStart(e,t,r,i,a,n,s,o){let l=this.getRunById(r)??this._createRunForChainStart(e,t,r,i,a,n,s,o);return await this.onRunCreate?.(l),await this.onChainStart?.(l),l}async handleChainEnd(e,t,r,i,a){let n=this.getRunById(t);if(!n)throw Error("No chain run to end.");return n.end_time=Date.now(),n.outputs=tx(e,"output"),n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),a?.inputs!==void 0&&(n.inputs=tx(a.inputs,"input")),await this.onChainEnd?.(n),await this._endTrace(n),n}async handleChainError(e,t,r,i,a){let n=this.getRunById(t);if(!n)throw Error("No chain run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),a?.inputs!==void 0&&(n.inputs=tx(a.inputs,"input")),await this.onChainError?.(n),await this._endTrace(n),n}_createRunForToolStart(e,t,r,i,a,n,s){let o=this._getExecutionOrder(i),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:n?{metadata:n}:{},tags:a||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,r,i,a,n,s){let o=this.getRunById(r)??this._createRunForToolStart(e,t,r,i,a,n,s);return await this.onRunCreate?.(o),await this.onToolStart?.(o),o}async handleToolEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,t,r,i,a,n,s){let o=this._getExecutionOrder(i),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:n?{metadata:n}:{},tags:a||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,r,i,a,n,s){let o=this.getRunById(r)??this._createRunForRetrieverStart(e,t,r,i,a,n,s);return await this.onRunCreate?.(o),await this.onRetrieverStart?.(o),o}async handleRetrieverEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,i,a,n){let s=this.getRunById(r);if(!s||s?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:n?.chunk}}),await this.onLLMNewToken?.(s,e,{chunk:n?.chunk}),s}}var tR=r(50265);function tP(e,t){return`${e.open}${t}${e.close}`}function tj(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function tN(e){return"string"==typeof e?e.trim():null==e?e:tj(e,e.toString())}function tC(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}let{color:tk}=tR;class tL extends t${constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=[...this.getParents(e).reverse(),e].map((e,t,r)=>{let i=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?tP(tR.bold,i):i}).join(" > ");return tP(tk.grey,t)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.green,"[chain/start]")} [${t}] Entering Chain run with input: ${tj(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.cyan,"[chain/end]")} [${t}] [${tC(e)}] Exiting Chain run with output: ${tj(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.red,"[chain/error]")} [${t}] [${tC(e)}] Chain run errored with error: ${tj(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${tP(tk.green,"[llm/start]")} [${t}] Entering LLM run with input: ${tj(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.cyan,"[llm/end]")} [${t}] [${tC(e)}] Exiting LLM run with output: ${tj(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.red,"[llm/error]")} [${t}] [${tC(e)}] LLM run errored with error: ${tj(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.green,"[tool/start]")} [${t}] Entering Tool run with input: "${tN(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.cyan,"[tool/end]")} [${t}] [${tC(e)}] Exiting Tool run with output: "${tN(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.red,"[tool/error]")} [${t}] [${tC(e)}] Tool run errored with error: ${tj(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${tj(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.cyan,"[retriever/end]")} [${t}] [${tC(e)}] Exiting Retriever run with output: ${tj(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.red,"[retriever/error]")} [${t}] [${tC(e)}] Retriever run errored with error: ${tj(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${tP(tk.blue,"[agent/action]")} [${t}] Agent selected action: ${tj(e.actions[e.actions.length-1],"[action]")}`)}}function tM(e){return"object"==typeof e&&null!==e&&"type"in e&&"string"==typeof e.type&&"source_type"in e&&("url"===e.source_type||"base64"===e.source_type||"text"===e.source_type||"id"===e.source_type)}class tD extends tf{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:Array.isArray(this.content)?this.content.map(e=>"string"==typeof e?e:"text"===e.type?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){var t,r;if(null===e)return this;let i=(t=this._printableFields,r=Math.max(4,e),JSON.stringify(function e(t,i){if("object"!=typeof t||null==t)return t;if(i>=r)return Array.isArray(t)?"[Array]":"[Object]";if(Array.isArray(t))return t.map(t=>e(t,i+1));let a={};for(let r of Object.keys(t))a[r]=e(t[r],i+1);return a}(t,0),null,2));return`${this.constructor.lc_name()} ${i}`}}function tU(e,t){let r={...e};for(let[e,i]of Object.entries(t))if(null==r[e])r[e]=i;else if(null==i)continue;else if(typeof r[e]!=typeof i||Array.isArray(r[e])!==Array.isArray(i))throw Error(`field[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e]){if("type"===e)continue;r[e]+=i}else if("object"!=typeof r[e]||Array.isArray(r[e])){if(Array.isArray(r[e]))r[e]=tF(r[e],i);else{if(r[e]===i)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}}else r[e]=tU(r[e],i);return r}function tF(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{let r=[...e];for(let e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){let t=r.findIndex(t=>t.index===e.index);-1!==t?r[t]=tU(r[t],e):r.push(e)}else{if("object"==typeof e&&"text"in e&&""===e.text)continue;r.push(e)}return r}}}class tz extends tD{}class tB extends tz{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0};else{let r=e.tool_call_chunks.reduce((e,t)=>{let r=t.id||`fallback-${t.index||0}`;return e[r]=e[r]??[],e[r].push(t),e},{}),i=[],a=[];for(let[e,t]of Object.entries(r)){let r={},n=t[0]?.name??"",s=t.map(e=>e.args||"").join(""),o=s.length?s:"{}",l=t[0]?.id||e;try{if(r=function(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="",r=[],i=!1,a=!1;for(let n of e){if(i)'"'!==n||a?"\n"!==n||a?a="\\"===n&&!a:n="\\n":i=!1;else if('"'===n)i=!0,a=!1;else if("{"===n)r.push("}");else if("["===n)r.push("]");else if("}"===n||"]"===n){if(!r||r[r.length-1]!==n)return null;r.pop()}t+=n}i&&(t+='"');for(let e=r.length-1;e>=0;e-=1)t+=r[e];try{return JSON.parse(t)}catch(e){return null}}(o),null===r||"object"!=typeof r||Array.isArray(r))throw Error("Malformed tool call chunk args.");i.push({name:n,args:r,id:l,type:"tool_call"})}catch(e){a.push({name:n,args:o,id:l,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:i,invalid_tool_calls:a,usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var t,r;let i={content:(t=this.content,r=e.content,"string"==typeof t?""===t?r:"string"==typeof r?t+r:Array.isArray(r)&&r.some(e=>tM(e))?[{type:"text",source_type:"text",text:t},...r]:[{type:"text",text:t},...r]:Array.isArray(r)?tF(t,r)??[...t,...r]:""===r?t:Array.isArray(t)&&t.some(e=>tM(e))?[...t,{type:"file",source_type:"text",text:r}]:[...t,{type:"text",text:r}]),additional_kwargs:tU(this.additional_kwargs,e.additional_kwargs),response_metadata:tU(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){let t=tF(this.tool_call_chunks,e.tool_call_chunks);void 0!==t&&t.length>0&&(i.tool_call_chunks=t)}if(void 0!==this.usage_metadata||void 0!==e.usage_metadata){let t={...(this.usage_metadata?.input_token_details?.audio!==void 0||e.usage_metadata?.input_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)},...(this.usage_metadata?.input_token_details?.cache_read!==void 0||e.usage_metadata?.input_token_details?.cache_read!==void 0)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)},...(this.usage_metadata?.input_token_details?.cache_creation!==void 0||e.usage_metadata?.input_token_details?.cache_creation!==void 0)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}},r={...(this.usage_metadata?.output_token_details?.audio!==void 0||e.usage_metadata?.output_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)},...(this.usage_metadata?.output_token_details?.reasoning!==void 0||e.usage_metadata?.output_token_details?.reasoning!==void 0)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}},a=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},n=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s={input_tokens:a.input_tokens+n.input_tokens,output_tokens:a.output_tokens+n.output_tokens,total_tokens:a.total_tokens+n.total_tokens,...Object.keys(t).length>0&&{input_token_details:t},...Object.keys(r).length>0&&{output_token_details:r}};i.usage_metadata=s}return new tB(i)}}let tH=()=>(void 0===o&&(o=new tt("false"===tE("LANGCHAIN_CALLBACKS_BACKGROUND")?{blockOnRootRunFinalization:!0}:{})),o);class tG extends t${constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});let{exampleId:t,projectName:r,client:i,replicas:a}=e;this.projectName=r??el(),this.replicas=a,this.exampleId=t,this.client=i??tH();let n=tG.getTraceableRunTree();n&&this.updateFromRunTree(n)}async persistRun(e){}async onRunCreate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.postRun()}async onRunUpdate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.patchRun()}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){this.runTreeMap.set(e.id,e);let t=e,r=new Set;for(;t.parent_run&&!r.has(t.id)&&(r.add(t.id),t.parent_run);)t=t.parent_run;r.clear();let i=[t];for(;i.length>0;){let e=i.shift();!(!e||r.has(e.id))&&(r.add(e.id),this.runTreeMap.set(e.id,e),e.child_runs&&i.push(...e.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){let t=this.runTreeMap.get(e);if(t)return new to({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return function(e=!1){let t=R.getInstance().getStore();if(!e&&void 0===t)throw Error("Could not get the current run tree.\n\nPlease make sure you are calling this method within a traceable function and that tracing is enabled.");return t}(!0)}catch{return}}}let tq=Symbol.for("ls:tracing_async_local_storage"),tW=Symbol.for("lc:context_variables"),tZ=e=>{globalThis[tq]=e},tJ=()=>globalThis[tq];async function tV(e,t){if(!0===t){let t=tJ();void 0!==t?await t.run(void 0,async()=>e()):await e()}else void 0===l&&(l=new eC.default({autoStart:!0,concurrency:1})),l.add(async()=>{let t=tJ();void 0!==t?await t.run(void 0,async()=>e()):await e()})}let tK=e=>void 0!==e?e:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>"true"===tE(e));function tX(e){let t=tJ();if(void 0===t)return;let r=t.getStore();return r?.[tW]?.[e]}let tY=Symbol("lc:configure_hooks"),tQ=()=>tX(tY)||[];class t0{setHandler(e){return this.setHandlers([e])}}class t1{constructor(e,t,r,i,a,n,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>tV(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,i,a){await Promise.all(this.handlers.map(r=>tV(async()=>{try{await r.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleCustomEvent: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}}class t2 extends t1{getChild(e){let t=new t3(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>tV(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw e}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>tV(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}},t.awaitHandlers)))}}class t9 extends t1{async handleLLMNewToken(e,t,r,i,a,n){await Promise.all(this.handlers.map(r=>tV(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,n)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}async handleLLMError(e,t,r,i,a){await Promise.all(this.handlers.map(t=>tV(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,a)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleLLMEnd(e,t,r,i,a){await Promise.all(this.handlers.map(t=>tV(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,a)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class t4 extends t1{getChild(e){let t=new t3(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,i,a){await Promise.all(this.handlers.map(t=>tV(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,a)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleChainEnd(e,t,r,i,a){await Promise.all(this.handlers.map(t=>tV(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,a)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>tV(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>tV(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class t5 extends t1{getChild(e){let t=new t3(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>tV(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>tV(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class t3 extends t0{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r,i,a,n,s,o){return Promise.all(t.map(async(t,i)=>{let n=0===i&&r?r:T();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return tI(r)&&r._createRunForLLMStart(e,[t],n,this._parentRunId,a,this.tags,this.metadata,o),tV(async()=>{try{await r.handleLLMStart?.(e,[t],n,this._parentRunId,a,this.tags,this.metadata,o)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new t9(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,i,a,n,s,o){return Promise.all(t.map(async(t,i)=>{let n=0===i&&r?r:T();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return tI(r)&&r._createRunForChatModelStart(e,[t],n,this._parentRunId,a,this.tags,this.metadata,o),tV(async()=>{try{if(r.handleChatModelStart)await r.handleChatModelStart?.(e,[t],n,this._parentRunId,a,this.tags,this.metadata,o);else if(r.handleLLMStart){let i=function(e,t="Human",r="AI"){let i=[];for(let a of e){let e;if("human"===a._getType())e=t;else if("ai"===a._getType())e=r;else if("system"===a._getType())e="System";else if("function"===a._getType())e="Function";else if("tool"===a._getType())e="Tool";else if("generic"===a._getType())e=a.role;else throw Error(`Got unsupported message type: ${a._getType()}`);let n=a.name?`${a.name}, `:"",s="string"==typeof a.content?a.content:JSON.stringify(a.content,null,2);i.push(`${e}: ${n}${s}`)}return i.join("\n")}(t);await r.handleLLMStart?.(e,[i],n,this._parentRunId,a,this.tags,this.metadata,o)}}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new t9(n,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=T(),i,a,n,s){return await Promise.all(this.handlers.map(a=>{if(!a.ignoreChain)return tI(a)&&a._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,i,s),tV(async()=>{try{await a.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,i,s)}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainStart: ${e}`),a.raiseError)throw e}},a.awaitHandlers)})),new t4(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=T(),i,a,n,s){return await Promise.all(this.handlers.map(i=>{if(!i.ignoreAgent)return tI(i)&&i._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,s),tV(async()=>{try{await i.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleToolStart: ${e}`),i.raiseError)throw e}},i.awaitHandlers)})),new t5(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=T(),i,a,n,s){return await Promise.all(this.handlers.map(i=>{if(!i.ignoreRetriever)return tI(i)&&i._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,s),tV(async()=>{try{await i.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleRetrieverStart: ${e}`),i.raiseError)throw e}},i.awaitHandlers)})),new t2(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,i,a){await Promise.all(this.handlers.map(i=>tV(async()=>{if(!i.ignoreCustomEvent)try{await i.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${e}`),i.raiseError)throw e}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new t3(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);r.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(let i of e)r.handlers.filter(e=>"console_callback_handler"===e.name).some(e=>e.name===i.name)||r.addHandler(i,t);return r}static fromHandlers(e){class t extends tS{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:T()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static configure(e,t,r,i,a,n,s){return this._configureSync(e,t,r,i,a,n,s)}static _configureSync(e,t,r,i,a,n,s){let o;(e||t)&&(Array.isArray(e)||!e?(o=new t3).setHandlers(e?.map(t6)??[],!0):o=e,o=o.copy(Array.isArray(t)?t.map(t6):t?.handlers,!1));let l="true"===tE("LANGCHAIN_VERBOSE")||s?.verbose,u=tG.getTraceableRunTree()?.tracingEnabled||tK(),c=u||(tE("LANGCHAIN_TRACING")??!1);if(l||c){if(o||(o=new t3),l&&!o.handlers.some(e=>e.name===tL.prototype.name)){let e=new tL;o.addHandler(e,!0)}if(c&&!o.handlers.some(e=>"langchain_tracer"===e.name)&&u){let e=new tG;o.addHandler(e,!0)}if(u){let e=tG.getTraceableRunTree();if(e&&void 0===o._parentRunId){o._parentRunId=e.id;let t=o.handlers.find(e=>"langchain_tracer"===e.name);t?.updateFromRunTree(e)}}}for(let{contextVar:e,inheritable:t=!0,handlerClass:r,envVar:i}of tQ()){let a;let n=i&&"true"===tE(i)&&r,s=void 0!==e?tX(e):void 0;s&&tT(s)?a=s:n&&(a=new r({})),void 0===a||(o||(o=new t3),o.handlers.some(e=>e.name===a.name)||o.addHandler(a,t))}return(r||i)&&o&&(o.addTags(r??[]),o.addTags(i??[],!1)),(a||n)&&o&&(o.addMetadata(a??{}),o.addMetadata(n??{},!1)),o}}function t6(e){return"name"in e?e:tS.fromMethods(e)}class t8{getStore(){}run(e,t){return t()}enterWith(e){}}let t7=new t8,re=Symbol.for("lc:child_config");class rt{getInstance(){return tJ()??t7}getRunnableConfig(){let e=this.getInstance();return e.getStore()?.extra?.[re]}runWithConfig(e,t,r){let i;let a=t3._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),n=this.getInstance(),s=n.getStore(),o=a?.getParentRunId(),l=a?.handlers?.find(e=>e?.name==="langchain_tracer");return l&&o?i=l.getRunTreeWithTracingConfig(o):r||(i=new to({name:"<runnable_lambda>",tracingEnabled:!1})),i&&(i.extra={...i.extra,[re]:e}),void 0!==s&&void 0!==s[tW]&&(void 0===i&&(i={}),i[tW]=s[tW]),n.run(i,t)}initializeGlobalInstance(e){void 0===tJ()&&tZ(e)}}let rr=new rt;async function ri(e){return t3._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function ra(...e){let t={};for(let r of e.filter(e=>!!e))for(let e of Object.keys(r))if("metadata"===e)t[e]={...t[e],...r[e]};else if("tags"===e){let i=t[e]??[];t[e]=[...new Set(i.concat(r[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...r[e]};else if("timeout"===e)void 0===t.timeout?t.timeout=r.timeout:void 0!==r.timeout&&(t.timeout=Math.min(t.timeout,r.timeout));else if("signal"===e)void 0===t.signal?t.signal=r.signal:void 0!==r.signal&&("any"in AbortSignal?t.signal=AbortSignal.any([t.signal,r.signal]):t.signal=r.signal);else if("callbacks"===e){let e=t.callbacks,i=r.callbacks;if(Array.isArray(i)){if(e){if(Array.isArray(e))t.callbacks=e.concat(i);else{let r=e.copy();for(let e of i)r.addHandler(t6(e),!0);t.callbacks=r}}else t.callbacks=i}else if(i){if(e){if(Array.isArray(e)){let r=i.copy();for(let t of e)r.addHandler(t6(t),!0);t.callbacks=r}else t.callbacks=new t3(i._parentRunId,{handlers:e.handlers.concat(i.handlers),inheritableHandlers:e.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(i.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(i.inheritableTags))),metadata:{...e.metadata,...i.metadata}})}else t.callbacks=i}}else t[e]=r[e]??t[e];return t}let rn=new Set(["string","number","boolean"]);function rs(e){let t=rr.getRunnableConfig(),r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){let{runId:e,runName:i,...a}=t;r=Object.entries(a).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)}if(e&&(r=Object.entries(e).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)),r?.configurable)for(let e of Object.keys(r.configurable))rn.has(typeof r.configurable[e])&&!r.metadata?.[e]&&(r.metadata||(r.metadata={}),r.metadata[e]=r.configurable[e]);if(void 0!==r.timeout){if(r.timeout<=0)throw Error("Timeout must be a positive number");let e=AbortSignal.timeout(r.timeout);void 0!==r.signal?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,e])):r.signal=e,delete r.timeout}return r}function ro(e={},{callbacks:t,maxConcurrency:r,recursionLimit:i,runName:a,configurable:n,runId:s}={}){let o=rs(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==i&&(o.recursionLimit=i),void 0!==r&&(o.maxConcurrency=r),void 0!==a&&(o.runName=a),void 0!==n&&(o.configurable={...o.configurable,...n}),void 0!==s&&delete o.runId,o}function rl(e){return e?{configurable:e.configurable,recursionLimit:e.recursionLimit,callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,maxConcurrency:e.maxConcurrency,timeout:e.timeout,signal:e.signal}:void 0}async function ru(e,t){let r;return void 0===t?e:Promise.race([e.catch(e=>{if(!t?.aborted)throw e}),new Promise((e,i)=>{r=()=>{i(Error("Aborted"))},t.addEventListener("abort",r),t.aborted&&i(Error("Aborted"))})]).finally(()=>t.removeEventListener("abort",r))}class rc extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();if(e.done)return this.reader.releaseLock(),{done:!0,value:void 0};return{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let t=e.getReader();return new rc({start:e=>(function r(){return t.read().then(({done:t,value:i})=>{if(t){e.close();return}return e.enqueue(i),r()})})(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new rc({async pull(t){let{value:r,done:i}=await e.next();i&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function rd(e,t=2){let r=Array.from({length:t},()=>[]);return r.map(async function*(t){for(;;)if(0===t.length){let t=await e.next();for(let e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}})}class rh{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{rr.runWithConfig(rl(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(e=>t(void 0),r)},!0)})}async next(...e){return(this.signal?.throwIfAborted(),this.firstResultUsed)?rr.runWithConfig(rl(this.config),this.signal?async()=>ru(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}}async function rp(e,t,r,i,...a){let n=new rh({generator:t,startSetup:r,signal:i}),s=await n.setup;return{output:e(n,s,...a),setup:s}}class rf{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=H({},t);return new rm({ops:t,state:r[r.length-1].newDocument})}}class rm extends rf{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=H(this.state,e.ops);return new rm({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let t=H({},e.ops);return new rm({ops:e.ops,state:t[t.length-1].newDocument})}}let rg=e=>"log_stream_tracer"===e.name;async function ry(e,t){if("original"===t)throw Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:r}=e;return["retriever","llm","prompt"].includes(e.run_type)?r:1!==Object.keys(r).length||r?.input!==""?r.input:void 0}async function rb(e,t){let{outputs:r}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?r:void 0!==r&&1===Object.keys(r).length&&r?.output!==void 0?r.output:r}class r_ extends t${constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=rc.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let t=this.keyMapByRunId[e];t&&await this.writer.write(new rf({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new rf({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(r.inputs=await ry(e,this._schemaFormat)),await this.writer.write(new rf({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(void 0===t)return;let r=[];"streaming_events"===this._schemaFormat&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await ry(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await rb(e,this._schemaFormat)}),void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let i=new rf({ops:r});await this.writer.write(i)}finally{if(e.id===this.rootId){let t=new rf({ops:[{op:"replace",path:"/final_output",value:await rb(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let i;let a=this.keyMapByRunId[e.id];if(void 0===a)return;if(void 0!==e.inputs.messages){var n;i=void 0!==(n=r?.chunk)&&void 0!==n.message?r?.chunk:new tB({id:`run-${e.id}`,content:t})}else i=t;let s=new rf({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${a}/streamed_output/-`,value:i}]});await this.writer.write(s)}}class rv{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new rv({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}function rw({name:e,serialized:t}){return void 0!==e?e:t?.name!==void 0?t.name:t?.id!==void 0&&Array.isArray(t?.id)?t.id[t.id.length-1]:"Unnamed"}let rE=e=>"event_stream_tracer"===e.name;class rO extends t${constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=rc.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.runType)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.runType)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){let r=await t.next();if(r.done)return;let i=this.runInfoMap.get(e);if(void 0===i){yield r.value;return}function a(e,t){return"llm"===e&&"string"==typeof t?new rv({text:t}):t}let n=this.tappedPromises.get(e);if(void 0===n){let s;n=new Promise(e=>{s=e}),this.tappedPromises.set(e,n);try{let n={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};for await(let e of(await this.send({...n,data:{chunk:a(i.runType,r.value)}},i),yield r.value,t))"tool"!==i.runType&&"retriever"!==i.runType&&await this.send({...n,data:{chunk:a(i.runType,e)}},i),yield e}finally{s()}}else for await(let e of(yield r.value,t))yield e}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let r=this.tappedPromises.get(e.run_id);void 0!==r?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=rw(e),r=void 0!==e.inputs.messages?"chat_model":"llm",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,i);let a=`on_${r}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onLLMNewToken(e,t,r){let i,a;let n=this.runInfoMap.get(e.id);if(void 0===n)throw Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===n.runType)a="on_chat_model_stream",i=r?.chunk===void 0?new tB({content:t,id:`run-${e.id}`}):r.chunk.message;else if("llm"===n.runType)a="on_llm_stream",i=r?.chunk===void 0?new rv({text:t}):r.chunk;else throw Error(`Unexpected run type ${n.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}}async onLLMEnd(e){let t,r;let i=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===i)throw Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let a=e.outputs?.generations;if("chat_model"===i.runType){for(let e of a??[]){if(void 0!==r)break;r=e[0]?.message}t="on_chat_model_end"}else if("llm"===i.runType)r={generations:a?.map(e=>e.map(e=>({text:e.text,generationInfo:e.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},t="on_llm_end";else throw Error(`onLLMEnd: Unexpected run type: ${i.runType}`);await this.sendEndEvent({event:t,data:{output:r,input:i.inputs},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}async onChainStart(e){let t=rw(e),r=e.run_type??"chain",i={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},a={};""===e.inputs.input&&1===Object.keys(e.inputs).length?(a={},i.inputs={}):void 0!==e.inputs.input?(a.input=e.inputs.input,i.inputs=e.inputs.input):(a.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),await this.send({event:`on_${r}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},i)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,i=e.inputs??t.inputs??{},a={output:e.outputs?.output??e.outputs,input:i};i.input&&1===Object.keys(i).length&&(a.input=i.input,t.inputs=i.input),await this.sendEndEvent({event:r,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=rw(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(void 0===t.inputs)throw Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=rw(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,r),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){let i=this.runInfoMap.get(r);if(void 0===i)throw Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:i.tags,metadata:i.metadata,data:t},i)}async finish(){Promise.all([...this.tappedPromises.values()]).finally(()=>{this.writer.close()})}}let rS=[400,401,402,403,404,405,406,407,409],rT=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&rS.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};class rA{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??rT;let t=eC.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>_(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}class rx extends t${constructor({config:e,onStart:t,onEnd:r,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){!this.rootId&&(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function rI(e){return!!e&&e.lc_runnable}class r${constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags,i=e.tags??[];return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(t)),void 0!==this.includeTags&&(r=r||i.some(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(r=r&&i.every(e=>!this.excludeTags?.includes(e))),r}}function rR(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}let rP=["*","_","`"];async function rj(e,t){let{backgroundColor:r="white"}=t??{},i=btoa(e);void 0===r||/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`);let a=`https://mermaid.ink/img/${i}?bgColor=${r}`,n=await fetch(a);if(!n.ok)throw Error(`Failed to render the graph using the Mermaid.INK API.
Status code: ${n.status}
Status text: ${n.statusText}`);return await n.blob()}var rN=r(51253);let rC=Symbol("Let zodToJsonSchema decide on which parser to use"),rk={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},rL=e=>"string"==typeof e?{...rk,name:e}:{...rk,...e},rM=e=>{let t=rL(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,flags:{hasReferencedOpenAiAnyType:!1},currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}},rD=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function rU(e){if("openAi"!==e.target)return{};let t=[...e.basePath,e.definitionPath,e.openAiAnyTypeName];return e.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===e.$refStrategy?rD(t,e.currentPath):t.join("/")}}function rF(e,t,r,i){i?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function rz(e,t,r,i,a){e[t]=r,rF(e,t,i,a)}function rB(e,t){return r3(e.type._def,t)}let rH=(e,t)=>r3(e.innerType._def,t),rG=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let i of e.checks)switch(i.kind){case"min":rz(r,"minimum",i.value,i.message,t);break;case"max":rz(r,"maximum",i.value,i.message,t)}return r},rq=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,rW={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===u&&(u=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),u),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function rZ(e,t){let r={type:"string"};if(e.checks)for(let i of e.checks)switch(i.kind){case"min":rz(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t);break;case"max":rz(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"email":switch(t.emailStrategy){case"format:email":rK(r,"email",i.message,t);break;case"format:idn-email":rK(r,"idn-email",i.message,t);break;case"pattern:zod":rX(r,rW.email,i.message,t)}break;case"url":rK(r,"uri",i.message,t);break;case"uuid":rK(r,"uuid",i.message,t);break;case"regex":rX(r,i.regex,i.message,t);break;case"cuid":rX(r,rW.cuid,i.message,t);break;case"cuid2":rX(r,rW.cuid2,i.message,t);break;case"startsWith":rX(r,RegExp(`^${rJ(i.value,t)}`),i.message,t);break;case"endsWith":rX(r,RegExp(`${rJ(i.value,t)}$`),i.message,t);break;case"datetime":rK(r,"date-time",i.message,t);break;case"date":rK(r,"date",i.message,t);break;case"time":rK(r,"time",i.message,t);break;case"duration":rK(r,"duration",i.message,t);break;case"length":rz(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t),rz(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"includes":rX(r,RegExp(rJ(i.value,t)),i.message,t);break;case"ip":"v6"!==i.version&&rK(r,"ipv4",i.message,t),"v4"!==i.version&&rK(r,"ipv6",i.message,t);break;case"base64url":rX(r,rW.base64url,i.message,t);break;case"jwt":rX(r,rW.jwt,i.message,t);break;case"cidr":"v6"!==i.version&&rX(r,rW.ipv4Cidr,i.message,t),"v4"!==i.version&&rX(r,rW.ipv6Cidr,i.message,t);break;case"emoji":rX(r,rW.emoji(),i.message,t);break;case"ulid":rX(r,rW.ulid,i.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":rK(r,"binary",i.message,t);break;case"contentEncoding:base64":rz(r,"contentEncoding","base64",i.message,t);break;case"pattern:zod":rX(r,rW.base64,i.message,t)}break;case"nanoid":rX(r,rW.nanoid,i.message,t)}return r}function rJ(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)rV.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let rV=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function rK(e,t,r,i){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&i.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&i.errorMessages&&{errorMessage:{format:r}}})):rz(e,"format",t,r,i)}function rX(e,t,r,i){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&i.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:rY(t,i),...r&&i.errorMessages&&{errorMessage:{pattern:r}}})):rz(e,"pattern",rY(t,i),r,i)}function rY(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},i=r.i?e.source.toLowerCase():e.source,a="",n=!1,s=!1,o=!1;for(let e=0;e<i.length;e++){if(n){a+=i[e],n=!1;continue}if(r.i){if(s){if(i[e].match(/[a-z]/)){o?(a+=i[e]+`${i[e-2]}-${i[e]}`.toUpperCase(),o=!1):"-"===i[e+1]&&i[e+2]?.match(/[a-z]/)?(a+=i[e],o=!0):a+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){a+=`[${i[e]}${i[e].toUpperCase()}]`;continue}}if(r.m){if("^"===i[e]){a+=`(^|(?<=[\r
]))`;continue}if("$"===i[e]){a+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===i[e]){a+=s?`${i[e]}\r
`:`[${i[e]}\r
]`;continue}a+=i[e],"\\"===i[e]?n=!0:s&&"]"===i[e]?s=!1:s||"["!==i[e]||(s=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return a}function rQ(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===b.pA.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,i)=>({...r,[i]:r3(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",i]})??rU(t)}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:r3(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===b.pA.ZodString&&e.keyType._def.checks?.length){let{type:i,...a}=rZ(e.keyType._def,t);return{...r,propertyNames:a}}if(e.keyType?._def.typeName===b.pA.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===b.pA.ZodBranded&&e.keyType._def.type._def.typeName===b.pA.ZodString&&e.keyType._def.type._def.checks?.length){let{type:i,...a}=rB(e.keyType._def,t);return{...r,propertyNames:a}}return r}let r0={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},r1=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>r3(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},r2=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return r3(e.innerType._def,t);let r=r3(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:rU(t)},r]}:rU(t)},r9=(e,t)=>{if("input"===t.pipeStrategy)return r3(e.in._def,t);if("output"===t.pipeStrategy)return r3(e.out._def,t);let r=r3(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),i=r3(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,i].filter(e=>void 0!==e)}},r4=(e,t)=>r3(e.innerType._def,t),r5=(e,t,r)=>{switch(t){case b.pA.ZodString:return rZ(e,r);case b.pA.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let i of e.checks)switch(i.kind){case"int":r.type="integer",rF(r,"type",i.message,t);break;case"min":"jsonSchema7"===t.target?i.inclusive?rz(r,"minimum",i.value,i.message,t):rz(r,"exclusiveMinimum",i.value,i.message,t):(i.inclusive||(r.exclusiveMinimum=!0),rz(r,"minimum",i.value,i.message,t));break;case"max":"jsonSchema7"===t.target?i.inclusive?rz(r,"maximum",i.value,i.message,t):rz(r,"exclusiveMaximum",i.value,i.message,t):(i.inclusive||(r.exclusiveMaximum=!0),rz(r,"maximum",i.value,i.message,t));break;case"multipleOf":rz(r,"multipleOf",i.value,i.message,t)}return r}(e,r);case b.pA.ZodObject:return function(e,t){let r="openAi"===t.target,i={type:"object",properties:{}},a=[],n=e.shape();for(let e in n){let s=n[e];if(void 0===s||void 0===s._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(s);o&&r&&("ZodOptional"===s._def.typeName&&(s=s._def.innerType),s.isNullable()||(s=s.nullable()),o=!1);let l=r3(s._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(i.properties[e]=l,o||a.push(e))}a.length&&(i.required=a);let s=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return r3(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==s&&(i.additionalProperties=s),i}(e,r);case b.pA.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let i of e.checks)switch(i.kind){case"min":"jsonSchema7"===t.target?i.inclusive?rz(r,"minimum",i.value,i.message,t):rz(r,"exclusiveMinimum",i.value,i.message,t):(i.inclusive||(r.exclusiveMinimum=!0),rz(r,"minimum",i.value,i.message,t));break;case"max":"jsonSchema7"===t.target?i.inclusive?rz(r,"maximum",i.value,i.message,t):rz(r,"exclusiveMaximum",i.value,i.message,t):(i.inclusive||(r.exclusiveMaximum=!0),rz(r,"maximum",i.value,i.message,t));break;case"multipleOf":rz(r,"multipleOf",i.value,i.message,t)}return r}(e,r);case b.pA.ZodBoolean:return{type:"boolean"};case b.pA.ZodDate:return function e(t,r,i){let a=i??r.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((i,a)=>e(t,r,i))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return rG(t,r)}}(e,r);case b.pA.ZodUndefined:return{not:rU(r)};case b.pA.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case b.pA.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==b.pA.ZodAny&&(r.items=r3(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&rz(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&rz(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(rz(r,"minItems",e.exactLength.value,e.exactLength.message,t),rz(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case b.pA.ZodUnion:case b.pA.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return r1(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in r0&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=r0[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return r1(e,t)}(e,r);case b.pA.ZodIntersection:return function(e,t){let r=[r3(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),r3(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),i="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,a=[];return r.forEach(e=>{if(rq(e))a.push(...e.allOf),void 0===e.unevaluatedProperties&&(i=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...i}=e;t=i}else i=void 0;a.push(t)}}),a.length?{allOf:a,...i}:void 0}(e,r);case b.pA.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>r3(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:r3(e.rest._def,{...r,currentPath:[...r.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>r3(e._def,{...r,currentPath:[...r.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case b.pA.ZodRecord:return rQ(e,r);case b.pA.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case b.pA.ZodEnum:return{type:"string",enum:Array.from(e.values)};case b.pA.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),i=Array.from(new Set(r.map(e=>typeof e)));return{type:1===i.length?"string"===i[0]?"string":"number":["string","number"],enum:r}}(e);case b.pA.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:r0[e.innerType._def.typeName],nullable:!0}:{type:[r0[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=r3(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=r3(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case b.pA.ZodOptional:return r2(e,r);case b.pA.ZodMap:return"record"===r.mapStrategy?rQ(e,r):{type:"array",maxItems:125,items:{type:"array",items:[r3(e.keyType._def,{...r,currentPath:[...r.currentPath,"items","items","0"]})||rU(r),r3(e.valueType._def,{...r,currentPath:[...r.currentPath,"items","items","1"]})||rU(r)],minItems:2,maxItems:2}};case b.pA.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:r3(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&rz(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&rz(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case b.pA.ZodLazy:return()=>e.getter()._def;case b.pA.ZodPromise:return r3(e.type._def,r);case b.pA.ZodNaN:case b.pA.ZodNever:return"openAi"===r.target?void 0:{not:rU({...r,currentPath:[...r.currentPath,"not"]})};case b.pA.ZodEffects:return"input"===r.effectStrategy?r3(e.schema._def,r):rU(r);case b.pA.ZodAny:case b.pA.ZodUnknown:return rU(r);case b.pA.ZodDefault:return{...r3(e.innerType._def,r),default:e.defaultValue()};case b.pA.ZodBranded:return rB(e,r);case b.pA.ZodReadonly:return r4(e,r);case b.pA.ZodCatch:return rH(e,r);case b.pA.ZodPipeline:return r9(e,r);case b.pA.ZodFunction:case b.pA.ZodVoid:case b.pA.ZodSymbol:default:return}};function r3(e,t,r=!1){let i=t.seen.get(e);if(t.override){let a=t.override?.(e,t,i,r);if(a!==rC)return a}if(i&&!r){let e=r6(i,t);if(void 0!==e)return e}let a={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,a);let n=r5(e,e.typeName,t),s="function"==typeof n?r3(n(),t):n;if(s&&r8(e,t,s),t.postProcess){let r=t.postProcess(s,e,t);return a.jsonSchema=s,r}return a.jsonSchema=s,s}let r6=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:rD(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),rU(t);return"seen"===t.$refStrategy?rU(t):void 0}},r8=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),r7=(e,t)=>{let r=rM(t),i="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,i])=>({...e,[t]:r3(i._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??rU(r)}),{}):void 0,a="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,n=r3(e._def,void 0===a?r:{...r,currentPath:[...r.basePath,r.definitionPath,a]},!1)??rU(r),s="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==s&&(n.title=s),r.flags.hasReferencedOpenAiAnyType&&(i||(i={}),i[r.openAiAnyTypeName]||(i[r.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===r.$refStrategy?"1":[...r.basePath,r.definitionPath,r.openAiAnyTypeName].join("/")}}));let o=void 0===a?i?{...n,[r.definitionPath]:i}:n:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...i,[a]:n}};return"jsonSchema7"===r.target?o.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};new URL("undefined"!=typeof self&&self.location&&"null"!==self.location.origin?self.location.origin+self.location.pathname+location.search:"https://github.com/cfworker");let ie=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function it(e){return e.test.bind(e)}(function(e,t){let r=t.match(ie);if(!r)return!1;let i=+r[1],a=+r[2],n=+r[3],s=!!r[5];return(i<=23&&a<=59&&n<=59||23==i&&59==a&&60==n)&&(!e||s)}).bind(void 0,!1),it(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),it(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),it(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),it(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),it(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),it(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),it(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),it(/^(?:\/(?:[^~/]|~0|~1)*)*$/),it(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),it(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/),(h=m||(m={}))[h.Flag=1]="Flag",h[h.Basic=2]="Basic",h[h.Detailed=4]="Detailed";var ir=r(75219),ii=r(86745),ia=r(55422),is=r(14317),io=r(84967);function il(e){if("object"!=typeof e||null===e||!("_zod"in e))return!1;let t=e._zod;return"object"==typeof t&&null!==t&&"def"in t}function iu(e){if("object"!=typeof e||null===e||!("_def"in e)||"_zod"in e)return!1;let t=e._def;return"object"==typeof t&&null!=t&&"typeName"in t}async function ic(e,t){if(il(e))return(0,ir.Qc)(e,t);if(iu(e))return e.parse(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function id(e){return!!il(e)&&"object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"object"===e._zod.def.type}function ih(e){return!!il(e)&&"object"==typeof e&&null!==e&&"_zod"in e&&"object"==typeof e._zod&&null!==e._zod&&"def"in e._zod&&"object"==typeof e._zod.def&&null!==e._zod.def&&"type"in e._zod.def&&"array"===e._zod.def.type}class ip{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=V(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...rI(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...function(e){if(il(e)){let t=function e(t,r=!1){if(iu(t))return iu(t)&&"typeName"in t._def&&"ZodEffects"===t._def.typeName?e(t._def.schema,r):t;if(il(t)){let i=t;if(il(t)&&"pipe"===t._zod.def.type&&(i=e(t._zod.def.in,r)),r){if(id(i)){let t=i._zod.def.shape;for(let[a,n]of Object.entries(i._zod.def.shape))t[a]=e(n,r);i=(0,ia.clone)(i,{...i._zod.def,shape:t})}else if(ih(i)){let t=e(i._zod.def.element,r);i=(0,ia.clone)(i,{...i._zod.def,element:t})}}let a=ii.$Z.get(t);return a&&ii.$Z.add(i,a),i}throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}(e,!0);if(!id(t))return(0,rN.a)(e);{let e=function e(t,r=!1){if(iu(t))return t.strict();if(id(t)){let i=t._zod.def.shape;if(r)for(let[a,n]of Object.entries(t._zod.def.shape)){if(id(n)){let t=e(n,r);i[a]=t}else if(ih(n)){let t=n._zod.def.element;id(t)&&(t=e(t,r)),i[a]=(0,ia.clone)(n,{...n._zod.def,element:t})}else i[a]=n;let t=ii.$Z.get(n);t&&ii.$Z.add(i[a],t)}let a=(0,ia.clone)(t,{...t._zod.def,shape:i,catchall:(0,is.Pm)(io.EL)}),n=ii.$Z.get(t);return n&&ii.$Z.add(a,n),a}throw Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}(t,!0);return(0,rN.a)(e)}}return iu(e)?r7(e):e}(t.data.schema),title:t.data.name}}})),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return void 0!==t.data&&(r.data=t.data),void 0!==t.conditional&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(void 0!==t&&void 0!==this.nodes[t])throw Error(`Node with id ${t} already exists`);let i=t??T(),a={id:i,data:e,name:function(e,t){if(void 0!==e&&!V(e))return e;if(!rI(t))return t.name??"UnknownSchema";try{let e=t.getName();return e=e.startsWith("Runnable")?e.slice(8):e}catch(e){return t.getName()}}(t,e),metadata:r};return this.nodes[i]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,i){if(void 0===this.nodes[e.id])throw Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw Error(`Target node ${t.id} not in graph`);let a={source:e.id,target:t.id,data:r,conditional:i};return this.edges.push(a),a}firstNode(){return im(this)}lastNode(){return ig(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(e=>e.id).every(V)&&(r="");let i=e=>r?`${r}:${e}`:e;Object.entries(e.nodes).forEach(([e,t])=>{this.nodes[i(e)]={...t,id:i(e)}});let a=e.edges.map(e=>({...e,source:i(e.source),target:i(e.target)}));this.edges=[...this.edges,...a];let n=e.firstNode(),s=e.lastNode();return[n?{id:i(n.id),data:n.data}:void 0,s?{id:i(s.id),data:s.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&im(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&ig(this,[e.id])&&this.removeNode(e)}reid(){let e=Object.fromEntries(Object.values(this.nodes).map(e=>[e.id,e.name])),t=new Map;Object.values(e).forEach(e=>{t.set(e,(t.get(e)||0)+1)});let r=r=>{let i=e[r];return V(r)&&1===t.get(i)?i:r};return new ip({nodes:Object.fromEntries(Object.entries(this.nodes).map(([e,t])=>[r(e),{...t,id:r(e)}])),edges:this.edges.map(e=>({...e,source:r(e.source),target:r(e.target)}))})}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:i={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},n=this.reid(),s=n.firstNode(),o=n.lastNode();return function(e,t,r){let{firstNode:i,lastNode:a,nodeColors:n,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=r??{},u=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:"graph TD;\n";if(s){let t="default",r={[t]:"{0}({1})"};for(let[n,s]of(void 0!==i&&(r[i]="{0}([{1}]):::first"),void 0!==a&&(r[a]="{0}([{1}]):::last"),Object.entries(e))){let e=s.name.split(":").pop()??"",i=rP.some(t=>e.startsWith(t)&&e.endsWith(t))?`<p>${e}</p>`:e;Object.keys(s.metadata??{}).length&&(i+=`<hr/><small><em>${Object.entries(s.metadata??{}).map(([e,t])=>`${e} = ${t}`).join("\n")}</em></small>`);let a=(r[n]??r[t]).replace("{0}",rR(n)).replace("{1}",i);u+=`	${a}
`}}let c={};for(let e of t){let t=e.source.split(":"),r=e.target.split(":"),i=t.filter((e,t)=>e===r[t]).join(":");c[i]||(c[i]=[]),c[i].push(e)}let d=new Set;function h(e,t){let r=1===e.length&&e[0].source===e[0].target;if(t&&!r){let e=t.split(":").pop();if(d.has(e))throw Error(`Found duplicate subgraph '${e}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(e),u+=`	subgraph ${e}
`}for(let t of e){let{source:e,target:r,data:i,conditional:a}=t,n="";if(void 0!==i){let e=i,t=e.split(" ");t.length>l&&(e=Array.from({length:Math.ceil(t.length/l)},(e,r)=>t.slice(r*l,(r+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),n=a?` -. &nbsp;${e}&nbsp; .-> `:` -- &nbsp;${e}&nbsp; --> `}else n=a?" -.-> ":" --> ";u+=`	${rR(e)}${n}${rR(r)};
`}for(let e in c)e.startsWith(`${t}:`)&&e!==t&&h(c[e],e);t&&!r&&(u+="	end\n")}for(let e in h(c[""]??[],""),c)e.includes(":")||""===e||h(c[e],e);return s&&(u+=function(e){let t="";for(let[r,i]of Object.entries(e))t+=`	classDef ${r} ${i};
`;return t}(n??{})),u}(n.nodes,n.edges,{firstNode:s?.id,lastNode:o?.id,withStyles:t,curveStyle:r,nodeColors:i,wrapLabelNWords:a})}async drawMermaidPng(e){return rj(this.drawMermaid(e),{backgroundColor:e?.backgroundColor})}}function im(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.source)).map(e=>e.target)),i=[];for(let a of Object.values(e.nodes))t.includes(a.id)||r.has(a.id)||i.push(a);return 1===i.length?i[0]:void 0}function ig(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.target)).map(e=>e.source)),i=[];for(let a of Object.values(e.nodes))t.includes(a.id)||r.has(a.id)||i.push(a);return 1===i.length?i[0]:void 0}function iy(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}let ib=e=>null!=e&&"object"==typeof e&&"next"in e&&"function"==typeof e.next;function i_(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*iv(e,t){for(;;){let{value:r,done:i}=rr.runWithConfig(rl(e),t.next.bind(t),!0);if(i)break;yield r}}async function*iw(e,t){let r=t[Symbol.asyncIterator]();for(;;){let{value:i,done:a}=await rr.runWithConfig(rl(e),r.next.bind(t),!0);if(a)break;yield i}}class iE extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function iO(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class iS extends tf{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new iT({bound:this,kwargs:e,config:{}})}map(){return new iA({bound:this})}withRetry(e){return new ix({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new iT({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new ij({runnable:this,fallbacks:Array.isArray(e)?e:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(rs);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([e])=>"runId"!==e));return Array.from({length:t},(t,i)=>rs(0===i?e:r))}return Array.from({length:t},()=>rs(e))}async batch(e,t,r){let i=this._getOptionsList(t??{},e.length),a=new rA({maxConcurrency:i[0]?.maxConcurrency??r?.maxConcurrency,onFailedAttempt:e=>{throw e}});return Promise.all(e.map((e,t)=>a.call(async()=>{try{return await this.invoke(e,i[t])}catch(e){if(r?.returnExceptions)return e;throw e}})))}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=rs(t),i=new rh({generator:this._streamIterator(e,r),config:r});return await i.setup,rc.fromAsyncGenerator(i)}_separateRunnableConfigFromCallOptions(e){let t;t=void 0===e?rs(e):rs({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){let i;let a=rs(r),n=await ri(a),s=await n?.handleChainStart(this.toJSON(),iO(t,"input"),a.runId,a?.runType,void 0,void 0,a?.runName??this.getName());delete a.runId;try{let n=e.call(this,t,a,s);i=await ru(n,r?.signal)}catch(e){throw await s?.handleChainError(e),e}return await s?.handleChainEnd(iO(i,"output")),i}async _batchWithConfig(e,t,r,i){let a;let n=this._getOptionsList(r??{},t.length),s=await Promise.all(n.map(ri)),o=await Promise.all(s.map(async(e,r)=>{let i=await e?.handleChainStart(this.toJSON(),iO(t[r],"input"),n[r].runId,n[r].runType,void 0,void 0,n[r].runName??this.getName());return delete n[r].runId,i}));try{let r=e.call(this,t,n,o,i);a=await ru(r,n?.[0]?.signal)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(iO(a,"output")))),a}_concatOutputChunks(e,t){return function e(t,r){if(Array.isArray(t)&&Array.isArray(r))return t.concat(r);if("string"==typeof t&&"string"==typeof r||"number"==typeof t&&"number"==typeof r)return t+r;if("concat"in t&&"function"==typeof t.concat)return t.concat(r);if("object"==typeof t&&"object"==typeof r){let i={...t};for(let[t,a]of Object.entries(r))t in i&&!Array.isArray(i[t])?i[t]=e(i[t],a):i[t]=a;return i}throw Error(`Cannot concat ${typeof t} and ${typeof r}`)}(e,t)}async *_transformStreamWithConfig(e,t,r){let i,a,n;let s=!0,o=!0,l=rs(r),u=await ri(l),c=this;async function*d(){for await(let t of e){if(s){if(void 0===i)i=t;else try{i=c._concatOutputChunks(i,t)}catch{i=void 0,s=!1}}yield t}}try{let e=await rp(t.bind(this),d(),async()=>u?.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),r?.signal,l);delete l.runId,n=e.setup;let i=n?.handlers.find(rE),s=e.output;void 0!==i&&void 0!==n&&(s=i.tapOutputIterable(n.runId,s));let c=n?.handlers.find(rg);for await(let e of(void 0!==c&&void 0!==n&&(s=c.tapOutputIterable(n.runId,s)),s))if(yield e,o){if(void 0===a)a=e;else try{a=this._concatOutputChunks(a,e)}catch{a=void 0,o=!1}}}catch(e){throw await n?.handleChainError(e,void 0,void 0,void 0,{inputs:iO(i,"input")}),e}await n?.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:iO(i,"input")})}getGraph(e){let t=new ip,r=t.addNode({name:`${this.getName()}Input`,schema:b.Yj()}),i=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:b.Yj()});return t.addEdge(r,i),t.addEdge(i,a),t}pipe(e){return new iI({first:this,last:iN(e)})}pick(e){return this.pipe(new ik(e))}assign(e){return this.pipe(new iC(new i$({steps:e})))}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:this._concatOutputChunks(r,t);yield*this._streamIterator(r,rs(t))}async *streamLog(e,t,r){let i=new r_({...r,autoClose:!1,_schemaFormat:"original"}),a=rs(t);yield*this._streamLog(e,i,a)}async *_streamLog(e,t,r){let{callbacks:i}=r;if(void 0===i)r.callbacks=[t];else if(Array.isArray(i))r.callbacks=i.concat([t]);else{let e=i.copy();e.addHandler(t,!0),r.callbacks=e}let a=this.stream(e,r),n=async function(){try{for await(let e of(await a)){let r=new rf({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await t.writer.write(r)}}finally{await t.writer.close()}}();try{for await(let e of t)yield e}finally{await n}}streamEvents(e,t,r){let i;if("v1"===t.version)i=this._streamEventsV1(e,t,r);else if("v2"===t.version)i=this._streamEventsV2(e,t,r);else throw Error('Only versions "v1" and "v2" of the schema are currently supported.');return"text/event-stream"===t.encoding?function(e){let t=new TextEncoder,r=new ReadableStream({async start(r){for await(let i of e)r.enqueue(t.encode(`event: data
data: ${JSON.stringify(i)}

`));r.enqueue(t.encode("event: end\n\n")),r.close()}});return rc.fromReadableStream(r)}(i):rc.fromAsyncGenerator(i)}async *_streamEventsV2(e,t,r){let i;let a=new rO({...r,autoClose:!1}),n=rs(t),s=n.runId??T();n.runId=s;let o=n.callbacks;if(void 0===o)n.callbacks=[a];else if(Array.isArray(o))n.callbacks=o.concat(a);else{let e=o.copy();e.addHandler(a,!0),n.callbacks=e}let l=new AbortController,u=this,c=async function(){let r;let i=null;try{t?.signal?"any"in AbortSignal?r=AbortSignal.any([l.signal,t.signal]):(r=t.signal,i=()=>{l.abort()},t.signal.addEventListener("abort",i,{once:!0})):r=l.signal;let o=await u.stream(e,{...n,signal:r});for await(let e of a.tapOutputIterable(s,o))if(l.signal.aborted)break}finally{await a.finish(),r&&i&&r.removeEventListener("abort",i)}}(),d=!1;try{for await(let t of a){if(!d){t.data.input=e,d=!0,i=t.run_id,yield t;continue}t.run_id===i&&t.event.endsWith("_end")&&t.data?.input&&delete t.data.input,yield t}}finally{l.abort(),await c}}async *_streamEventsV1(e,t,r){let i;let a=!1,n=rs(t),s=n.tags??[],o=n.metadata??{},l=n.runName??this.getName(),u=new r_({...r,autoClose:!1,_schemaFormat:"streaming_events"}),c=new r$({...r});for await(let t of this._streamLog(e,u,n)){if(void 0===(i=i?i.concat(t):rm.fromRunLogPatch(t)).state)throw Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;let t={...i.state},r={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:s,metadata:o,data:{input:e}};c.includeEvent(r,t.type)&&(yield r)}let r=t.ops.filter(e=>e.path.startsWith("/logs/")).map(e=>e.path.split("/")[2]);for(let e of[...new Set(r)]){let t;let r={},a=i.state.logs[e];if("start"==(t=void 0===a.end_time?a.streamed_output.length>0?"stream":"start":"end"))void 0!==a.inputs&&(r.input=a.inputs);else if("end"===t)void 0!==a.inputs&&(r.input=a.inputs),r.output=a.final_output;else if("stream"===t){let e=a.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${a.name}"`);r={chunk:a.streamed_output[0]},a.streamed_output=[]}yield{event:`on_${a.type}_${t}`,name:a.name,run_id:a.id,tags:a.tags,metadata:a.metadata,data:r}}let{state:n}=i;if(n.streamed_output.length>0){let e=n.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${n.name}"`);let t={chunk:n.streamed_output[0]};n.streamed_output=[];let r={event:`on_${n.type}_stream`,run_id:n.id,tags:s,metadata:o,name:l,data:t};c.includeEvent(r,n.type)&&(yield r)}}let d=i?.state;if(void 0!==d){let e={event:`on_${d.type}_end`,name:l,run_id:d.id,tags:s,metadata:o,data:{output:d.final_output}};c.includeEvent(e,d.type)&&(yield e)}}static isRunnable(e){return rI(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new iT({bound:this,config:{},configFactories:[i=>({callbacks:[new rx({config:i,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return function(e,t){var r,i,a;let n=t.name??e.getName(),s=t.description??(il(r=t.schema)?ii.$Z.get(r)?.description:iu(r)||"description"in r&&"string"==typeof r.description?r.description:void 0);return new iL(!(!(a=i=t.schema)||"object"!=typeof a||Array.isArray(a))&&(il(a)||iu(a))&&(iu(i)?"ZodString"===i._def.typeName:!!il(i)&&"string"===i._zod.def.type)?{name:n,description:s,schema:b.Ry({input:b.Z_()}).transform(e=>e.input),bound:e}:{name:n,description:s,schema:t.schema,bound:e})}(this,e)}}class iT extends iS{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=ra(this.config,...e);return ra(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new ix({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(rs(t),this.kwargs))}async batch(e,t,r){let i=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig(rs(e),this.kwargs))):await this._mergeConfig(rs(t),this.kwargs);return this.bound.batch(e,i,r)}_concatOutputChunks(e,t){return this.bound._concatOutputChunks(e,t)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(rs(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(rs(t),this.kwargs))}async *transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(rs(t),this.kwargs))}streamEvents(e,t,r){let i=this,a=async function*(){yield*i.bound.streamEvents(e,{...await i._mergeConfig(rs(t),i.kwargs),version:t.version},r)};return rc.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&iS.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new iT({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new rx({config:i,onStart:e,onEnd:t,onError:r})]})]})}}class iA extends iS{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new iA({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,ro(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new iA({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class ix extends iT{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let i=e>1?`retry:attempt:${e}`:void 0;return ro(t,{callbacks:r?.getChild(i)})}async _invoke(e,t,r){return _(i=>super.invoke(e,this._patchConfigForRetry(i,t,r)),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,i){let a={};try{await _(async n=>{let s;let o=e.map((e,t)=>t).filter(e=>void 0===a[e.toString()]||a[e.toString()]instanceof Error),l=o.map(t=>e[t]),u=o.map(e=>this._patchConfigForRetry(n,t?.[e],r?.[e])),c=await super.batch(l,u,{...i,returnExceptions:!0});for(let e=0;e<c.length;e+=1){let t=c[e],r=o[e];t instanceof Error&&void 0===s&&((s=t).input=l[e]),a[r.toString()]=t}if(s)throw s;return c},{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(i?.returnExceptions!==!0)throw e}return Object.keys(a).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>a[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class iI extends iS{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r;let i=rs(t),a=await ri(i),n=await a?.handleChainStart(this.toJSON(),iO(e,"input"),i.runId,void 0,void 0,void 0,i?.runName);delete i.runId;let s=e;try{let e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){let a=e[r].invoke(s,ro(i,{callbacks:n?.getChild(this.omitSequenceTags?void 0:`seq:step:${r+1}`)}));s=await ru(a,t?.signal)}if(t?.signal?.aborted)throw Error("Aborted");r=await this.last.invoke(s,ro(i,{callbacks:n?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(e){throw await n?.handleChainError(e),e}return await n?.handleChainEnd(iO(r,"output")),r}async batch(e,t,r){let i=this._getOptionsList(t??{},e.length),a=await Promise.all(i.map(ri)),n=await Promise.all(a.map(async(t,r)=>{let a=await t?.handleChainStart(this.toJSON(),iO(e[r],"input"),i[r].runId,void 0,void 0,void 0,i[r].runName);return delete i[r].runId,a})),s=e;try{for(let e=0;e<this.steps.length;e+=1){let t=this.steps[e].batch(s,n.map((t,r)=>{let a=t?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`);return ro(i[r],{callbacks:a})}),r);s=await ru(t,i[0]?.signal)}}catch(e){throw await Promise.all(n.map(t=>t?.handleChainError(e))),e}return await Promise.all(n.map(e=>e?.handleChainEnd(iO(s,"output")))),s}_concatOutputChunks(e,t){return this.last._concatOutputChunks(e,t)}async *_streamIterator(e,t){let r;let i=await ri(t),{runId:a,...n}=t??{},s=await i?.handleChainStart(this.toJSON(),iO(e,"input"),a,void 0,void 0,void 0,n?.runName),o=[this.first,...this.middle,this.last],l=!0;async function*u(){yield e}try{let e=o[0].transform(u(),ro(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let t=1;t<o.length;t+=1){let r=o[t];e=await r.transform(e,ro(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${t+1}`)}))}for await(let i of e)if(t?.signal?.throwIfAborted(),yield i,l){if(void 0===r)r=i;else try{r=this._concatOutputChunks(r,i)}catch(e){r=void 0,l=!1}}}catch(e){throw await s?.handleChainError(e),e}await s?.handleChainEnd(iO(r,"output"))}getGraph(e){let t=new ip,r=null;return this.steps.forEach((i,a)=>{let n=i.getGraph(e);0!==a&&n.trimFirstNode(),a!==this.steps.length-1&&n.trimLastNode(),t.extend(n);let s=n.firstNode();if(!s)throw Error(`Runnable ${i} has no first node`);r&&t.addEdge(r,s),r=n.lastNode()}),t}pipe(e){return new iI(iI.isRunnableSequence(e)?{first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}:{first:this.first,middle:[...this.middle,this.last],last:iN(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&iS.isRunnable(e)}static from([e,...t],r){let i={};return"string"==typeof r?i.name=r:void 0!==r&&(i=r),new iI({...i,first:iN(e),middle:t.slice(0,-1).map(iN),last:iN(t[t.length-1])})}}class i$ extends iS{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){for(let[t,r]of(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={},Object.entries(e.steps)))this.steps[t]=iN(r)}static from(e){return new i$({steps:e})}async invoke(e,t){let r=rs(t),i=await ri(r),a=await i?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let n={};try{let i=Object.entries(this.steps).map(async([t,i])=>{n[t]=await i.invoke(e,ro(r,{callbacks:a?.getChild(`map:key:${t}`)}))});await ru(Promise.all(i),t?.signal)}catch(e){throw await a?.handleChainError(e),e}return await a?.handleChainEnd(n),n}async *_transform(e,t,r){let i={...this.steps},a=rd(e,Object.keys(i).length),n=new Map(Object.entries(i).map(([e,i],n)=>{let s=i.transform(a[n],ro(r,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then(t=>({key:e,gen:s,result:t}))]}));for(;n.size;){let e=Promise.race(n.values()),{key:t,result:i,gen:a}=await ru(e,r?.signal);n.delete(t),i.done||(yield{[t]:i.value},n.set(t,a.next().then(e=>({key:t,gen:a,result:e}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=rs(t),a=new rh({generator:this.transform(r(),i),config:i});return await a.setup,rc.fromAsyncGenerator(a)}}class iR extends iS{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!P(e.func))throw Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[r]=this._getOptionsList(t??{},1),i=await ri(r);return ru(this.func(ro(r,{callbacks:i}),e),r?.signal)}async *_streamIterator(e,t){let[r]=this._getOptionsList(t??{},1),i=await this.invoke(e,t);if(i_(i)){for await(let e of i)r?.signal?.throwIfAborted(),yield e;return}if(ib(i)){for(;;){r?.signal?.throwIfAborted();let e=i.next();if(e.done)break;yield e.value}return}yield i}static from(e){return new iR({func:e})}}class iP extends iS{static lc_name(){return"RunnableLambda"}constructor(e){if(P(e.func))return iR.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){if(P(e))throw Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}(e.func),this.func=e.func}static from(e){return new iP({func:e})}async _invoke(e,t,r){return new Promise((i,a)=>{let n=ro(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??25)-1});rr.runWithConfig(rl(n),async()=>{try{let r=await this.func(e,{...n});if(r&&iS.isRunnable(r)){if(t?.recursionLimit===0)throw Error("Recursion limit reached.");r=await r.invoke(e,{...n,recursionLimit:(n.recursionLimit??25)-1})}else if(i_(r)){let e;for await(let i of iw(n,r))if(t?.signal?.throwIfAborted(),void 0===e)e=i;else try{e=this._concatOutputChunks(e,i)}catch(t){e=i}r=e}else if(iy(r)){let e;for(let i of iv(n,r))if(t?.signal?.throwIfAborted(),void 0===e)e=i;else try{e=this._concatOutputChunks(e,i)}catch(t){e=i}r=e}i(r)}catch(e){a(e)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async *_transform(e,t,r){let i;for await(let t of e)if(void 0===i)i=t;else try{i=this._concatOutputChunks(i,t)}catch(e){i=t}let a=ro(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??25)-1}),n=await new Promise((e,t)=>{rr.runWithConfig(rl(a),async()=>{try{let t=await this.func(i,{...a,config:a});e(t)}catch(e){t(e)}})});if(n&&iS.isRunnable(n)){if(r?.recursionLimit===0)throw Error("Recursion limit reached.");for await(let e of(await n.stream(i,a)))yield e}else if(i_(n))for await(let e of iw(a,n))r?.signal?.throwIfAborted(),yield e;else if(iy(n))for(let e of iv(a,n))r?.signal?.throwIfAborted(),yield e;else yield n}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=rs(t),a=new rh({generator:this.transform(r(),i),config:i});return await a.setup,rc.fromAsyncGenerator(a)}}class ij extends iS{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r=rs(t),i=await ri(r),{runId:a,...n}=r,s=await i?.handleChainStart(this.toJSON(),iO(e,"input"),a,void 0,void 0,void 0,n?.runName),o=ro(n,{callbacks:s?.getChild()});return await rr.runWithConfig(o,async()=>{let t;for(let i of this.runnables()){r?.signal?.throwIfAborted();try{let t=await i.invoke(e,o);return await s?.handleChainEnd(iO(t,"output")),t}catch(e){void 0===t&&(t=e)}}if(void 0===t)throw Error("No error stored at end of fallback.");throw await s?.handleChainError(t),t})}async *_streamIterator(e,t){let r,i,a;let n=rs(t),s=await ri(n),{runId:o,...l}=n,u=await s?.handleChainStart(this.toJSON(),iO(e,"input"),o,void 0,void 0,void 0,l?.runName);for(let t of this.runnables()){n?.signal?.throwIfAborted();let a=ro(l,{callbacks:u?.getChild()});try{let r=await t.stream(e,a);i=iw(a,r);break}catch(e){void 0===r&&(r=e)}}if(void 0===i){let e=r??Error("No error stored at end of fallback.");throw await u?.handleChainError(e),e}try{for await(let e of i){yield e;try{a=void 0===a?a:this._concatOutputChunks(a,e)}catch(e){a=void 0}}}catch(e){throw await u?.handleChainError(e),e}await u?.handleChainEnd(iO(a,"output"))}async batch(e,t,r){let i;if(r?.returnExceptions)throw Error("Not implemented.");let a=this._getOptionsList(t??{},e.length),n=await Promise.all(a.map(e=>ri(e))),s=await Promise.all(n.map(async(t,r)=>{let i=await t?.handleChainStart(this.toJSON(),iO(e[r],"input"),a[r].runId,void 0,void 0,void 0,a[r].runName);return delete a[r].runId,i}));for(let t of this.runnables()){a[0].signal?.throwIfAborted();try{let i=await t.batch(e,s.map((e,t)=>ro(a[t],{callbacks:e?.getChild()})),r);return await Promise.all(s.map((e,t)=>e?.handleChainEnd(iO(i[t],"output")))),i}catch(e){void 0===i&&(i=e)}}if(!i)throw Error("No error stored at end of fallbacks.");throw await Promise.all(s.map(e=>e?.handleChainError(i))),i}}function iN(e){if("function"==typeof e)return new iP({func:e});if(iS.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,i]of Object.entries(e))t[r]=iN(i);return new i$({steps:t})}}class iC extends iS{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof i$&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async *_transform(e,t,r){let i=this.mapper.getStepsKeys(),[a,n]=rd(e),s=this.mapper.transform(n,ro(r,{callbacks:t?.getChild()})),o=s.next();for await(let e of a){if("object"!=typeof e||Array.isArray(e))throw Error(`RunnableAssign can only be used with objects as input, got ${typeof e}`);let t=Object.fromEntries(Object.entries(e).filter(([e])=>!i.includes(e)));Object.keys(t).length>0&&(yield t)}for await(let e of(yield(await o).value,s))yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=rs(t),a=new rh({generator:this.transform(r(),i),config:i});return await a.setup,rc.fromAsyncGenerator(a)}}class ik extends iS{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{let t=this.keys.map(t=>[t,e[t]]).filter(e=>void 0!==e[1]);return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async *_transform(e){for await(let t of e){let e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let i=rs(t),a=new rh({generator:this.transform(r(),i),config:i});return await a.setup,rc.fromAsyncGenerator(a)}}class iL extends iT{constructor(e){super({bound:iI.from([iP.from(async e=>{let t;if(e&&"object"==typeof e&&"type"in e&&"tool_call"===e.type)try{t=await ic(this.schema,e.args)}catch(t){throw new iE("Received tool input did not match expected schema",JSON.stringify(e.args))}else t=e;return t}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name}),config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}class iM extends iS{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,t){return this.transformDocuments(e)}}var iD=r(79742),iU=Object.defineProperty,iF=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){for(let[t,r]of(this.patStr=e.pat_str,Object.entries(e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{let[r,i,...a]=t.split(" "),n=Number.parseInt(i,10);return a.forEach((t,r)=>e[t]=n+r),e},{})))){let e=iD.toByteArray(t);this.rankMap.set(e.join(","),r),this.textMap.set(r,e)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e),{})}encode(e,t=[],r="all"){let i=RegExp(this.patStr,"ug"),a=iF.specialTokenRegex(Object.keys(this.specialTokens)),n=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter(e=>!s.has(e)):r);if(o.size>0){let t=iF.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;a.lastIndex=r,!(null==(t=a.exec(e))||s.has(t[0]));)r=t.index+1;let o=t?.index??e.length;for(let t of e.substring(l,o).matchAll(i)){let e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));if(null!=r){n.push(r);continue}n.push(...function(e,t){return 1===e.length?[t.get(e.join(","))]:(function(e,t){let r=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;r.length>1;){let i=null;for(let a=0;a<r.length-1;a++){let n=e.slice(r[a].start,r[a+1].end),s=t.get(n.join(","));null!=s&&(null==i||s<i[0])&&(i=[s,a])}if(null!=i){let e=i[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}else break}return r})(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(e=>null!=e)}(e,this.rankMap))}if(null==t)break;let u=this.specialTokens[t[0]];n.push(u),l=t.index+t[0].length}return n}decode(e){let t=[],r=0;for(let i=0;i<e.length;++i){let a=e[i],n=this.textMap.get(a)??this.inverseSpecialTokens[a];null!=n&&(t.push(n),r+=n.length)}let i=new Uint8Array(r),a=0;for(let e of t)i.set(e,a),a+=e.length;return this.textDecoder.decode(i)}};c="symbol"!=typeof(p="specialTokenRegex")?p+"":p,d=e=>RegExp(e.map(e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"g"),c in iF?iU(iF,c,{enumerable:!0,configurable:!0,writable:!0,value:d}):iF[c]=d;class iz extends iM{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=e?.chunkSize??this.chunkSize,this.chunkOverlap=e?.chunkOverlap??this.chunkOverlap,this.keepSeparator=e?.keepSeparator??this.keepSeparator,this.lengthFunction=e?.lengthFunction??(e=>e.length),this.chunkOverlap>=this.chunkSize)throw Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,t={}){return this.splitDocuments(e,t)}splitOnSeparator(e,t){let r;if(t){if(this.keepSeparator){let i=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(RegExp(`(?=${i})`))}else r=e.split(t)}else r=e.split("");return r.filter(e=>""!==e)}async createDocuments(e,t=[],r={}){let i=t.length>0?t:[...Array(e.length)].map(()=>({})),{chunkHeader:a="",chunkOverlapHeader:n="(cont'd) ",appendChunkOverlapHeader:s=!1}=r,o=[];for(let t=0;t<e.length;t+=1){let r=e[t],l=1,u=null,c=-1;for(let e of(await this.splitText(r))){let d=a,h=r.indexOf(e,c+1);if(null===u)l+=this.numberOfNewLines(r,0,h);else{let e=c+await this.lengthFunction(u);e<h?l+=this.numberOfNewLines(r,e,h):e>h&&(l-=this.numberOfNewLines(r,h,e)),s&&(d+=n)}let p=this.numberOfNewLines(e),f=i[t].loc&&"object"==typeof i[t].loc?{...i[t].loc}:{};f.lines={from:l,to:l+p};let m={...i[t],loc:f};d+=e,o.push(new y({pageContent:d,metadata:m})),l+=p,u=e,c=h}}return o}numberOfNewLines(e,t,r){return(e.slice(t,r).match(/\n/g)||[]).length}async splitDocuments(e,t={}){let r=e.filter(e=>void 0!==e.pageContent),i=r.map(e=>e.pageContent),a=r.map(e=>e.metadata);return this.createDocuments(i,a,t)}joinDocs(e,t){let r=e.join(t).trim();return""===r?null:r}async mergeSplits(e,t){let r=[],i=[],a=0;for(let n of e){let e=await this.lengthFunction(n);if(a+e+i.length*t.length>this.chunkSize&&(a>this.chunkSize&&console.warn(`Created a chunk of size ${a}, +
which is longer than the specified ${this.chunkSize}`),i.length>0)){let n=this.joinDocs(i,t);for(null!==n&&r.push(n);a>this.chunkOverlap||a+e+i.length*t.length>this.chunkSize&&a>0;)a-=await this.lengthFunction(i[0]),i.shift()}i.push(n),a+=e}let n=this.joinDocs(i,t);return null!==n&&r.push(n),r}}class iB extends iz{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:["\n\n","\n"," ",""]}),this.separators=e?.separators??this.separators,this.keepSeparator=e?.keepSeparator??!0}async _splitText(e,t){let r;let i=[],a=t[t.length-1];for(let i=0;i<t.length;i+=1){let n=t[i];if(""===n){a=n;break}if(e.includes(n)){a=n,r=t.slice(i+1);break}}let n=this.splitOnSeparator(e,a),s=[],o=this.keepSeparator?"":a;for(let e of n)if(await this.lengthFunction(e)<this.chunkSize)s.push(e);else{if(s.length){let e=await this.mergeSplits(s,o);i.push(...e),s=[]}if(r){let t=await this._splitText(e,r);i.push(...t)}else i.push(e)}if(s.length){let e=await this.mergeSplits(s,o);i.push(...e)}return i}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,t){return new iB({...t,separators:iB.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if("cpp"===e)return["\nclass ","\nvoid ","\nint ","\nfloat ","\ndouble ","\nif ","\nfor ","\nwhile ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("go"===e)return["\nfunc ","\nvar ","\nconst ","\ntype ","\nif ","\nfor ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("java"===e)return["\nclass ","\npublic ","\nprotected ","\nprivate ","\nstatic ","\nif ","\nfor ","\nwhile ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("js"===e)return["\nfunction ","\nconst ","\nlet ","\nvar ","\nclass ","\nif ","\nfor ","\nwhile ","\nswitch ","\ncase ","\ndefault ","\n\n","\n"," ",""];if("php"===e)return["\nfunction ","\nclass ","\nif ","\nforeach ","\nwhile ","\ndo ","\nswitch ","\ncase ","\n\n","\n"," ",""];if("proto"===e)return["\nmessage ","\nservice ","\nenum ","\noption ","\nimport ","\nsyntax ","\n\n","\n"," ",""];if("python"===e)return["\nclass ","\ndef ","\n	def ","\n\n","\n"," ",""];else if("rst"===e)return["\n===\n","\n---\n","\n***\n","\n.. ","\n\n","\n"," ",""];else if("ruby"===e)return["\ndef ","\nclass ","\nif ","\nunless ","\nwhile ","\nfor ","\ndo ","\nbegin ","\nrescue ","\n\n","\n"," ",""];else if("rust"===e)return["\nfn ","\nconst ","\nlet ","\nif ","\nwhile ","\nfor ","\nloop ","\nmatch ","\nconst ","\n\n","\n"," ",""];else if("scala"===e)return["\nclass ","\nobject ","\ndef ","\nval ","\nvar ","\nif ","\nfor ","\nwhile ","\nmatch ","\ncase ","\n\n","\n"," ",""];else if("swift"===e)return["\nfunc ","\nclass ","\nstruct ","\nenum ","\nif ","\nfor ","\nwhile ","\ndo ","\nswitch ","\ncase ","\n\n","\n"," ",""];else if("markdown"===e)return["\n## ","\n### ","\n#### ","\n##### ","\n###### ","```\n\n","\n\n***\n\n","\n\n---\n\n","\n\n___\n\n","\n\n","\n"," ",""];else if("latex"===e)return["\n\\chapter{","\n\\section{","\n\\subsection{","\n\\subsubsection{","\n\\begin{enumerate}","\n\\begin{itemize}","\n\\begin{description}","\n\\begin{list}","\n\\begin{quote}","\n\\begin{quotation}","\n\\begin{verse}","\n\\begin{verbatim}","\n\\begin{align}","$$","$","\n\n","\n"," ",""];else if("html"===e)return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];else if("sol"===e)return["\npragma ","\nusing ","\ncontract ","\ninterface ","\nlibrary ","\nconstructor ","\ntype ","\nfunction ","\nevent ","\nmodifier ","\nerror ","\nstruct ","\nenum ","\nif ","\nfor ","\nwhile ","\ndo while ","\nassembly ","\n\n","\n"," ",""];else throw Error(`Language ${e} is not supported.`)}}},46475:function(e,t,r){"use strict";r.d(t,{NY:function(){return T},Ee:function(){return S},fC:function(){return O}});var i=r(67294),a=r(85893),n=globalThis?.document?i.useLayoutEffect:()=>{};function s(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}r(73935);var o=Symbol("radix.slottable");function l(e){return i.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===o}var u=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=function(e){let t=function(e){let t=i.forwardRef((e,t)=>{let{children:r,...a}=e;if(i.isValidElement(r)){let e,n;let o=(e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.props.ref:r.props.ref||r.ref,l=function(e,t){let r={...t};for(let i in t){let a=e[i],n=t[i];/^on[A-Z]/.test(i)?a&&n?r[i]=(...e)=>{let t=n(...e);return a(...e),t}:a&&(r[i]=a):"style"===i?r[i]={...a,...n}:"className"===i&&(r[i]=[a,n].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props);return r.type!==i.Fragment&&(l.ref=t?function(...e){return t=>{let r=!1,i=e.map(e=>{let i=s(e,t);return r||"function"!=typeof i||(r=!0),i});if(r)return()=>{for(let t=0;t<i.length;t++){let r=i[t];"function"==typeof r?r():s(e[t],null)}}}}(t,o):o),i.cloneElement(r,l)}return i.Children.count(r)>1?i.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=i.forwardRef((e,r)=>{let{children:n,...s}=e,o=i.Children.toArray(n),u=o.find(l);if(u){let e=u.props.children,n=o.map(t=>t!==u?t:i.Children.count(e)>1?i.Children.only(null):i.isValidElement(e)?e.props.children:null);return(0,a.jsx)(t,{...s,ref:r,children:i.isValidElement(e)?i.cloneElement(e,void 0,n):null})}return(0,a.jsx)(t,{...s,ref:r,children:n})});return r.displayName=`${e}.Slot`,r}(`Primitive.${t}`),n=i.forwardRef((e,i)=>{let{asChild:n,...s}=e,o=n?r:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,a.jsx)(o,{...s,ref:i})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{}),c=r(89234);function d(){return()=>{}}var h="Avatar",[p,f]=function(e,t=[]){let r=[],n=()=>{let t=r.map(e=>i.createContext(e));return function(r){let a=r?.[e]||t;return i.useMemo(()=>({[`__scope${e}`]:{...r,[e]:a}}),[r,a])}};return n.scopeName=e,[function(t,n){let s=i.createContext(n),o=r.length;r=[...r,n];let l=t=>{let{scope:r,children:n,...l}=t,u=r?.[e]?.[o]||s,c=i.useMemo(()=>l,Object.values(l));return(0,a.jsx)(u.Provider,{value:c,children:n})};return l.displayName=t+"Provider",[l,function(r,a){let l=a?.[e]?.[o]||s,u=i.useContext(l);if(u)return u;if(void 0!==n)return n;throw Error(`\`${r}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let a=r.reduce((t,{useScope:r,scopeName:i})=>{let a=r(e)[`__scope${i}`];return{...t,...a}},{});return i.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return r.scopeName=t.scopeName,r}(n,...t)]}(h),[m,g]=p(h),y=i.forwardRef((e,t)=>{let{__scopeAvatar:r,...n}=e,[s,o]=i.useState("idle");return(0,a.jsx)(m,{scope:r,imageLoadingStatus:s,onImageLoadingStatusChange:o,children:(0,a.jsx)(u.span,{...n,ref:t})})});y.displayName=h;var b="AvatarImage",_=i.forwardRef((e,t)=>{let{__scopeAvatar:r,src:s,onLoadingStatusChange:o=()=>{},...l}=e,h=g(b,r),p=function(e,{referrerPolicy:t,crossOrigin:r}){let a=(0,c.useSyncExternalStore)(d,()=>!0,()=>!1),s=i.useRef(null),o=a?(s.current||(s.current=new window.Image),s.current):null,[l,u]=i.useState(()=>E(o,e));return n(()=>{u(E(o,e))},[o,e]),n(()=>{let e=e=>()=>{u(e)};if(!o)return;let i=e("loaded"),a=e("error");return o.addEventListener("load",i),o.addEventListener("error",a),t&&(o.referrerPolicy=t),"string"==typeof r&&(o.crossOrigin=r),()=>{o.removeEventListener("load",i),o.removeEventListener("error",a)}},[o,r,t]),l}(s,l),f=function(e){let t=i.useRef(e);return i.useEffect(()=>{t.current=e}),i.useMemo(()=>(...e)=>t.current?.(...e),[])}(e=>{o(e),h.onImageLoadingStatusChange(e)});return n(()=>{"idle"!==p&&f(p)},[p,f]),"loaded"===p?(0,a.jsx)(u.img,{...l,ref:t,src:s}):null});_.displayName=b;var v="AvatarFallback",w=i.forwardRef((e,t)=>{let{__scopeAvatar:r,delayMs:n,...s}=e,o=g(v,r),[l,c]=i.useState(void 0===n);return i.useEffect(()=>{if(void 0!==n){let e=window.setTimeout(()=>c(!0),n);return()=>window.clearTimeout(e)}},[n]),l&&"loaded"!==o.imageLoadingStatus?(0,a.jsx)(u.span,{...s,ref:t}):null});function E(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}w.displayName=v;var O=y,S=_,T=w},87479:function(e,t,r){"use strict";r.d(t,{Fw:function(){return x},wy:function(){return T},fC:function(){return R}});var i=r(67294),a=r.t(i,2);"undefined"!=typeof window&&window.document&&window.document.createElement;var n=r(85893),s=globalThis?.document?i.useLayoutEffect:()=>{},o=a[" useInsertionEffect ".trim().toString()]||s;function l(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function u(...e){return t=>{let r=!1,i=e.map(e=>{let i=l(e,t);return r||"function"!=typeof i||(r=!0),i});if(r)return()=>{for(let t=0;t<i.length;t++){let r=i[t];"function"==typeof r?r():l(e[t],null)}}}}function c(...e){return i.useCallback(u(...e),e)}Symbol("RADIX:SYNC_STATE"),r(73935);var d=Symbol("radix.slottable");function h(e){return i.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===d}var p=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=function(e){let t=function(e){let t=i.forwardRef((e,t)=>{let{children:r,...a}=e;if(i.isValidElement(r)){let e,n;let s=(e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.props.ref:r.props.ref||r.ref,o=function(e,t){let r={...t};for(let i in t){let a=e[i],n=t[i];/^on[A-Z]/.test(i)?a&&n?r[i]=(...e)=>{let t=n(...e);return a(...e),t}:a&&(r[i]=a):"style"===i?r[i]={...a,...n}:"className"===i&&(r[i]=[a,n].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props);return r.type!==i.Fragment&&(o.ref=t?u(t,s):s),i.cloneElement(r,o)}return i.Children.count(r)>1?i.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=i.forwardRef((e,r)=>{let{children:a,...s}=e,o=i.Children.toArray(a),l=o.find(h);if(l){let e=l.props.children,a=o.map(t=>t!==l?t:i.Children.count(e)>1?i.Children.only(null):i.isValidElement(e)?e.props.children:null);return(0,n.jsx)(t,{...s,ref:r,children:i.isValidElement(e)?i.cloneElement(e,void 0,a):null})}return(0,n.jsx)(t,{...s,ref:r,children:a})});return r.displayName=`${e}.Slot`,r}(`Primitive.${t}`),a=i.forwardRef((e,i)=>{let{asChild:a,...s}=e,o=a?r:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(o,{...s,ref:i})});return a.displayName=`Primitive.${t}`,{...e,[t]:a}},{}),f=e=>{let t,r;let{present:a,children:n}=e,o=function(e){var t,r;let[a,n]=i.useState(),o=i.useRef(null),l=i.useRef(e),u=i.useRef("none"),[c,d]=(t=e?"mounted":"unmounted",r={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},i.useReducer((e,t)=>r[e][t]??e,t));return i.useEffect(()=>{let e=m(o.current);u.current="mounted"===c?e:"none"},[c]),s(()=>{let t=o.current,r=l.current;if(r!==e){let i=u.current,a=m(t);e?d("MOUNT"):"none"===a||t?.display==="none"?d("UNMOUNT"):r&&i!==a?d("ANIMATION_OUT"):d("UNMOUNT"),l.current=e}},[e,d]),s(()=>{if(a){let e;let t=a.ownerDocument.defaultView??window,r=r=>{let i=m(o.current).includes(CSS.escape(r.animationName));if(r.target===a&&i&&(d("ANIMATION_END"),!l.current)){let r=a.style.animationFillMode;a.style.animationFillMode="forwards",e=t.setTimeout(()=>{"forwards"===a.style.animationFillMode&&(a.style.animationFillMode=r)})}},i=e=>{e.target===a&&(u.current=m(o.current))};return a.addEventListener("animationstart",i),a.addEventListener("animationcancel",r),a.addEventListener("animationend",r),()=>{t.clearTimeout(e),a.removeEventListener("animationstart",i),a.removeEventListener("animationcancel",r),a.removeEventListener("animationend",r)}}d("ANIMATION_END")},[a,d]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:i.useCallback(e=>{o.current=e?getComputedStyle(e):null,n(e)},[])}}(a),l="function"==typeof n?n({present:o.isPresent}):i.Children.only(n),u=c(o.ref,(t=Object.getOwnPropertyDescriptor(l.props,"ref")?.get)&&"isReactWarning"in t&&t.isReactWarning?l.ref:(t=Object.getOwnPropertyDescriptor(l,"ref")?.get)&&"isReactWarning"in t&&t.isReactWarning?l.props.ref:l.props.ref||l.ref);return"function"==typeof n||o.isPresent?i.cloneElement(l,{ref:u}):null};function m(e){return e?.animationName||"none"}f.displayName="Presence";var g=a[" useId ".trim().toString()]||(()=>void 0),y=0,b="Collapsible",[_,v]=function(e,t=[]){let r=[],a=()=>{let t=r.map(e=>i.createContext(e));return function(r){let a=r?.[e]||t;return i.useMemo(()=>({[`__scope${e}`]:{...r,[e]:a}}),[r,a])}};return a.scopeName=e,[function(t,a){let s=i.createContext(a),o=r.length;r=[...r,a];let l=t=>{let{scope:r,children:a,...l}=t,u=r?.[e]?.[o]||s,c=i.useMemo(()=>l,Object.values(l));return(0,n.jsx)(u.Provider,{value:c,children:a})};return l.displayName=t+"Provider",[l,function(r,n){let l=n?.[e]?.[o]||s,u=i.useContext(l);if(u)return u;if(void 0!==a)return a;throw Error(`\`${r}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let a=r.reduce((t,{useScope:r,scopeName:i})=>{let a=r(e)[`__scope${i}`];return{...t,...a}},{});return i.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return r.scopeName=t.scopeName,r}(a,...t)]}(b),[w,E]=_(b),O=i.forwardRef((e,t)=>{let{__scopeCollapsible:r,open:a,defaultOpen:l,disabled:u,onOpenChange:c,...d}=e,[h,f]=function({prop:e,defaultProp:t,onChange:r=()=>{},caller:a}){let[n,s,l]=function({defaultProp:e,onChange:t}){let[r,a]=i.useState(e),n=i.useRef(r),s=i.useRef(t);return o(()=>{s.current=t},[t]),i.useEffect(()=>{n.current!==r&&(s.current?.(r),n.current=r)},[r,n]),[r,a,s]}({defaultProp:t,onChange:r}),u=void 0!==e,c=u?e:n;{let t=i.useRef(void 0!==e);i.useEffect(()=>{let e=t.current;if(e!==u){let t=u?"controlled":"uncontrolled";console.warn(`${a} is changing from ${e?"controlled":"uncontrolled"} to ${t}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`)}t.current=u},[u,a])}return[c,i.useCallback(t=>{if(u){let r="function"==typeof t?t(e):t;r!==e&&l.current?.(r)}else s(t)},[u,e,s,l])]}({prop:a,defaultProp:l??!1,onChange:c,caller:b});return(0,n.jsx)(w,{scope:r,disabled:u,contentId:function(e){let[t,r]=i.useState(g());return s(()=>{e||r(e=>e??String(y++))},[e]),e||(t?`radix-${t}`:"")}(),open:h,onOpenToggle:i.useCallback(()=>f(e=>!e),[f]),children:(0,n.jsx)(p.div,{"data-state":$(h),"data-disabled":u?"":void 0,...d,ref:t})})});O.displayName=b;var S="CollapsibleTrigger",T=i.forwardRef((e,t)=>{let{__scopeCollapsible:r,...i}=e,a=E(S,r);return(0,n.jsx)(p.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":$(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...i,ref:t,onClick:function(e,t,{checkForDefaultPrevented:r=!0}={}){return function(i){if(e?.(i),!1===r||!i.defaultPrevented)return t?.(i)}}(e.onClick,a.onOpenToggle)})});T.displayName=S;var A="CollapsibleContent",x=i.forwardRef((e,t)=>{let{forceMount:r,...i}=e,a=E(A,e.__scopeCollapsible);return(0,n.jsx)(f,{present:r||a.open,children:({present:e})=>(0,n.jsx)(I,{...i,ref:t,present:e})})});x.displayName=A;var I=i.forwardRef((e,t)=>{let{__scopeCollapsible:r,present:a,children:o,...l}=e,u=E(A,r),[d,h]=i.useState(a),f=i.useRef(null),m=c(t,f),g=i.useRef(0),y=g.current,b=i.useRef(0),_=b.current,v=u.open||d,w=i.useRef(v),O=i.useRef(void 0);return i.useEffect(()=>{let e=requestAnimationFrame(()=>w.current=!1);return()=>cancelAnimationFrame(e)},[]),s(()=>{let e=f.current;if(e){O.current=O.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";let t=e.getBoundingClientRect();g.current=t.height,b.current=t.width,w.current||(e.style.transitionDuration=O.current.transitionDuration,e.style.animationName=O.current.animationName),h(a)}},[u.open,a]),(0,n.jsx)(p.div,{"data-state":$(u.open),"data-disabled":u.disabled?"":void 0,id:u.contentId,hidden:!v,...l,ref:m,style:{"--radix-collapsible-content-height":y?`${y}px`:void 0,"--radix-collapsible-content-width":_?`${_}px`:void 0,...e.style},children:v&&o})});function $(e){return e?"open":"closed"}var R=O},6757:function(e,t,r){"use strict";r.d(t,{z$:function(){return O},fC:function(){return E}});var i=r(67294),a=r(85893);function n(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}r(73935);var s=Symbol("radix.slottable");function o(e){return i.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===s}var l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=function(e){let t=function(e){let t=i.forwardRef((e,t)=>{let{children:r,...a}=e;if(i.isValidElement(r)){let e,s;let o=(e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.props.ref:r.props.ref||r.ref,l=function(e,t){let r={...t};for(let i in t){let a=e[i],n=t[i];/^on[A-Z]/.test(i)?a&&n?r[i]=(...e)=>{let t=n(...e);return a(...e),t}:a&&(r[i]=a):"style"===i?r[i]={...a,...n}:"className"===i&&(r[i]=[a,n].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props);return r.type!==i.Fragment&&(l.ref=t?function(...e){return t=>{let r=!1,i=e.map(e=>{let i=n(e,t);return r||"function"!=typeof i||(r=!0),i});if(r)return()=>{for(let t=0;t<i.length;t++){let r=i[t];"function"==typeof r?r():n(e[t],null)}}}}(t,o):o),i.cloneElement(r,l)}return i.Children.count(r)>1?i.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=i.forwardRef((e,r)=>{let{children:n,...s}=e,l=i.Children.toArray(n),u=l.find(o);if(u){let e=u.props.children,n=l.map(t=>t!==u?t:i.Children.count(e)>1?i.Children.only(null):i.isValidElement(e)?e.props.children:null);return(0,a.jsx)(t,{...s,ref:r,children:i.isValidElement(e)?i.cloneElement(e,void 0,n):null})}return(0,a.jsx)(t,{...s,ref:r,children:n})});return r.displayName=`${e}.Slot`,r}(`Primitive.${t}`),s=i.forwardRef((e,i)=>{let{asChild:n,...s}=e,o=n?r:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,a.jsx)(o,{...s,ref:i})});return s.displayName=`Primitive.${t}`,{...e,[t]:s}},{}),u="Progress",[c,d]=function(e,t=[]){let r=[],n=()=>{let t=r.map(e=>i.createContext(e));return function(r){let a=r?.[e]||t;return i.useMemo(()=>({[`__scope${e}`]:{...r,[e]:a}}),[r,a])}};return n.scopeName=e,[function(t,n){let s=i.createContext(n),o=r.length;r=[...r,n];let l=t=>{let{scope:r,children:n,...l}=t,u=r?.[e]?.[o]||s,c=i.useMemo(()=>l,Object.values(l));return(0,a.jsx)(u.Provider,{value:c,children:n})};return l.displayName=t+"Provider",[l,function(r,a){let l=a?.[e]?.[o]||s,u=i.useContext(l);if(u)return u;if(void 0!==n)return n;throw Error(`\`${r}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let a=r.reduce((t,{useScope:r,scopeName:i})=>{let a=r(e)[`__scope${i}`];return{...t,...a}},{});return i.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return r.scopeName=t.scopeName,r}(n,...t)]}(u),[h,p]=c(u),f=i.forwardRef((e,t)=>{var r,i;let{__scopeProgress:n,value:s=null,max:o,getValueLabel:u=y,...c}=e;(o||0===o)&&!v(o)&&console.error((r=`${o}`,`Invalid prop \`max\` of value \`${r}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let d=v(o)?o:100;null===s||w(s,d)||console.error((i=`${s}`,`Invalid prop \`value\` of value \`${i}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let p=w(s,d)?s:null,f=_(p)?u(p,d):void 0;return(0,a.jsx)(h,{scope:n,value:p,max:d,children:(0,a.jsx)(l.div,{"aria-valuemax":d,"aria-valuemin":0,"aria-valuenow":_(p)?p:void 0,"aria-valuetext":f,role:"progressbar","data-state":b(p,d),"data-value":p??void 0,"data-max":d,...c,ref:t})})});f.displayName=u;var m="ProgressIndicator",g=i.forwardRef((e,t)=>{let{__scopeProgress:r,...i}=e,n=p(m,r);return(0,a.jsx)(l.div,{"data-state":b(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...i,ref:t})});function y(e,t){return`${Math.round(e/t*100)}%`}function b(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function _(e){return"number"==typeof e}function v(e){return _(e)&&!isNaN(e)&&e>0}function w(e,t){return _(e)&&!isNaN(e)&&e<=t&&e>=0}g.displayName=m;var E=f,O=g},16012:function(e,t,r){"use strict";r.d(t,{Eh:function(){return eP},VY:function(){return eR},h_:function(){return e$},zt:function(){return eA},fC:function(){return ex},xz:function(){return eI}});var i,a=r(67294),n=r.t(a,2);function s(e,t,{checkForDefaultPrevented:r=!0}={}){return function(i){if(e?.(i),!1===r||!i.defaultPrevented)return t?.(i)}}function o(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function l(...e){return t=>{let r=!1,i=e.map(e=>{let i=o(e,t);return r||"function"!=typeof i||(r=!0),i});if(r)return()=>{for(let t=0;t<i.length;t++){let r=i[t];"function"==typeof r?r():o(e[t],null)}}}}function u(...e){return a.useCallback(l(...e),e)}"undefined"!=typeof window&&window.document&&window.document.createElement;var c=r(85893);function d(e,t=[]){let r=[],i=()=>{let t=r.map(e=>a.createContext(e));return function(r){let i=r?.[e]||t;return a.useMemo(()=>({[`__scope${e}`]:{...r,[e]:i}}),[r,i])}};return i.scopeName=e,[function(t,i){let n=a.createContext(i),s=r.length;r=[...r,i];let o=t=>{let{scope:r,children:i,...o}=t,l=r?.[e]?.[s]||n,u=a.useMemo(()=>o,Object.values(o));return(0,c.jsx)(l.Provider,{value:u,children:i})};return o.displayName=t+"Provider",[o,function(r,o){let l=o?.[e]?.[s]||n,u=a.useContext(l);if(u)return u;if(void 0!==i)return i;throw Error(`\`${r}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let i=r.reduce((t,{useScope:r,scopeName:i})=>{let a=r(e)[`__scope${i}`];return{...t,...a}},{});return a.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return r.scopeName=t.scopeName,r}(i,...t)]}var h=r(73935),p=Symbol("radix.slottable");function f(e){return a.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===p}var m=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=function(e){let t=function(e){let t=a.forwardRef((e,t)=>{let{children:r,...i}=e;if(a.isValidElement(r)){let e,n;let s=(e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.props.ref:r.props.ref||r.ref,o=function(e,t){let r={...t};for(let i in t){let a=e[i],n=t[i];/^on[A-Z]/.test(i)?a&&n?r[i]=(...e)=>{let t=n(...e);return a(...e),t}:a&&(r[i]=a):"style"===i?r[i]={...a,...n}:"className"===i&&(r[i]=[a,n].filter(Boolean).join(" "))}return{...e,...r}}(i,r.props);return r.type!==a.Fragment&&(o.ref=t?l(t,s):s),a.cloneElement(r,o)}return a.Children.count(r)>1?a.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=a.forwardRef((e,r)=>{let{children:i,...n}=e,s=a.Children.toArray(i),o=s.find(f);if(o){let e=o.props.children,i=s.map(t=>t!==o?t:a.Children.count(e)>1?a.Children.only(null):a.isValidElement(e)?e.props.children:null);return(0,c.jsx)(t,{...n,ref:r,children:a.isValidElement(e)?a.cloneElement(e,void 0,i):null})}return(0,c.jsx)(t,{...n,ref:r,children:i})});return r.displayName=`${e}.Slot`,r}(`Primitive.${t}`),i=a.forwardRef((e,i)=>{let{asChild:a,...n}=e,s=a?r:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,c.jsx)(s,{...n,ref:i})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{});function g(e){let t=a.useRef(e);return a.useEffect(()=>{t.current=e}),a.useMemo(()=>(...e)=>t.current?.(...e),[])}var y="dismissableLayer.update",b=a.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),_=a.forwardRef((e,t)=>{let{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:o,onFocusOutside:l,onInteractOutside:d,onDismiss:h,...p}=e,f=a.useContext(b),[_,E]=a.useState(null),O=_?.ownerDocument??globalThis?.document,[,S]=a.useState({}),T=u(t,e=>E(e)),A=Array.from(f.layers),[x]=[...f.layersWithOutsidePointerEventsDisabled].slice(-1),I=A.indexOf(x),$=_?A.indexOf(_):-1,R=f.layersWithOutsidePointerEventsDisabled.size>0,P=$>=I,j=function(e,t=globalThis?.document){let r=g(e),i=a.useRef(!1),n=a.useRef(()=>{});return a.useEffect(()=>{let e=e=>{if(e.target&&!i.current){let i=function(){w("dismissableLayer.pointerDownOutside",r,a,{discrete:!0})},a={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",n.current),n.current=i,t.addEventListener("click",n.current,{once:!0})):i()}else t.removeEventListener("click",n.current);i.current=!1},a=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(a),t.removeEventListener("pointerdown",e),t.removeEventListener("click",n.current)}},[t,r]),{onPointerDownCapture:()=>i.current=!0}}(e=>{let t=e.target,r=[...f.branches].some(e=>e.contains(t));!P||r||(o?.(e),d?.(e),e.defaultPrevented||h?.())},O),N=function(e,t=globalThis?.document){let r=g(e),i=a.useRef(!1);return a.useEffect(()=>{let e=e=>{e.target&&!i.current&&w("dismissableLayer.focusOutside",r,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,r]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}(e=>{let t=e.target;[...f.branches].some(e=>e.contains(t))||(l?.(e),d?.(e),e.defaultPrevented||h?.())},O);return!function(e,t=globalThis?.document){let r=g(e);a.useEffect(()=>{let e=e=>{"Escape"===e.key&&r(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})},[r,t])}(e=>{$!==f.layers.size-1||(n?.(e),!e.defaultPrevented&&h&&(e.preventDefault(),h()))},O),a.useEffect(()=>{if(_)return r&&(0===f.layersWithOutsidePointerEventsDisabled.size&&(i=O.body.style.pointerEvents,O.body.style.pointerEvents="none"),f.layersWithOutsidePointerEventsDisabled.add(_)),f.layers.add(_),v(),()=>{r&&1===f.layersWithOutsidePointerEventsDisabled.size&&(O.body.style.pointerEvents=i)}},[_,O,r,f]),a.useEffect(()=>()=>{_&&(f.layers.delete(_),f.layersWithOutsidePointerEventsDisabled.delete(_),v())},[_,f]),a.useEffect(()=>{let e=()=>S({});return document.addEventListener(y,e),()=>document.removeEventListener(y,e)},[]),(0,c.jsx)(m.div,{...p,ref:T,style:{pointerEvents:R?P?"auto":"none":void 0,...e.style},onFocusCapture:s(e.onFocusCapture,N.onFocusCapture),onBlurCapture:s(e.onBlurCapture,N.onBlurCapture),onPointerDownCapture:s(e.onPointerDownCapture,j.onPointerDownCapture)})});function v(){let e=new CustomEvent(y);document.dispatchEvent(e)}function w(e,t,r,{discrete:i}){let a=r.originalEvent.target,n=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});(t&&a.addEventListener(e,t,{once:!0}),i)?a&&h.flushSync(()=>a.dispatchEvent(n)):a.dispatchEvent(n)}_.displayName="DismissableLayer",a.forwardRef((e,t)=>{let r=a.useContext(b),i=a.useRef(null),n=u(t,i);return a.useEffect(()=>{let e=i.current;if(e)return r.branches.add(e),()=>{r.branches.delete(e)}},[r.branches]),(0,c.jsx)(m.div,{...e,ref:n})}).displayName="DismissableLayerBranch";var E=globalThis?.document?a.useLayoutEffect:()=>{},O=n[" useId ".trim().toString()]||(()=>void 0),S=0,T=r(1371),A=r(60411),x=r(88301),I=a.forwardRef((e,t)=>{let{children:r,width:i=10,height:a=5,...n}=e;return(0,c.jsx)(m.svg,{...n,ref:t,width:i,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:(0,c.jsx)("polygon",{points:"0,0 30,0 15,10"})})});I.displayName="Arrow";var $="Popper",[R,P]=d($),[j,N]=R($),C=e=>{let{__scopePopper:t,children:r}=e,[i,n]=a.useState(null);return(0,c.jsx)(j,{scope:t,anchor:i,onAnchorChange:n,children:r})};C.displayName=$;var k="PopperAnchor",L=a.forwardRef((e,t)=>{let{__scopePopper:r,virtualRef:i,...n}=e,s=N(k,r),o=a.useRef(null),l=u(t,o),d=a.useRef(null);return a.useEffect(()=>{let e=d.current;d.current=i?.current||o.current,e!==d.current&&s.onAnchorChange(d.current)}),i?null:(0,c.jsx)(m.div,{...n,ref:l})});L.displayName=k;var M="PopperContent",[D,U]=R(M),F=a.forwardRef((e,t)=>{let{__scopePopper:r,side:i="bottom",sideOffset:n=0,align:s="center",alignOffset:o=0,arrowPadding:l=0,avoidCollisions:d=!0,collisionBoundary:h=[],collisionPadding:p=0,sticky:f="partial",hideWhenDetached:y=!1,updatePositionStrategy:b="optimized",onPlaced:_,...v}=e,w=N(M,r),[O,S]=a.useState(null),I=u(t,e=>S(e)),[$,R]=a.useState(null),P=function(e){let[t,r]=a.useState(void 0);return E(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let i,a;if(!Array.isArray(t)||!t.length)return;let n=t[0];if("borderBoxSize"in n){let e=n.borderBoxSize,t=Array.isArray(e)?e[0]:e;i=t.inlineSize,a=t.blockSize}else i=e.offsetWidth,a=e.offsetHeight;r({width:i,height:a})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}r(void 0)},[e]),t}($),j=P?.width??0,C=P?.height??0,k="number"==typeof p?p:{top:0,right:0,bottom:0,left:0,...p},L=Array.isArray(h)?h:[h],U=L.length>0,F={padding:k,boundary:L.filter(G),altBoundary:U},{refs:z,floatingStyles:B,placement:H,isPositioned:Z,middlewareData:J}=(0,T.YF)({strategy:"fixed",placement:i+("center"!==s?"-"+s:""),whileElementsMounted:(...e)=>(0,A.Me)(...e,{animationFrame:"always"===b}),elements:{reference:w.anchor},middleware:[(0,x.cv)({mainAxis:n+C,alignmentAxis:o}),d&&(0,A.uY)({mainAxis:!0,crossAxis:!1,limiter:"partial"===f?(0,A.dr)():void 0,...F}),d&&(0,A.RR)({...F}),(0,A.dp)({...F,apply:({elements:e,rects:t,availableWidth:r,availableHeight:i})=>{let{width:a,height:n}=t.reference,s=e.floating.style;s.setProperty("--radix-popper-available-width",`${r}px`),s.setProperty("--radix-popper-available-height",`${i}px`),s.setProperty("--radix-popper-anchor-width",`${a}px`),s.setProperty("--radix-popper-anchor-height",`${n}px`)}}),$&&(0,T.x7)({element:$,padding:l}),q({arrowWidth:j,arrowHeight:C}),y&&(0,A.Cp)({strategy:"referenceHidden",...F})]}),[V,K]=W(H),X=g(_);E(()=>{Z&&X?.()},[Z,X]);let Y=J.arrow?.x,Q=J.arrow?.y,ee=J.arrow?.centerOffset!==0,[et,er]=a.useState();return E(()=>{O&&er(window.getComputedStyle(O).zIndex)},[O]),(0,c.jsx)("div",{ref:z.setFloating,"data-radix-popper-content-wrapper":"",style:{...B,transform:Z?B.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:et,"--radix-popper-transform-origin":[J.transformOrigin?.x,J.transformOrigin?.y].join(" "),...J.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:(0,c.jsx)(D,{scope:r,placedSide:V,onArrowChange:R,arrowX:Y,arrowY:Q,shouldHideArrow:ee,children:(0,c.jsx)(m.div,{"data-side":V,"data-align":K,...v,ref:I,style:{...v.style,animation:Z?void 0:"none"}})})})});F.displayName=M;var z="PopperArrow",B={top:"bottom",right:"left",bottom:"top",left:"right"},H=a.forwardRef(function(e,t){let{__scopePopper:r,...i}=e,a=U(z,r),n=B[a.placedSide];return(0,c.jsx)("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[n]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:(0,c.jsx)(I,{...i,ref:t,style:{...i.style,display:"block"}})})});function G(e){return null!==e}H.displayName=z;var q=e=>({name:"transformOrigin",options:e,fn(t){let{placement:r,rects:i,middlewareData:a}=t,n=a.arrow?.centerOffset!==0,s=n?0:e.arrowWidth,o=n?0:e.arrowHeight,[l,u]=W(r),c={start:"0%",center:"50%",end:"100%"}[u],d=(a.arrow?.x??0)+s/2,h=(a.arrow?.y??0)+o/2,p="",f="";return"bottom"===l?(p=n?c:`${d}px`,f=`${-o}px`):"top"===l?(p=n?c:`${d}px`,f=`${i.floating.height+o}px`):"right"===l?(p=`${-o}px`,f=n?c:`${h}px`):"left"===l&&(p=`${i.floating.width+o}px`,f=n?c:`${h}px`),{data:{x:p,y:f}}}});function W(e){let[t,r="center"]=e.split("-");return[t,r]}var Z=a.forwardRef((e,t)=>{let{container:r,...i}=e,[n,s]=a.useState(!1);E(()=>s(!0),[]);let o=r||n&&globalThis?.document?.body;return o?h.createPortal((0,c.jsx)(m.div,{...i,ref:t}),o):null});Z.displayName="Portal";var J=e=>{let t,r;let{present:i,children:n}=e,s=function(e){var t,r;let[i,n]=a.useState(),s=a.useRef(null),o=a.useRef(e),l=a.useRef("none"),[u,c]=(t=e?"mounted":"unmounted",r={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},a.useReducer((e,t)=>r[e][t]??e,t));return a.useEffect(()=>{let e=V(s.current);l.current="mounted"===u?e:"none"},[u]),E(()=>{let t=s.current,r=o.current;if(r!==e){let i=l.current,a=V(t);e?c("MOUNT"):"none"===a||t?.display==="none"?c("UNMOUNT"):r&&i!==a?c("ANIMATION_OUT"):c("UNMOUNT"),o.current=e}},[e,c]),E(()=>{if(i){let e;let t=i.ownerDocument.defaultView??window,r=r=>{let a=V(s.current).includes(CSS.escape(r.animationName));if(r.target===i&&a&&(c("ANIMATION_END"),!o.current)){let r=i.style.animationFillMode;i.style.animationFillMode="forwards",e=t.setTimeout(()=>{"forwards"===i.style.animationFillMode&&(i.style.animationFillMode=r)})}},a=e=>{e.target===i&&(l.current=V(s.current))};return i.addEventListener("animationstart",a),i.addEventListener("animationcancel",r),i.addEventListener("animationend",r),()=>{t.clearTimeout(e),i.removeEventListener("animationstart",a),i.removeEventListener("animationcancel",r),i.removeEventListener("animationend",r)}}c("ANIMATION_END")},[i,c]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:a.useCallback(e=>{s.current=e?getComputedStyle(e):null,n(e)},[])}}(i),o="function"==typeof n?n({present:s.isPresent}):a.Children.only(n),l=u(s.ref,(t=Object.getOwnPropertyDescriptor(o.props,"ref")?.get)&&"isReactWarning"in t&&t.isReactWarning?o.ref:(t=Object.getOwnPropertyDescriptor(o,"ref")?.get)&&"isReactWarning"in t&&t.isReactWarning?o.props.ref:o.props.ref||o.ref);return"function"==typeof n||s.isPresent?a.cloneElement(o,{ref:l}):null};function V(e){return e?.animationName||"none"}J.displayName="Presence";var K=n[" useInsertionEffect ".trim().toString()]||E;Symbol("RADIX:SYNC_STATE");var X=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Y=a.forwardRef((e,t)=>(0,c.jsx)(m.span,{...e,ref:t,style:{...X,...e.style}}));Y.displayName="VisuallyHidden";var[Q,ee]=d("Tooltip",[P]),et=P(),er="TooltipProvider",ei="tooltip.open",[ea,en]=Q(er),es=e=>{let{__scopeTooltip:t,delayDuration:r=700,skipDelayDuration:i=300,disableHoverableContent:n=!1,children:s}=e,o=a.useRef(!0),l=a.useRef(!1),u=a.useRef(0);return a.useEffect(()=>{let e=u.current;return()=>window.clearTimeout(e)},[]),(0,c.jsx)(ea,{scope:t,isOpenDelayedRef:o,delayDuration:r,onOpen:a.useCallback(()=>{window.clearTimeout(u.current),o.current=!1},[]),onClose:a.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>o.current=!0,i)},[i]),isPointerInTransitRef:l,onPointerInTransitChange:a.useCallback(e=>{l.current=e},[]),disableHoverableContent:n,children:s})};es.displayName=er;var eo="Tooltip",[el,eu]=Q(eo),ec=e=>{let{__scopeTooltip:t,children:r,open:i,defaultOpen:n,onOpenChange:s,disableHoverableContent:o,delayDuration:l}=e,u=en(eo,e.__scopeTooltip),d=et(t),[h,p]=a.useState(null),f=function(e){let[t,r]=a.useState(O());return E(()=>{e||r(e=>e??String(S++))},[e]),e||(t?`radix-${t}`:"")}(),m=a.useRef(0),g=o??u.disableHoverableContent,y=l??u.delayDuration,b=a.useRef(!1),[_,v]=function({prop:e,defaultProp:t,onChange:r=()=>{},caller:i}){let[n,s,o]=function({defaultProp:e,onChange:t}){let[r,i]=a.useState(e),n=a.useRef(r),s=a.useRef(t);return K(()=>{s.current=t},[t]),a.useEffect(()=>{n.current!==r&&(s.current?.(r),n.current=r)},[r,n]),[r,i,s]}({defaultProp:t,onChange:r}),l=void 0!==e,u=l?e:n;{let t=a.useRef(void 0!==e);a.useEffect(()=>{let e=t.current;if(e!==l){let t=l?"controlled":"uncontrolled";console.warn(`${i} is changing from ${e?"controlled":"uncontrolled"} to ${t}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`)}t.current=l},[l,i])}return[u,a.useCallback(t=>{if(l){let r="function"==typeof t?t(e):t;r!==e&&o.current?.(r)}else s(t)},[l,e,s,o])]}({prop:i,defaultProp:n??!1,onChange:e=>{e?(u.onOpen(),document.dispatchEvent(new CustomEvent(ei))):u.onClose(),s?.(e)},caller:eo}),w=a.useMemo(()=>_?b.current?"delayed-open":"instant-open":"closed",[_]),T=a.useCallback(()=>{window.clearTimeout(m.current),m.current=0,b.current=!1,v(!0)},[v]),A=a.useCallback(()=>{window.clearTimeout(m.current),m.current=0,v(!1)},[v]),x=a.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>{b.current=!0,v(!0),m.current=0},y)},[y,v]);return a.useEffect(()=>()=>{m.current&&(window.clearTimeout(m.current),m.current=0)},[]),(0,c.jsx)(C,{...d,children:(0,c.jsx)(el,{scope:t,contentId:f,open:_,stateAttribute:w,trigger:h,onTriggerChange:p,onTriggerEnter:a.useCallback(()=>{u.isOpenDelayedRef.current?x():T()},[u.isOpenDelayedRef,x,T]),onTriggerLeave:a.useCallback(()=>{g?A():(window.clearTimeout(m.current),m.current=0)},[A,g]),onOpen:T,onClose:A,disableHoverableContent:g,children:r})})};ec.displayName=eo;var ed="TooltipTrigger",eh=a.forwardRef((e,t)=>{let{__scopeTooltip:r,...i}=e,n=eu(ed,r),o=en(ed,r),l=et(r),d=u(t,a.useRef(null),n.onTriggerChange),h=a.useRef(!1),p=a.useRef(!1),f=a.useCallback(()=>h.current=!1,[]);return a.useEffect(()=>()=>document.removeEventListener("pointerup",f),[f]),(0,c.jsx)(L,{asChild:!0,...l,children:(0,c.jsx)(m.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...i,ref:d,onPointerMove:s(e.onPointerMove,e=>{"touch"===e.pointerType||p.current||o.isPointerInTransitRef.current||(n.onTriggerEnter(),p.current=!0)}),onPointerLeave:s(e.onPointerLeave,()=>{n.onTriggerLeave(),p.current=!1}),onPointerDown:s(e.onPointerDown,()=>{n.open&&n.onClose(),h.current=!0,document.addEventListener("pointerup",f,{once:!0})}),onFocus:s(e.onFocus,()=>{h.current||n.onOpen()}),onBlur:s(e.onBlur,n.onClose),onClick:s(e.onClick,n.onClose)})})});eh.displayName=ed;var ep="TooltipPortal",[ef,em]=Q(ep,{forceMount:void 0}),eg=e=>{let{__scopeTooltip:t,forceMount:r,children:i,container:a}=e,n=eu(ep,t);return(0,c.jsx)(ef,{scope:t,forceMount:r,children:(0,c.jsx)(J,{present:r||n.open,children:(0,c.jsx)(Z,{asChild:!0,container:a,children:i})})})};eg.displayName=ep;var ey="TooltipContent",eb=a.forwardRef((e,t)=>{let r=em(ey,e.__scopeTooltip),{forceMount:i=r.forceMount,side:a="top",...n}=e,s=eu(ey,e.__scopeTooltip);return(0,c.jsx)(J,{present:i||s.open,children:s.disableHoverableContent?(0,c.jsx)(eO,{side:a,...n,ref:t}):(0,c.jsx)(e_,{side:a,...n,ref:t})})}),e_=a.forwardRef((e,t)=>{let r=eu(ey,e.__scopeTooltip),i=en(ey,e.__scopeTooltip),n=a.useRef(null),s=u(t,n),[o,l]=a.useState(null),{trigger:d,onClose:h}=r,p=n.current,{onPointerInTransitChange:f}=i,m=a.useCallback(()=>{l(null),f(!1)},[f]),g=a.useCallback((e,t)=>{let r=e.currentTarget,i={x:e.clientX,y:e.clientY},a=function(e,t){let r=Math.abs(t.top-e.y),i=Math.abs(t.bottom-e.y),a=Math.abs(t.right-e.x),n=Math.abs(t.left-e.x);switch(Math.min(r,i,a,n)){case n:return"left";case a:return"right";case r:return"top";case i:return"bottom";default:throw Error("unreachable")}}(i,r.getBoundingClientRect());l(function(e){let t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),function(e){if(e.length<=1)return e.slice();let t=[];for(let r=0;r<e.length;r++){let i=e[r];for(;t.length>=2;){let e=t[t.length-1],r=t[t.length-2];if((e.x-r.x)*(i.y-r.y)>=(e.y-r.y)*(i.x-r.x))t.pop();else break}t.push(i)}t.pop();let r=[];for(let t=e.length-1;t>=0;t--){let i=e[t];for(;r.length>=2;){let e=r[r.length-1],t=r[r.length-2];if((e.x-t.x)*(i.y-t.y)>=(e.y-t.y)*(i.x-t.x))r.pop();else break}r.push(i)}return(r.pop(),1===t.length&&1===r.length&&t[0].x===r[0].x&&t[0].y===r[0].y)?t:t.concat(r)}(t)}([...function(e,t,r=5){let i=[];switch(t){case"top":i.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":i.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":i.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":i.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r})}return i}(i,a),...function(e){let{top:t,right:r,bottom:i,left:a}=e;return[{x:a,y:t},{x:r,y:t},{x:r,y:i},{x:a,y:i}]}(t.getBoundingClientRect())])),f(!0)},[f]);return a.useEffect(()=>()=>m(),[m]),a.useEffect(()=>{if(d&&p){let e=e=>g(e,p),t=e=>g(e,d);return d.addEventListener("pointerleave",e),p.addEventListener("pointerleave",t),()=>{d.removeEventListener("pointerleave",e),p.removeEventListener("pointerleave",t)}}},[d,p,g,m]),a.useEffect(()=>{if(o){let e=e=>{let t=e.target,r={x:e.clientX,y:e.clientY},i=d?.contains(t)||p?.contains(t),a=!function(e,t){let{x:r,y:i}=e,a=!1;for(let e=0,n=t.length-1;e<t.length;n=e++){let s=t[e],o=t[n],l=s.x,u=s.y,c=o.x,d=o.y;u>i!=d>i&&r<(c-l)*(i-u)/(d-u)+l&&(a=!a)}return a}(r,o);i?m():a&&(m(),h())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[d,p,o,h,m]),(0,c.jsx)(eO,{...e,ref:s})}),[ev,ew]=Q(eo,{isInside:!1}),eE=function(e){let t=({children:e})=>(0,c.jsx)(c.Fragment,{children:e});return t.displayName=`${e}.Slottable`,t.__radixId=p,t}("TooltipContent"),eO=a.forwardRef((e,t)=>{let{__scopeTooltip:r,children:i,"aria-label":n,onEscapeKeyDown:s,onPointerDownOutside:o,...l}=e,u=eu(ey,r),d=et(r),{onClose:h}=u;return a.useEffect(()=>(document.addEventListener(ei,h),()=>document.removeEventListener(ei,h)),[h]),a.useEffect(()=>{if(u.trigger){let e=e=>{let t=e.target;t?.contains(u.trigger)&&h()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[u.trigger,h]),(0,c.jsx)(_,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:e=>e.preventDefault(),onDismiss:h,children:(0,c.jsxs)(F,{"data-state":u.stateAttribute,...d,...l,ref:t,style:{...l.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[(0,c.jsx)(eE,{children:i}),(0,c.jsx)(ev,{scope:r,isInside:!0,children:(0,c.jsx)(Y,{id:u.contentId,role:"tooltip",children:n||i})})]})})});eb.displayName=ey;var eS="TooltipArrow",eT=a.forwardRef((e,t)=>{let{__scopeTooltip:r,...i}=e,a=et(r);return ew(eS,r).isInside?null:(0,c.jsx)(H,{...a,...i,ref:t})});eT.displayName=eS;var eA=es,ex=ec,eI=eh,e$=eg,eR=eb,eP=eT},45139:function(e,t,r){"use strict";r.d(t,{j:function(){return n}});let i=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=function(){for(var e,t,r=0,i="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=function e(t){var r,i,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t){if(Array.isArray(t)){var n=t.length;for(r=0;r<n;r++)t[r]&&(i=e(t[r]))&&(a&&(a+=" "),a+=i)}else for(i in t)t[i]&&(a&&(a+=" "),a+=i)}return a}(e))&&(i&&(i+=" "),i+=t);return i},n=(e,t)=>r=>{var n;if((null==t?void 0:t.variants)==null)return a(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:s,defaultVariants:o}=t,l=Object.keys(s).map(e=>{let t=null==r?void 0:r[e],a=null==o?void 0:o[e];if(null===t)return null;let n=i(t)||i(a);return s[e][n]}),u=r&&Object.entries(r).reduce((e,t)=>{let[r,i]=t;return void 0===i||(e[r]=i),e},{});return a(e,l,null==t?void 0:null===(n=t.compoundVariants)||void 0===n?void 0:n.reduce((e,t)=>{let{class:r,className:i,...a}=t;return Object.entries(a).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...o,...u}[t]):({...o,...u})[t]===r})?[...e,r,i]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}},80322:function(e,t,r){"use strict";r.d(t,{h:function(){return f},a:function(){return m}});var i=r(85893),a=r(67294);/*!---------------------------------------------------------------------------------------------
 *  Copyright (c) StackBlitz. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/let n={damping:.7,stiffness:.05,mass:1.25},s=1e3/60,o=!1;globalThis.document?.addEventListener("mousedown",()=>{o=!0}),globalThis.document?.addEventListener("mouseup",()=>{o=!1}),globalThis.document?.addEventListener("click",()=>{o=!1});let l=(e={})=>{let[t,r]=(0,a.useState)(!1),[i,n]=(0,a.useState)(!1!==e.initial),[l,c]=(0,a.useState)(!1),h=(0,a.useRef)(null);h.current=e;let p=(0,a.useCallback)(()=>{if(!o)return!1;let e=window.getSelection();if(!e||!e.rangeCount)return!1;let t=e.getRangeAt(0);return t.commonAncestorContainer.contains(w.current)||w.current?.contains(t.commonAncestorContainer)},[]),f=(0,a.useCallback)(e=>{g.isAtBottom=e,n(e)},[]),m=(0,a.useCallback)(e=>{g.escapedFromLock=e,r(e)},[]),g=(0,a.useMemo)(()=>{let r;return{escapedFromLock:t,isAtBottom:i,resizeDifference:0,accumulated:0,velocity:0,listeners:new Set,get scrollTop(){return w.current?.scrollTop??0},set scrollTop(scrollTop){w.current&&(w.current.scrollTop=scrollTop,g.ignoreScrollToTop=w.current.scrollTop)},get targetScrollTop(){if(!w.current||!E.current)return 0;return w.current.scrollHeight-1-w.current.clientHeight},get calculatedTargetScrollTop(){if(!w.current||!E.current)return 0;let{targetScrollTop:t}=this;if(!e.targetScrollTop)return t;if(r?.targetScrollTop===t)return r.calculatedScrollTop;let i=Math.max(Math.min(e.targetScrollTop(t,{scrollElement:w.current,contentElement:E.current}),t),0);return r={targetScrollTop:t,calculatedScrollTop:i},requestAnimationFrame(()=>{r=void 0}),i},get scrollDifference(){return this.calculatedTargetScrollTop-this.scrollTop},get isNearBottom(){return this.scrollDifference<=70}}},[]),y=(0,a.useCallback)((e={})=>{let t;"string"==typeof e&&(e={animation:e}),e.preserveScrollPosition||f(!0);let r=Date.now()+(Number(e.wait)||0),i=d(h.current,e.animation),{ignoreEscapes:a=!1}=e,n=g.calculatedTargetScrollTop;e.duration instanceof Promise?e.duration.finally(()=>{t=Date.now()}):t=r+(e.duration??0);let o=async()=>{let e=new Promise(requestAnimationFrame).then(()=>{if(!g.isAtBottom)return g.animation=void 0,!1;let{scrollTop:l}=g,u=performance.now(),c=(u-(g.lastTick??u))/s;if(g.animation||(g.animation={behavior:i,promise:e,ignoreEscapes:a}),g.animation.behavior===i&&(g.lastTick=u),p()||r>Date.now())return o();if(l<Math.min(n,g.calculatedTargetScrollTop)){if(g.animation?.behavior===i){if("instant"===i)return g.scrollTop=g.calculatedTargetScrollTop,o();g.velocity=(i.damping*g.velocity+i.stiffness*g.scrollDifference)/i.mass,g.accumulated+=g.velocity*c,g.scrollTop+=g.accumulated,g.scrollTop!==l&&(g.accumulated=0)}return o()}return t>Date.now()?(n=g.calculatedTargetScrollTop,o()):(g.animation=void 0,g.scrollTop<g.calculatedTargetScrollTop)?y({animation:d(h.current,h.current.resize),ignoreEscapes:a,duration:Math.max(0,t-Date.now())||void 0}):g.isAtBottom});return e.then(e=>(requestAnimationFrame(()=>{g.animation||(g.lastTick=void 0,g.velocity=0)}),e))};return(!0!==e.wait&&(g.animation=void 0),g.animation?.behavior===i)?g.animation.promise:o()},[f,p,g]),b=(0,a.useCallback)(()=>{m(!0),f(!1)},[m,f]),_=(0,a.useCallback)(({target:e})=>{if(e!==w.current)return;let{scrollTop:t,ignoreScrollToTop:r}=g,{lastScrollTop:i=t}=g;g.lastScrollTop=t,g.ignoreScrollToTop=void 0,r&&r>t&&(i=r),c(g.isNearBottom),setTimeout(()=>{if(g.resizeDifference||t===r)return;if(p()){m(!0),f(!1);return}let e=t>i,a=t<i;if(g.animation?.ignoreEscapes){g.scrollTop=i;return}a&&(m(!0),f(!1)),e&&m(!1),!g.escapedFromLock&&g.isNearBottom&&f(!0)},1)},[m,f,p,g]),v=(0,a.useCallback)(({target:e,deltaY:t})=>{let r=e;for(;!["scroll","auto"].includes(getComputedStyle(r).overflow);){if(!r.parentElement)return;r=r.parentElement}r===w.current&&t<0&&w.current.scrollHeight>w.current.clientHeight&&!g.animation?.ignoreEscapes&&(m(!0),f(!1))},[m,f,g]),w=u(e=>{w.current?.removeEventListener("scroll",_),w.current?.removeEventListener("wheel",v),e?.addEventListener("scroll",_,{passive:!0}),e?.addEventListener("wheel",v,{passive:!0})},[]),E=u(e=>{let t;g.resizeObserver?.disconnect(),e&&(g.resizeObserver=new ResizeObserver(([e])=>{let{height:r}=e.contentRect,i=r-(t??r);if(g.resizeDifference=i,g.scrollTop>g.targetScrollTop&&(g.scrollTop=g.targetScrollTop),c(g.isNearBottom),i>=0){let e=d(h.current,t?h.current.resize:h.current.initial);y({animation:e,wait:!0,preserveScrollPosition:!0,duration:"instant"===e?void 0:350})}else g.isNearBottom&&(m(!1),f(!0));t=r,requestAnimationFrame(()=>{setTimeout(()=>{g.resizeDifference===i&&(g.resizeDifference=0)},1)})}),g.resizeObserver?.observe(e))},[]);return{contentRef:E,scrollRef:w,scrollToBottom:y,stopScroll:b,isAtBottom:i||l,isNearBottom:l,escapedFromLock:t,state:g}};function u(e,t){let r=(0,a.useCallback)(t=>(r.current=t,e(t)),t);return r}let c=new Map;function d(...e){let t={...n},r=!1;for(let i of e){if("instant"===i){r=!0;continue}"object"==typeof i&&(r=!1,t.damping=i.damping??t.damping,t.stiffness=i.stiffness??t.stiffness,t.mass=i.mass??t.mass)}let i=JSON.stringify(t);return c.has(i)||c.set(i,Object.freeze(t)),r?"instant":c.get(i)}/*!---------------------------------------------------------------------------------------------
 *  Copyright (c) StackBlitz. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/let h=(0,a.createContext)(null),p="undefined"!=typeof window?a.useLayoutEffect:a.useEffect;function f({instance:e,children:t,resize:r,initial:n,mass:s,damping:o,stiffness:u,targetScrollTop:c,contextRef:d,...f}){let m=(0,a.useRef)(null),g=l({mass:s,damping:o,stiffness:u,resize:r,initial:n,targetScrollTop:a.useCallback((e,t)=>{let r=S?.targetScrollTop??c;return r?.(e,t)??e},[c])}),{scrollRef:y,contentRef:b,scrollToBottom:_,stopScroll:v,isAtBottom:w,escapedFromLock:E,state:O}=e??g,S=(0,a.useMemo)(()=>({scrollToBottom:_,stopScroll:v,scrollRef:y,isAtBottom:w,escapedFromLock:E,contentRef:b,state:O,get targetScrollTop(){return m.current},set targetScrollTop(targetScrollTop){m.current=targetScrollTop}}),[_,w,b,y,v,E,O]);return(0,a.useImperativeHandle)(d,()=>S,[S]),p(()=>{y.current&&"visible"===getComputedStyle(y.current).overflow&&(y.current.style.overflow="auto")},[]),(0,i.jsx)(h.Provider,{value:S,children:(0,i.jsx)("div",{...f,children:"function"==typeof t?t(S):t})})}function m(){let e=(0,a.useContext)(h);if(!e)throw Error("use-stick-to-bottom component context must be used within a StickToBottom component");return e}(f||(f={})).Content=function({children:e,...t}){let r=m();return(0,i.jsx)("div",{ref:r.scrollRef,style:{height:"100%",width:"100%"},children:(0,i.jsx)("div",{...t,ref:r.contentRef,children:"function"==typeof e?e(r):e})})}}}]);