"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6279],{73652:function(e,t,a){a.d(t,{$Z:function(){return tv},Mm:function(){return t6},Pu:function(){return tV},bS:function(){return tK},eI:function(){return tM},h5:function(){return tx},iU:function(){return tS},kP:function(){return ty}});var r,s,o,i,n,l,u,p,d,c,m,h=a(41111),f=a(5045),y=a(66894),g=a(36417),v=a(72917),b=Object.defineProperty,I="AI_NoOutputSpecifiedError",x=`vercel.ai.error.${I}`,w=Symbol.for(x),T=class extends f.AX{constructor({message:e="No output specified."}={}){super({name:I,message:e}),this[r]=!0}static isInstance(e){return f.AX.hasMarker(e,x)}};r=w;var _=!1,E=e=>{if(0===e.length)return;let t=globalThis.AI_SDK_LOG_WARNINGS;if(!1!==t){if("function"==typeof t){t(e);return}for(let t of(_||(_=!0,console.info("AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.")),e))console.warn(function(e){let t="AI SDK Warning:";switch(e.type){case"unsupported-setting":{let a=`${t} The "${e.setting}" setting is not supported by this model`;return e.details&&(a+=` - ${e.details}`),a}case"unsupported-tool":{let a="name"in e.tool?e.tool.name:"unknown tool",r=`${t} The tool "${a}" is not supported by this model`;return e.details&&(r+=` - ${e.details}`),r}case"other":return`${t} ${e.message}`;default:return`${t} ${JSON.stringify(e,null,2)}`}}(t))}},S="AI_InvalidArgumentError",M=`vercel.ai.error.${S}`,R=Symbol.for(M),C=class extends f.AX{constructor({parameter:e,value:t,message:a}){super({name:S,message:`Invalid argument for parameter ${e}: ${a}`}),this[s]=!0,this.parameter=e,this.value=t}static isInstance(e){return f.AX.hasMarker(e,M)}};s=R,Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");var k="AI_InvalidToolInputError",N=`vercel.ai.error.${k}`,A=Symbol.for(N),O=class extends f.AX{constructor({toolInput:e,toolName:t,cause:a,message:r=`Invalid input for tool ${t}: ${(0,f.e$)(a)}`}){super({name:k,message:r,cause:a}),this[o]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return f.AX.hasMarker(e,N)}};o=A,Symbol.for("vercel.ai.error.AI_MCPClientError"),Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");var q="AI_NoObjectGeneratedError",Z=`vercel.ai.error.${q}`,D=Symbol.for(Z),P=class extends f.AX{constructor({message:e="No object generated.",cause:t,text:a,response:r,usage:s,finishReason:o}){super({name:q,message:e,cause:t}),this[i]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=o}static isInstance(e){return f.AX.hasMarker(e,Z)}};i=D;var j="AI_NoOutputGeneratedError",$=`vercel.ai.error.${j}`,U=Symbol.for($),F=class extends f.AX{constructor({message:e="No output generated.",cause:t}={}){super({name:j,message:e,cause:t}),this[n]=!0}static isInstance(e){return f.AX.hasMarker(e,$)}};n=U;var J="AI_NoSuchToolError",B=`vercel.ai.error.${J}`,L=Symbol.for(B),G=class extends f.AX{constructor({toolName:e,availableTools:t,message:a=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:J,message:a}),this[l]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return f.AX.hasMarker(e,B)}};l=L;var X="AI_ToolCallRepairError",W=`vercel.ai.error.${X}`,V=Symbol.for(W),K=class extends f.AX{constructor({cause:e,originalError:t,message:a=`Error repairing tool call: ${(0,f.e$)(e)}`}){super({name:X,message:a,cause:e}),this[u]=!0,this.originalError=t}static isInstance(e){return f.AX.hasMarker(e,W)}};u=V;var Y=class extends f.AX{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},z=(Symbol.for("vercel.ai.error.AI_InvalidDataContentError"),"AI_InvalidMessageRoleError"),Q=`vercel.ai.error.${z}`,H=Symbol.for(Q),ee=class extends f.AX{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:z,message:t}),this[p]=!0,this.role=e}static isInstance(e){return f.AX.hasMarker(e,Q)}};p=H;var et="AI_MessageConversionError",ea=`vercel.ai.error.${et}`,er=Symbol.for(ea),es=class extends f.AX{constructor({originalMessage:e,message:t}){super({name:et,message:t}),this[d]=!0,this.originalMessage=e}static isInstance(e){return f.AX.hasMarker(e,ea)}};d=er;var eo="AI_DownloadError",ei=`vercel.ai.error.${eo}`,en=Symbol.for(ei),el=class extends f.AX{constructor({url:e,statusCode:t,statusText:a,cause:r,message:s=null==r?`Failed to download ${e}: ${t} ${a}`:`Failed to download ${e}: ${r}`}){super({name:eo,message:s,cause:r}),this[c]=!0,this.url=e,this.statusCode=t,this.statusText=a}static isInstance(e){return f.AX.hasMarker(e,ei)}};c=en;var eu="AI_RetryError",ep=`vercel.ai.error.${eu}`,ed=Symbol.for(ep),ec=class extends f.AX{constructor({message:e,reason:t,errors:a}){super({name:eu,message:e}),this[m]=!0,this.reason=t,this.errors=a,this.lastError=a[a.length-1]}static isInstance(e){return f.AX.hasMarker(e,ep)}};function em(e){if("string"!=typeof e){if("v2"!==e.specificationVersion)throw new Y({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return ef().languageModel(e)}function eh(e){if("string"!=typeof e){if("v2"!==e.specificationVersion)throw new Y({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return ef().textEmbeddingModel(e)}function ef(){var e;return null!=(e=globalThis.AI_SDK_DEFAULT_PROVIDER)?e:y.Y0}m=ed;var ey=[{mediaType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mediaType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mediaType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mediaType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mediaType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],eg=e=>{let t="string"==typeof e?(0,h.MS)(e):e,a=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(a+10)},ev=async({url:e})=>{var t;let a=e.toString();try{let e=await fetch(a);if(!e.ok)throw new el({url:a,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(el.isInstance(e))throw e;throw new el({url:a,cause:e})}},eb=(e=ev)=>t=>Promise.all(t.map(async t=>t.isUrlSupportedByModel?null:e(t))),eI=g.G0([g.Z_(),g.Pp(Uint8Array),g.Pp(ArrayBuffer),g.PG(e=>{var t,a;return null!=(a=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&a},{message:"Must be a Buffer"})]);function ex(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if("string"==typeof e)try{e=new URL(e)}catch(e){}if(e instanceof URL&&"data:"===e.protocol){let{mediaType:t,base64Content:a}=function(e){try{let[t,a]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:a}}catch(e){return{mediaType:void 0,base64Content:void 0}}}(e.toString());if(null==t||null==a)throw new f.AX({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:a,mediaType:t}}return{data:e,mediaType:void 0}}async function ew({prompt:e,supportedUrls:t,download:a=eb()}){let r=await eT(e.messages,a,t);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function({message:e,downloadedAssets:t}){let a=e.role;switch(a){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"user",content:e.content.map(e=>(function(e,t){var a;let r;if("text"===e.type)return{type:"text",text:e.text,providerOptions:e.providerOptions};let s=e.type;switch(s){case"image":r=e.image;break;case"file":r=e.data;break;default:throw Error(`Unsupported part type: ${s}`)}let{data:o,mediaType:i}=ex(r),n=null!=i?i:e.mediaType,l=o;if(l instanceof URL){let e=t[l.toString()];e&&(l=e.data,null!=n||(n=e.mediaType))}switch(s){case"image":return(l instanceof Uint8Array||"string"==typeof l)&&(n=null!=(a=function({data:e,signatures:t}){let a="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?eg(e):e;for(let e of t)if("string"==typeof a?a.startsWith(e.base64Prefix):a.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>a[t]===e))return e.mediaType}({data:l,signatures:ey}))?a:n),{type:"file",mediaType:null!=n?n:"image/*",filename:void 0,data:l,providerOptions:e.providerOptions};case"file":if(null==n)throw Error("Media type is missing for file part");return{type:"file",mediaType:n,filename:e.filename,data:l,providerOptions:e.providerOptions}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerOptions:e.providerOptions};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{let t=e.providerOptions;switch(e.type){case"file":{let{data:a,mediaType:r}=ex(e.data);return{type:"file",data:a,filename:e.filename,mediaType:null!=r?r:e.mediaType,providerOptions:t}}case"reasoning":return{type:"reasoning",text:e.text,providerOptions:t};case"text":return{type:"text",text:e.text,providerOptions:t};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:t}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:e.providerOptions})),providerOptions:e.providerOptions};default:throw new ee({role:a})}})({message:e,downloadedAssets:r}))]}async function eT(e,t,a){let r=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>{var t;let a=null!=(t=e.mediaType)?t:"image"===e.type?"image/*":void 0,r="image"===e.type?e.image:e.data;if("string"==typeof r)try{r=new URL(r)}catch(e){}return{mediaType:a,data:r}}).filter(e=>e.data instanceof URL).map(e=>({url:e.data,isUrlSupportedByModel:null!=e.mediaType&&(0,h.MT)({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:a})}));return Object.fromEntries((await t(r)).filter(e=>(null==e?void 0:e.data)!=null).map(({data:e,mediaType:t},a)=>[r[a].url.toString(),{data:e,mediaType:t}]))}var e_=g.Vo(()=>g.G0([g.lB(),g.Z_(),g.Rx(),g.O7(),g.IM(g.Z_(),e_),g.IX(e_)])),eE=g.IM(g.Z_(),g.IM(g.Z_(),e_)),eS=g.Ry({type:g.i0("text"),text:g.Z_(),providerOptions:eE.optional()}),eM=g.Ry({type:g.i0("image"),image:g.G0([eI,g.Pp(URL)]),mediaType:g.Z_().optional(),providerOptions:eE.optional()}),eR=g.Ry({type:g.i0("file"),data:g.G0([eI,g.Pp(URL)]),filename:g.Z_().optional(),mediaType:g.Z_(),providerOptions:eE.optional()}),eC=g.Ry({type:g.i0("reasoning"),text:g.Z_(),providerOptions:eE.optional()}),ek=g.Ry({type:g.i0("tool-call"),toolCallId:g.Z_(),toolName:g.Z_(),input:g._4(),providerOptions:eE.optional(),providerExecuted:g.O7().optional()}),eN=g.VK("type",[g.Ry({type:g.i0("text"),value:g.Z_()}),g.Ry({type:g.i0("json"),value:e_}),g.Ry({type:g.i0("error-text"),value:g.Z_()}),g.Ry({type:g.i0("error-json"),value:e_}),g.Ry({type:g.i0("content"),value:g.IX(g.G0([g.Ry({type:g.i0("text"),text:g.Z_()}),g.Ry({type:g.i0("media"),data:g.Z_(),mediaType:g.Z_()})]))})]),eA=g.Ry({type:g.i0("tool-result"),toolCallId:g.Z_(),toolName:g.Z_(),output:eN,providerOptions:eE.optional()}),eO=g.Ry({role:g.i0("system"),content:g.Z_(),providerOptions:eE.optional()}),eq=g.Ry({role:g.i0("user"),content:g.G0([g.Z_(),g.IX(g.G0([eS,eM,eR]))]),providerOptions:eE.optional()}),eZ=g.Ry({role:g.i0("assistant"),content:g.G0([g.Z_(),g.IX(g.G0([eS,eR,eC,ek,eA]))]),providerOptions:eE.optional()}),eD=g.Ry({role:g.i0("tool"),content:g.IX(eA),providerOptions:eE.optional()}),eP=g.G0([eO,eq,eZ,eD]);async function ej(e){let t;if(null==e.prompt&&null==e.messages)throw new f.Mt({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new f.Mt({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new f.Mt({prompt:e,message:"system must be a string"});if(null!=e.prompt&&"string"==typeof e.prompt)t=[{role:"user",content:e.prompt}];else if(null!=e.prompt&&Array.isArray(e.prompt))t=e.prompt;else if(null!=e.messages)t=e.messages;else throw new f.Mt({prompt:e,message:"prompt or messages must be defined"});if(0===t.length)throw new f.Mt({prompt:e,message:"messages must not be empty"});let a=await (0,h.pW)({value:t,schema:g.IX(eP)});if(!a.success)throw new f.Mt({prompt:e,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:a.error});return{messages:t,system:e.system}}function e$({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function eU({model:e,settings:t,telemetry:a,headers:r}){var s;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,a])=>(e[`ai.settings.${t}`]=a,e),{}),...Object.entries(null!=(s=null==a?void 0:a.metadata)?s:{}).reduce((e,[t,a])=>(e[`ai.telemetry.metadata.${t}`]=a,e),{}),...Object.entries(null!=r?r:{}).reduce((e,[t,a])=>(void 0!==a&&(e[`ai.request.headers.${t}`]=a),e),{})}}var eF={startSpan:()=>eJ,startActiveSpan:(e,t,a,r)=>"function"==typeof t?t(eJ):"function"==typeof a?a(eJ):"function"==typeof r?r(eJ):void 0},eJ={spanContext:()=>eB,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},eB={traceId:"",spanId:"",traceFlags:0};function eL({isEnabled:e=!1,tracer:t}={}){return e?t||v.trace.getTracer("ai"):eF}function eG({name:e,tracer:t,attributes:a,fn:r,endWhenDone:s=!0}){return t.startActiveSpan(e,{attributes:a},async e=>{try{let t=await r(e);return s&&e.end(),t}catch(t){try{eX(e,t)}finally{e.end()}throw t}})}function eX(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:v.SpanStatusCode.ERROR,message:t.message})):e.setStatus({code:v.SpanStatusCode.ERROR})}function eW({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[a,r])=>{if(null==r)return t;if("object"==typeof r&&"input"in r&&"function"==typeof r.input){if((null==e?void 0:e.recordInputs)===!1)return t;let s=r.input();return null==s?t:{...t,[a]:s}}if("object"==typeof r&&"output"in r&&"function"==typeof r.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let s=r.output();return null==s?t:{...t,[a]:s}}return{...t,[a]:r}},{})}function eV(e,t){return null==e&&null==t?void 0:(null!=e?e:0)+(null!=t?t:0)}function eK(e){return void 0===e?[]:Array.isArray(e)?e:[e]}var eY=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:a=2,abortSignal:r}={})=>async s=>ez(s,{maxRetries:e,delayInMs:t,backoffFactor:a,abortSignal:r});async function ez(e,{maxRetries:t,delayInMs:a,backoffFactor:r,abortSignal:s},o=[]){try{return await e()}catch(u){if((0,h.D_)(u)||0===t)throw u;let i=(0,h.e$)(u),n=[...o,u],l=n.length;if(l>t)throw new ec({message:`Failed after ${l} attempts. Last error: ${i}`,reason:"maxRetriesExceeded",errors:n});if(u instanceof Error&&f.w.isInstance(u)&&!0===u.isRetryable&&l<=t)return await (0,h.gw)(function({error:e,exponentialBackoffDelay:t}){let a;let r=e.responseHeaders;if(!r)return t;let s=r["retry-after-ms"];if(s){let e=parseFloat(s);Number.isNaN(e)||(a=e)}let o=r["retry-after"];if(o&&void 0===a){let e=parseFloat(o);a=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}return null!=a&&!Number.isNaN(a)&&0<=a&&(a<6e4||a<t)?a:t}({error:u,exponentialBackoffDelay:a}),{abortSignal:s}),ez(e,{maxRetries:t,delayInMs:r*a,backoffFactor:r,abortSignal:s},n);if(1===l)throw u;throw new ec({message:`Failed after ${l} attempts with non-retryable error: '${i}'`,reason:"errorNotRetryable",errors:n})}}function eQ({maxRetries:e,abortSignal:t}){if(null!=e){if(!Number.isInteger(e))throw new C({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new C({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let a=null!=e?e:2;return{maxRetries:a,retry:eY({maxRetries:a,abortSignal:t})}}var eH=class{constructor({data:e,mediaType:t}){let a=e instanceof Uint8Array;this.base64Data=a?void 0:e,this.uint8ArrayData=a?e:void 0,this.mediaType=t}get base64(){return null==this.base64Data&&(this.base64Data=(0,h.k0)(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=(0,h.MS)(this.base64Data)),this.uint8ArrayData}},e0=class extends eH{constructor(e){super(e),this.type="file"}};async function e1({toolCall:e,tools:t,repairToolCall:a,system:r,messages:s}){try{if(null==t)throw new G({toolName:e.toolName});try{return await e7({toolCall:e,tools:t})}catch(i){if(null==a||!(G.isInstance(i)||O.isInstance(i)))throw i;let o=null;try{o=await a({toolCall:e,tools:t,inputSchema:({toolName:e})=>{let{inputSchema:a}=t[e];return(0,h.C3)(a).jsonSchema},system:r,messages:s,error:i})}catch(e){throw new K({cause:e,originalError:i})}if(null==o)throw i;return await e7({toolCall:o,tools:t})}}catch(r){let t=await (0,h.NX)({text:e.input}),a=t.success?t.value:e.input;return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:a,dynamic:!0,invalid:!0,error:r}}}async function e7({toolCall:e,tools:t}){let a=e.toolName,r=t[a];if(null==r)throw new G({toolName:e.toolName,availableTools:Object.keys(t)});let s=(0,h.C3)(r.inputSchema),o=""===e.input.trim()?await (0,h.pW)({value:{},schema:s}):await (0,h.NX)({text:e.input,schema:s});if(!1===o.success)throw new O({toolName:a,toolInput:e.input,cause:o.error});return"dynamic"===r.type?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:o.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:e.toolCallId,toolName:a,input:o.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var e4=class{constructor({content:e,finishReason:t,usage:a,warnings:r,request:s,response:o,providerMetadata:i}){this.content=e,this.finishReason=t,this.usage=a,this.warnings=r,this.request=s,this.response=o,this.providerMetadata=i}get text(){return this.content.filter(e=>"text"===e.type).map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>"reasoning"===e.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>"file"===e.type).map(e=>e.file)}get sources(){return this.content.filter(e=>"source"===e.type)}get toolCalls(){return this.content.filter(e=>"tool-call"===e.type)}get staticToolCalls(){return this.toolCalls.filter(e=>!1===e.dynamic)}get dynamicToolCalls(){return this.toolCalls.filter(e=>!0===e.dynamic)}get toolResults(){return this.content.filter(e=>"tool-result"===e.type)}get staticToolResults(){return this.toolResults.filter(e=>!1===e.dynamic)}get dynamicToolResults(){return this.toolResults.filter(e=>!0===e.dynamic)}};async function e2({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}function e6({output:e,tool:t,errorMode:a}){return"text"===a?{type:"error-text",value:(0,f.e$)(e)}:"json"===a?{type:"error-json",value:e8(e)}:(null==t?void 0:t.toModelOutput)?t.toModelOutput(e):"string"==typeof e?{type:"text",value:e}:{type:"json",value:e8(e)}}function e8(e){return void 0===e?null:e}function e3({content:e,tools:t}){let a=[],r=e.filter(e=>"source"!==e.type).filter(e=>("tool-result"!==e.type||e.providerExecuted)&&("tool-error"!==e.type||e.providerExecuted)).filter(e=>"text"!==e.type||e.text.length>0).map(e=>{switch(e.type){case"text":return{type:"text",text:e.text,providerOptions:e.providerMetadata};case"reasoning":return{type:"reasoning",text:e.text,providerOptions:e.providerMetadata};case"file":return{type:"file",data:e.file.base64,mediaType:e.file.mediaType,providerOptions:e.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:e.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e6({tool:null==t?void 0:t[e.toolName],output:e.output,errorMode:"none"}),providerExecuted:!0,providerOptions:e.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e6({tool:null==t?void 0:t[e.toolName],output:e.error,errorMode:"json"}),providerOptions:e.providerMetadata}}});r.length>0&&a.push({role:"assistant",content:r});let s=e.filter(e=>"tool-result"===e.type||"tool-error"===e.type).filter(e=>!e.providerExecuted).map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e6({tool:null==t?void 0:t[e.toolName],output:"tool-result"===e.type?e.output:e.error,errorMode:"tool-error"===e.type?"text":"none"})}));return s.length>0&&a.push({role:"tool",content:s}),a}function e5(e,t){let a=new Headers(null!=e?e:{});for(let[e,r]of Object.entries(t))a.has(e)||a.set(e,r);return a}function e9({response:e,status:t,statusText:a,headers:r,stream:s}){e.writeHead(null!=t?t:200,a,r);let o=s.getReader();(async()=>{try{for(;;){let{done:t,value:a}=await o.read();if(t)break;e.write(a)}}catch(e){throw e}finally{e.end()}})()}(0,h.bF)({prefix:"aitxt",size:24});var te=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue("data: [DONE]\n\n")}})}},tt={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"},ta=g.G0([g.cf({type:g.i0("text-start"),id:g.Z_(),providerMetadata:eE.optional()}),g.cf({type:g.i0("text-delta"),id:g.Z_(),delta:g.Z_(),providerMetadata:eE.optional()}),g.cf({type:g.i0("text-end"),id:g.Z_(),providerMetadata:eE.optional()}),g.cf({type:g.i0("error"),errorText:g.Z_()}),g.cf({type:g.i0("tool-input-start"),toolCallId:g.Z_(),toolName:g.Z_(),providerExecuted:g.O7().optional(),dynamic:g.O7().optional()}),g.cf({type:g.i0("tool-input-delta"),toolCallId:g.Z_(),inputTextDelta:g.Z_()}),g.cf({type:g.i0("tool-input-available"),toolCallId:g.Z_(),toolName:g.Z_(),input:g._4(),providerExecuted:g.O7().optional(),providerMetadata:eE.optional(),dynamic:g.O7().optional()}),g.cf({type:g.i0("tool-input-error"),toolCallId:g.Z_(),toolName:g.Z_(),input:g._4(),providerExecuted:g.O7().optional(),providerMetadata:eE.optional(),dynamic:g.O7().optional(),errorText:g.Z_()}),g.cf({type:g.i0("tool-output-available"),toolCallId:g.Z_(),output:g._4(),providerExecuted:g.O7().optional(),dynamic:g.O7().optional(),preliminary:g.O7().optional()}),g.cf({type:g.i0("tool-output-error"),toolCallId:g.Z_(),errorText:g.Z_(),providerExecuted:g.O7().optional(),dynamic:g.O7().optional()}),g.cf({type:g.i0("reasoning"),text:g.Z_(),providerMetadata:eE.optional()}),g.cf({type:g.i0("reasoning-start"),id:g.Z_(),providerMetadata:eE.optional()}),g.cf({type:g.i0("reasoning-delta"),id:g.Z_(),delta:g.Z_(),providerMetadata:eE.optional()}),g.cf({type:g.i0("reasoning-end"),id:g.Z_(),providerMetadata:eE.optional()}),g.cf({type:g.i0("reasoning-part-finish")}),g.cf({type:g.i0("source-url"),sourceId:g.Z_(),url:g.Z_(),title:g.Z_().optional(),providerMetadata:eE.optional()}),g.cf({type:g.i0("source-document"),sourceId:g.Z_(),mediaType:g.Z_(),title:g.Z_(),filename:g.Z_().optional(),providerMetadata:eE.optional()}),g.cf({type:g.i0("file"),url:g.Z_(),mediaType:g.Z_(),providerMetadata:eE.optional()}),g.cf({type:g.Z_().startsWith("data-"),id:g.Z_().optional(),data:g._4(),transient:g.O7().optional()}),g.cf({type:g.i0("start-step")}),g.cf({type:g.i0("finish-step")}),g.cf({type:g.i0("start"),messageId:g.Z_().optional(),messageMetadata:g._4().optional()}),g.cf({type:g.i0("finish"),messageMetadata:g._4().optional()}),g.cf({type:g.i0("abort")}),g.cf({type:g.i0("message-metadata"),messageMetadata:g._4()})]);async function tr(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,h.NX)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,h.NX)({text:function(e){let t=["ROOT"],a=-1,r=null;function s(e,s,o){switch(e){case'"':a=s,t.pop(),t.push(o),t.push("INSIDE_STRING");break;case"f":case"t":case"n":a=s,r=s,t.pop(),t.push(o),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(o),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=s,t.pop(),t.push(o),t.push("INSIDE_NUMBER");break;case"{":a=s,t.pop(),t.push(o),t.push("INSIDE_OBJECT_START");break;case"[":a=s,t.pop(),t.push(o),t.push("INSIDE_ARRAY_START")}}function o(e,r){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=r,t.pop()}}function i(e,r){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=r,t.pop()}}for(let n=0;n<e.length;n++){let l=e[n];switch(t[t.length-1]){case"ROOT":s(l,n,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":a=n,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":s(l,n,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":o(l,n);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),a=n;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:a=n}break;case"INSIDE_ARRAY_START":"]"===l?(a=n,t.pop()):(a=n,s(l,n,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=n,t.pop();break;default:a=n}break;case"INSIDE_ARRAY_AFTER_COMMA":s(l,n,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),a=n;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=n;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&o(l,n);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&o(l,n);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n);break;default:t.pop()}break;case"INSIDE_LITERAL":{let s=e.substring(r,n+1);"false".startsWith(s)||"true".startsWith(s)||"null".startsWith(s)?a=n:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?o(l,n):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n))}}}let n=e.slice(0,a+1);for(let a=t.length-1;a>=0;a--)switch(t[a]){case"INSIDE_STRING":n+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":n+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":n+="]";break;case"INSIDE_LITERAL":{let t=e.substring(r,e.length);"true".startsWith(t)?n+="true".slice(t.length):"false".startsWith(t)?n+="false".slice(t.length):"null".startsWith(t)&&(n+="null".slice(t.length))}}return n}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function ts(e){return e.type.startsWith("tool-")}function to(e){return ts(e)||"dynamic-tool"===e.type}function ti(e){return e.type.split("-").slice(1).join("-")}function tn({lastMessage:e,messageId:t}){return{message:(null==e?void 0:e.role)==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function tl({stream:e,messageMetadataSchema:t,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:o,onData:i}){return e.pipeThrough(new TransformStream({async transform(e,n){await r(async({state:r,write:l})=>{var u,p,d,c;function m(e){let t=r.message.parts.filter(ts).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function f(e){let t=r.message.parts.filter(e=>"dynamic-tool"===e.type).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t}function y(e){var t;let a=r.message.parts.find(t=>ts(t)&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.rawInput=e.rawInput,a.preliminary=e.preliminary,a.providerExecuted=null!=(t=e.providerExecuted)?t:a.providerExecuted,null!=e.providerMetadata&&"input-available"===a.state&&(a.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,rawInput:e.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}function g(e){var t;let a=r.message.parts.find(t=>"dynamic-tool"===t.type&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.toolName=e.toolName,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.rawInput=null!=(t=e.rawInput)?t:a.rawInput,a.preliminary=e.preliminary,null!=e.providerMetadata&&"input-available"===a.state&&(a.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:"dynamic-tool",toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}async function v(e){if(null!=e){let a=null!=r.message.metadata?function e(t,a){if(void 0===t&&void 0===a)return;if(void 0===t)return a;if(void 0===a)return t;let r={...t};for(let s in a)if(Object.prototype.hasOwnProperty.call(a,s)){let o=a[s];if(void 0===o)continue;let i=s in t?t[s]:void 0,n=null!==o&&"object"==typeof o&&!Array.isArray(o)&&!(o instanceof Date)&&!(o instanceof RegExp),l=null!=i&&"object"==typeof i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp);n&&l?r[s]=e(i,o):r[s]=o}return r}(r.message.metadata,e):e;null!=t&&await (0,h.rJ)({value:a,schema:t}),r.message.metadata=a}}switch(e.type){case"text-start":{let t={type:"text",text:"",providerMetadata:e.providerMetadata,state:"streaming"};r.activeTextParts[e.id]=t,r.message.parts.push(t),l();break}case"text-delta":{let t=r.activeTextParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(u=e.providerMetadata)?u:t.providerMetadata,l();break}case"text-end":{let t=r.activeTextParts[e.id];t.state="done",t.providerMetadata=null!=(p=e.providerMetadata)?p:t.providerMetadata,delete r.activeTextParts[e.id],l();break}case"reasoning-start":{let t={type:"reasoning",text:"",providerMetadata:e.providerMetadata,state:"streaming"};r.activeReasoningParts[e.id]=t,r.message.parts.push(t),l();break}case"reasoning-delta":{let t=r.activeReasoningParts[e.id];t.text+=e.delta,t.providerMetadata=null!=(d=e.providerMetadata)?d:t.providerMetadata,l();break}case"reasoning-end":{let t=r.activeReasoningParts[e.id];t.providerMetadata=null!=(c=e.providerMetadata)?c:t.providerMetadata,t.state="done",delete r.activeReasoningParts[e.id],l();break}case"file":r.message.parts.push({type:"file",mediaType:e.mediaType,url:e.url}),l();break;case"source-url":r.message.parts.push({type:"source-url",sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),l();break;case"source-document":r.message.parts.push({type:"source-document",sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),l();break;case"tool-input-start":{let t=r.message.parts.filter(ts);r.partialToolCalls[e.toolCallId]={text:"",toolName:e.toolName,index:t.length,dynamic:e.dynamic},e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0}):y({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted}),l();break}case"tool-input-delta":{let t=r.partialToolCalls[e.toolCallId];t.text+=e.inputTextDelta;let{value:a}=await tr(t.text);t.dynamic?g({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a}):y({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a}),l();break}case"tool-input-available":e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerMetadata:e.providerMetadata}):y({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),l(),o&&!e.providerExecuted&&await o({toolCall:e});break;case"tool-input-error":e.dynamic?g({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:e.input,errorText:e.errorText,providerMetadata:e.providerMetadata}):y({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),l();break;case"tool-output-available":if(e.dynamic){let t=f(e.toolCallId);g({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-available",input:t.input,output:e.output,preliminary:e.preliminary})}else{let t=m(e.toolCallId);y({toolCallId:e.toolCallId,toolName:ti(t),state:"output-available",input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary})}l();break;case"tool-output-error":if(e.dynamic){let t=f(e.toolCallId);g({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-error",input:t.input,errorText:e.errorText})}else{let t=m(e.toolCallId);y({toolCallId:e.toolCallId,toolName:ti(t),state:"output-error",input:t.input,rawInput:t.rawInput,errorText:e.errorText})}l();break;case"start-step":r.message.parts.push({type:"step-start"});break;case"finish-step":r.activeTextParts={},r.activeReasoningParts={};break;case"start":null!=e.messageId&&(r.message.id=e.messageId),await v(e.messageMetadata),(null!=e.messageId||null!=e.messageMetadata)&&l();break;case"finish":case"message-metadata":await v(e.messageMetadata),null!=e.messageMetadata&&l();break;case"error":null==s||s(Error(e.errorText));break;default:if(e.type.startsWith("data-")){if((null==a?void 0:a[e.type])!=null&&await (0,h.rJ)({value:e.data,schema:a[e.type]}),e.transient){null==i||i(e);break}let t=null!=e.id?r.message.parts.find(t=>e.type===t.type&&e.id===t.id):void 0;null!=t?t.data=e.data:r.message.parts.push(e),null==i||i(e),l()}}n.enqueue(e)})}}))}function tu({messageId:e,originalMessages:t=[],onFinish:a,onError:r,stream:s}){let o=null==t?void 0:t[t.length-1];(null==o?void 0:o.role)!=="assistant"?o=void 0:e=o.id;let i=!1,n=s.pipeThrough(new TransformStream({transform(t,a){"start"===t.type&&null==t.messageId&&null!=e&&(t.messageId=e),"abort"===t.type&&(i=!0),a.enqueue(t)}}));if(null==a)return n;let l=tn({lastMessage:o?structuredClone(o):void 0,messageId:null!=e?e:""}),u=!1,p=async()=>{if(u||!a)return;u=!0;let e=l.message.id===(null==o?void 0:o.id);await a({isAborted:i,isContinuation:e,responseMessage:l.message,messages:[...e?t.slice(0,-1):t,l.message]})};return tl({stream:n,runUpdateMessageJob:async e=>{await e({state:l,write:()=>{}})},onError:r}).pipeThrough(new TransformStream({transform(e,t){t.enqueue(e)},async cancel(){await p()},async flush(){await p()}}))}function tp(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){let e=this.getReader(),t=!1;async function a(a){var r;t=!0;try{a&&await (null==(r=e.cancel)?void 0:r.call(e))}finally{try{e.releaseLock()}catch(e){}}}return{async next(){if(t)return{done:!0,value:void 0};let{done:r,value:s}=await e.read();return r?(await a(!0),{done:!0,value:void 0}):{done:!1,value:s}},return:async()=>(await a(!0),{done:!0,value:void 0}),async throw(e){throw await a(!0),e}}},t}async function td({stream:e,onError:t}){let a=e.getReader();try{for(;;){let{done:e}=await a.read();if(e)break}}catch(e){null==t||t(e)}finally{a.releaseLock()}}function tc(){let e,t;return{promise:new Promise((a,r)=>{e=a,t=r}),resolve:e,reject:t}}var tm=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||(this._promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this._promise}resolve(e){var t;this.status={type:"resolved",value:e},this._promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this._promise&&(null==(t=this._reject)||t.call(this,e))}};function th(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()}var tf=(0,h.bF)({prefix:"aitxt",size:24});function ty({model:e,tools:t,toolChoice:a,system:r,prompt:s,messages:o,maxRetries:i,abortSignal:n,headers:l,stopWhen:u=({steps:e})=>1===e.length,experimental_output:p,experimental_telemetry:d,prepareStep:c,providerOptions:m,experimental_activeTools:h,activeTools:f=h,experimental_repairToolCall:y,experimental_transform:g,experimental_download:v,includeRawChunks:b=!1,onChunk:I,onError:x=({error:e})=>{console.error(e)},onFinish:w,onAbort:T,onStepFinish:_,experimental_context:E,_internal:{now:S=th,generateId:M=tf,currentDate:R=()=>new Date}={},...C}){return new tg({model:em(e),telemetry:d,headers:l,settings:C,maxRetries:i,abortSignal:n,system:r,prompt:s,messages:o,tools:t,toolChoice:a,transforms:eK(g),activeTools:f,repairToolCall:y,stopConditions:eK(u),output:p,providerOptions:m,prepareStep:c,includeRawChunks:b,onChunk:I,onError:x,onFinish:w,onAbort:T,onStepFinish:_,now:S,currentDate:R,generateId:M,experimental_context:E,download:v})}var tg=class{constructor({model:e,telemetry:t,headers:a,settings:r,maxRetries:s,abortSignal:o,system:i,prompt:n,messages:l,tools:u,toolChoice:p,transforms:d,activeTools:c,repairToolCall:m,stopConditions:g,output:v,providerOptions:b,prepareStep:I,includeRawChunks:x,now:w,currentDate:T,generateId:_,onChunk:S,onError:M,onFinish:R,onAbort:k,onStepFinish:N,experimental_context:A,download:O}){let q,Z,D,P;this._totalUsage=new tm,this._finishReason=new tm,this._steps=new tm,this.output=v,this.includeRawChunks=x,this.tools=u;let j=[],$=[],U={},J=[],B=[],L={},G={},X=new TransformStream({async transform(e,t){var a,r,s,o;t.enqueue(e);let{part:i}=e;if(("text-delta"===i.type||"reasoning-delta"===i.type||"source"===i.type||"tool-call"===i.type||"tool-result"===i.type||"tool-input-start"===i.type||"tool-input-delta"===i.type||"raw"===i.type)&&await (null==S?void 0:S({chunk:i})),"error"===i.type&&await M({error:(o=i.error,y.QM.isInstance(o)||y.IC.isInstance(o)?new f.AX({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:o}):o)}),"text-start"===i.type&&(L[i.id]={type:"text",text:"",providerMetadata:i.providerMetadata},j.push(L[i.id])),"text-delta"===i.type){let e=L[i.id];if(null==e){t.enqueue({part:{type:"error",error:`text part ${i.id} not found`},partialOutput:void 0});return}e.text+=i.text,e.providerMetadata=null!=(a=i.providerMetadata)?a:e.providerMetadata}if("text-end"===i.type&&delete L[i.id],"reasoning-start"===i.type&&(G[i.id]={type:"reasoning",text:"",providerMetadata:i.providerMetadata},j.push(G[i.id])),"reasoning-delta"===i.type){let e=G[i.id];if(null==e){t.enqueue({part:{type:"error",error:`reasoning part ${i.id} not found`},partialOutput:void 0});return}e.text+=i.text,e.providerMetadata=null!=(r=i.providerMetadata)?r:e.providerMetadata}if("reasoning-end"===i.type){let e=G[i.id];if(null==e){t.enqueue({part:{type:"error",error:`reasoning part ${i.id} not found`},partialOutput:void 0});return}e.providerMetadata=null!=(s=i.providerMetadata)?s:e.providerMetadata,delete G[i.id]}if("file"===i.type&&j.push({type:"file",file:i.file}),"source"===i.type&&j.push(i),"tool-call"===i.type&&j.push(i),"tool-result"!==i.type||i.preliminary||j.push(i),"tool-error"===i.type&&j.push(i),"start-step"===i.type&&(U=i.request,J=i.warnings),"finish-step"===i.type){let e=e3({content:j,tools:u}),t=new e4({content:j,finishReason:i.finishReason,usage:i.usage,warnings:J,request:U,response:{...i.response,messages:[...$,...e]},providerMetadata:i.providerMetadata});await (null==N?void 0:N(t)),E(J),B.push(t),j=[],G={},L={},$.push(...e),q.resolve()}"finish"===i.type&&(P=i.totalUsage,D=i.finishReason)},async flush(e){try{if(0===B.length){let e=new F({message:"No output generated. Check the stream for errors."});et._finishReason.reject(e),et._totalUsage.reject(e),et._steps.reject(e);return}let e=null!=D?D:"unknown",a=null!=P?P:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};et._finishReason.resolve(e),et._totalUsage.resolve(a),et._steps.resolve(B);let r=B[B.length-1];await (null==R?void 0:R({finishReason:e,totalUsage:a,usage:r.usage,content:r.content,text:r.text,reasoningText:r.reasoningText,reasoning:r.reasoning,files:r.files,sources:r.sources,toolCalls:r.toolCalls,staticToolCalls:r.staticToolCalls,dynamicToolCalls:r.dynamicToolCalls,toolResults:r.toolResults,staticToolResults:r.staticToolResults,dynamicToolResults:r.dynamicToolResults,request:r.request,response:r.response,warnings:r.warnings,providerMetadata:r.providerMetadata,steps:B})),Z.setAttributes(eW({telemetry:t,attributes:{"ai.response.finishReason":e,"ai.response.text":{output:()=>r.text},"ai.response.toolCalls":{output:()=>{var e;return(null==(e=r.toolCalls)?void 0:e.length)?JSON.stringify(r.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(r.providerMetadata),"ai.usage.inputTokens":a.inputTokens,"ai.usage.outputTokens":a.outputTokens,"ai.usage.totalTokens":a.totalTokens,"ai.usage.reasoningTokens":a.reasoningTokens,"ai.usage.cachedInputTokens":a.cachedInputTokens}}))}catch(t){e.error(t)}finally{Z.end()}}}),W=function(){let e=[],t=null,a=!1,r=tc(),s=()=>{a=!0,r.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()},o=async()=>{if(a&&0===e.length){null==t||t.close();return}if(0===e.length)return r=tc(),await r.promise,o();try{let{value:r,done:s}=await e[0].read();s?(e.shift(),e.length>0?await o():a&&(null==t||t.close())):null==t||t.enqueue(r)}catch(a){null==t||t.error(a),e.shift(),s()}};return{stream:new ReadableStream({start(e){t=e},pull:o,async cancel(){for(let t of e)await t.cancel();e=[],a=!0}}),addStream:t=>{if(a)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),r.resolve()},close:()=>{a=!0,r.resolve(),0===e.length&&(null==t||t.close())},terminate:s}}();this.addStream=W.addStream,this.closeStream=W.close;let V=W.stream.getReader(),K=new ReadableStream({async start(e){e.enqueue({type:"start"})},async pull(e){function t(){null==k||k({steps:B}),e.enqueue({type:"abort"}),e.close()}try{let{done:a,value:r}=await V.read();if(a){e.close();return}if(null==o?void 0:o.aborted){t();return}e.enqueue(r)}catch(a){(0,h.D_)(a)&&(null==o?void 0:o.aborted)?t():e.error(a)}},cancel:e=>W.stream.cancel(e)});for(let e of d)K=K.pipeThrough(e({tools:u,stopStream(){W.terminate()}}));this.baseStream=K.pipeThrough(function(e){let t;if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let a="",r="",s="";function o({controller:e,partialOutput:a}){e.enqueue({part:{type:"text-delta",id:t,text:r},partialOutput:a}),r=""}return new TransformStream({async transform(i,n){if("finish-step"===i.type&&r.length>0&&o({controller:n}),"text-delta"!==i.type&&"text-start"!==i.type&&"text-end"!==i.type){n.enqueue({part:i,partialOutput:void 0});return}if(null==t)t=i.id;else if(i.id!==t){n.enqueue({part:i,partialOutput:void 0});return}if("text-start"===i.type){n.enqueue({part:i,partialOutput:void 0});return}if("text-end"===i.type){r.length>0&&o({controller:n}),n.enqueue({part:i,partialOutput:void 0});return}a+=i.text,r+=i.text;let l=await e.parsePartial({text:a});if(null!=l){let e=JSON.stringify(l.partial);e!==s&&(o({controller:n,partialOutput:l.partial}),s=e)}}})}(v)).pipeThrough(X);let{maxRetries:Y,retry:z}=eQ({maxRetries:s,abortSignal:o}),Q=eL(t),H=function({maxOutputTokens:e,temperature:t,topP:a,topK:r,presencePenalty:s,frequencyPenalty:o,seed:i,stopSequences:n}){if(null!=e){if(!Number.isInteger(e))throw new C({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new C({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new C({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=a&&"number"!=typeof a)throw new C({parameter:"topP",value:a,message:"topP must be a number"});if(null!=r&&"number"!=typeof r)throw new C({parameter:"topK",value:r,message:"topK must be a number"});if(null!=s&&"number"!=typeof s)throw new C({parameter:"presencePenalty",value:s,message:"presencePenalty must be a number"});if(null!=o&&"number"!=typeof o)throw new C({parameter:"frequencyPenalty",value:o,message:"frequencyPenalty must be a number"});if(null!=i&&!Number.isInteger(i))throw new C({parameter:"seed",value:i,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:a,topK:r,presencePenalty:s,frequencyPenalty:o,stopSequences:n,seed:i}}(r),ee=eU({model:e,telemetry:t,headers:a,settings:{...H,maxRetries:Y}}),et=this;eG({name:"ai.streamText",attributes:eW({telemetry:t,attributes:{...e$({operationId:"ai.streamText",telemetry:t}),...ee,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:n,messages:l})}}}),tracer:Q,endWhenDone:!1,fn:async r=>{async function s({currentStep:r,responseMessages:d,usage:f}){var y,x,E,S,M;let R,C;let k=et.includeRawChunks;q=new tm;let N=await ej({system:i,prompt:n,messages:l}),Z=[...N.messages,...d],D=await (null==I?void 0:I({model:e,steps:B,stepNumber:B.length,messages:Z})),P=await ew({prompt:{system:null!=(y=null==D?void 0:D.system)?y:N.system,messages:null!=(x=null==D?void 0:D.messages)?x:Z},supportedUrls:await e.supportedUrls,download:O}),j=em(null!=(E=null==D?void 0:D.model)?E:e),{toolChoice:$,tools:U}=function({tools:e,toolChoice:t,activeTools:a}){return null!=e&&Object.keys(e).length>0?{tools:(null!=a?Object.entries(e).filter(([e])=>a.includes(e)):Object.entries(e)).map(([e,t])=>{let a=t.type;switch(a){case void 0:case"dynamic":case"function":return{type:"function",name:e,description:t.description,inputSchema:(0,h.C3)(t.inputSchema).jsonSchema,providerOptions:t.providerOptions};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${a}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:u,toolChoice:null!=(S=null==D?void 0:D.toolChoice)?S:p,activeTools:null!=(M=null==D?void 0:D.activeTools)?M:c}),{result:{stream:F,response:J,request:L},doStreamSpan:G,startTimestampMs:X}=await z(()=>eG({name:"ai.streamText.doStream",attributes:eW({telemetry:t,attributes:{...e$({operationId:"ai.streamText.doStream",telemetry:t}),...ee,"ai.model.provider":j.provider,"ai.model.id":j.modelId,"ai.prompt.messages":{input:()=>JSON.stringify(P.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(e=>{var t;return"file"===e.type?{...e,data:e.data instanceof Uint8Array?"string"==typeof(t=e.data)?t:t instanceof ArrayBuffer?(0,h.k0)(new Uint8Array(t)):(0,h.k0)(t):e.data}:e})})))},"ai.prompt.tools":{input:()=>null==U?void 0:U.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>null!=$?JSON.stringify($):void 0},"gen_ai.system":j.provider,"gen_ai.request.model":j.modelId,"gen_ai.request.frequency_penalty":H.frequencyPenalty,"gen_ai.request.max_tokens":H.maxOutputTokens,"gen_ai.request.presence_penalty":H.presencePenalty,"gen_ai.request.stop_sequences":H.stopSequences,"gen_ai.request.temperature":H.temperature,"gen_ai.request.top_k":H.topK,"gen_ai.request.top_p":H.topP}}),tracer:Q,endWhenDone:!1,fn:async e=>({startTimestampMs:w(),doStreamSpan:e,result:await j.doStream({...H,tools:U,toolChoice:$,responseFormat:null==v?void 0:v.responseFormat,prompt:P,providerOptions:b,abortSignal:o,headers:a,includeRawChunks:k})})})),W=function({tools:e,generatorStream:t,tracer:a,telemetry:r,system:s,messages:o,abortSignal:i,repairToolCall:n,experimental_context:l}){let u,p=null,d=new ReadableStream({start(e){p=e}}),c=new Set,m=new Map,f=!1;function y(){f&&0===c.size&&(null!=u&&p.enqueue(u),p.close())}let g=new TransformStream({async transform(t,d){let f=t.type;switch(f){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":d.enqueue(t);break;case"file":d.enqueue({type:"file",file:new e0({data:t.data,mediaType:t.mediaType})});break;case"finish":u={type:"finish",finishReason:t.finishReason,usage:t.usage,providerMetadata:t.providerMetadata};break;case"tool-call":try{let u=await e1({toolCall:t,tools:e,repairToolCall:n,system:s,messages:o});if(d.enqueue(u),u.invalid){p.enqueue({type:"tool-error",toolCallId:u.toolCallId,toolName:u.toolName,input:u.input,error:(0,h.e$)(u.error),dynamic:!0});break}let f=e[u.toolName];if(m.set(u.toolCallId,u.input),null!=f.onInputAvailable&&await f.onInputAvailable({input:u.input,toolCallId:u.toolCallId,messages:o,abortSignal:i,experimental_context:l}),null!=f.execute&&!0!==u.providerExecuted){let e=(0,h.Ox)();c.add(e),eG({name:"ai.toolCall",attributes:eW({telemetry:r,attributes:{...e$({operationId:"ai.toolCall",telemetry:r}),"ai.toolCall.name":u.toolName,"ai.toolCall.id":u.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(u.input)}}}),tracer:a,fn:async t=>{let a;try{for await(let e of(0,h.aN)({execute:f.execute.bind(f),input:u.input,options:{toolCallId:u.toolCallId,messages:o,abortSignal:i,experimental_context:l}}))p.enqueue({...u,type:"tool-result",output:e.output,..."preliminary"===e.type&&{preliminary:!0}}),"final"===e.type&&(a=e.output)}catch(a){eX(t,a),p.enqueue({...u,type:"tool-error",error:a}),c.delete(e),y();return}c.delete(e),y();try{t.setAttributes(eW({telemetry:r,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}}})}}catch(e){p.enqueue({type:"error",error:e})}break;case"tool-result":{let e=t.toolName;t.isError?p.enqueue({type:"tool-error",toolCallId:t.toolCallId,toolName:e,input:m.get(t.toolCallId),providerExecuted:t.providerExecuted,error:t.result}):d.enqueue({type:"tool-result",toolCallId:t.toolCallId,toolName:e,input:m.get(t.toolCallId),output:t.result,providerExecuted:t.providerExecuted});break}default:throw Error(`Unhandled chunk type: ${f}`)}},flush(){f=!0,y()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),d.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:u,generatorStream:F,tracer:Q,telemetry:t,system:i,messages:Z,repairToolCall:m,abortSignal:o,experimental_context:A}),V=null!=L?L:{},K=[],Y=[],ea={},er="unknown",es={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},eo=!0,ei={id:_(),timestamp:T(),modelId:e.modelId},en="";et.addStream(W.pipeThrough(new TransformStream({async transform(e,t){var a,r,s,i;if("stream-start"===e.type){R=e.warnings;return}if(eo){let e=w()-X;eo=!1,G.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),G.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"start-step",request:V,warnings:null!=R?R:[]})}let n=e.type;switch(n){case"text-start":case"text-end":case"reasoning-start":case"reasoning-end":case"file":case"source":t.enqueue(e);break;case"text-delta":e.delta.length>0&&(t.enqueue({type:"text-delta",id:e.id,text:e.delta,providerMetadata:e.providerMetadata}),en+=e.delta);break;case"reasoning-delta":t.enqueue({type:"reasoning-delta",id:e.id,text:e.delta,providerMetadata:e.providerMetadata});break;case"tool-call":t.enqueue(e),K.push(e);break;case"tool-result":t.enqueue(e),e.preliminary||Y.push(e);break;case"tool-error":t.enqueue(e),Y.push(e);break;case"response-metadata":ei={id:null!=(a=e.id)?a:ei.id,timestamp:null!=(r=e.timestamp)?r:ei.timestamp,modelId:null!=(s=e.modelId)?s:ei.modelId};break;case"finish":{es=e.usage,er=e.finishReason,C=e.providerMetadata;let t=w()-X;G.addEvent("ai.stream.finish"),G.setAttributes({"ai.response.msToFinish":t,"ai.response.avgOutputTokensPerSecond":1e3*(null!=(i=es.outputTokens)?i:0)/t});break}case"tool-input-start":{ea[e.id]=e.toolName;let a=null==u?void 0:u[e.toolName];(null==a?void 0:a.onInputStart)!=null&&await a.onInputStart({toolCallId:e.id,messages:Z,abortSignal:o,experimental_context:A}),t.enqueue({...e,dynamic:(null==a?void 0:a.type)==="dynamic"});break}case"tool-input-end":delete ea[e.id],t.enqueue(e);break;case"tool-input-delta":{let a=ea[e.id],r=null==u?void 0:u[a];(null==r?void 0:r.onInputDelta)!=null&&await r.onInputDelta({inputTextDelta:e.delta,toolCallId:e.id,messages:Z,abortSignal:o,experimental_context:A}),t.enqueue(e);break}case"error":t.enqueue(e),er="error";break;case"raw":k&&t.enqueue(e);break;default:throw Error(`Unknown chunk type: ${n}`)}},async flush(e){var a;let o=K.length>0?JSON.stringify(K):void 0;try{G.setAttributes(eW({telemetry:t,attributes:{"ai.response.finishReason":er,"ai.response.text":{output:()=>en},"ai.response.toolCalls":{output:()=>o},"ai.response.id":ei.id,"ai.response.model":ei.modelId,"ai.response.timestamp":ei.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(C),"ai.usage.inputTokens":es.inputTokens,"ai.usage.outputTokens":es.outputTokens,"ai.usage.totalTokens":es.totalTokens,"ai.usage.reasoningTokens":es.reasoningTokens,"ai.usage.cachedInputTokens":es.cachedInputTokens,"gen_ai.response.finish_reasons":[er],"gen_ai.response.id":ei.id,"gen_ai.response.model":ei.modelId,"gen_ai.usage.input_tokens":es.inputTokens,"gen_ai.usage.output_tokens":es.outputTokens}}))}catch(e){}finally{G.end()}e.enqueue({type:"finish-step",finishReason:er,usage:es,providerMetadata:C,response:{...ei,headers:null==J?void 0:J.headers}});let i=(a=es,{inputTokens:eV(f.inputTokens,a.inputTokens),outputTokens:eV(f.outputTokens,a.outputTokens),totalTokens:eV(f.totalTokens,a.totalTokens),reasoningTokens:eV(f.reasoningTokens,a.reasoningTokens),cachedInputTokens:eV(f.cachedInputTokens,a.cachedInputTokens)});await q.promise;let n=K.filter(e=>!0!==e.providerExecuted),l=Y.filter(e=>!0!==e.providerExecuted);if(n.length>0&&l.length===n.length&&!await e2({stopConditions:g,steps:B})){d.push(...e3({content:B[B.length-1].content,tools:u}));try{await s({currentStep:r+1,responseMessages:d,usage:i})}catch(t){e.enqueue({type:"error",error:t}),et.closeStream()}}else e.enqueue({type:"finish",finishReason:er,totalUsage:i}),et.closeStream()}})))}Z=r,await s({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(e=>{et.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),et.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return tp(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.text)}})))}get fullStream(){return tp(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await td({stream:this.fullStream,onError:null==e?void 0:e.onError})}catch(a){null==(t=null==e?void 0:e.onError)||t.call(e,a)}}get experimental_partialOutputStream(){if(null==this.output)throw new T;return tp(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:r,sendReasoning:s=!0,sendSources:o=!1,sendStart:i=!0,sendFinish:n=!0,onError:l=f.e$}={}){let u=null!=t?function({originalMessages:e,responseMessageId:t}){if(null==e)return;let a=e[e.length-1];return(null==a?void 0:a.role)==="assistant"?a.id:"function"==typeof t?t():t}({originalMessages:e,responseMessageId:t}):void 0,p={},d=e=>{var t,a;let r=p[e];return!((null==(a=null==(t=this.tools)?void 0:t[r])?void 0:a.type)!=="dynamic")||void 0};return tp(tu({stream:this.fullStream.pipeThrough(new TransformStream({transform:async(e,t)=>{let a=null==r?void 0:r({part:e}),c=e.type;switch(c){case"text-start":t.enqueue({type:"text-start",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"text-delta":t.enqueue({type:"text-delta",id:e.id,delta:e.text,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"text-end":t.enqueue({type:"text-end",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-start":t.enqueue({type:"reasoning-start",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-delta":s&&t.enqueue({type:"reasoning-delta",id:e.id,delta:e.text,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-end":t.enqueue({type:"reasoning-end",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"file":t.enqueue({type:"file",mediaType:e.file.mediaType,url:`data:${e.file.mediaType};base64,${e.file.base64}`});break;case"source":o&&"url"===e.sourceType&&t.enqueue({type:"source-url",sourceId:e.id,url:e.url,title:e.title,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}}),o&&"document"===e.sourceType&&t.enqueue({type:"source-document",sourceId:e.id,mediaType:e.mediaType,title:e.title,filename:e.filename,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"tool-input-start":{p[e.id]=e.toolName;let a=d(e.id);t.enqueue({type:"tool-input-start",toolCallId:e.id,toolName:e.toolName,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=a?{dynamic:a}:{}});break}case"tool-input-delta":t.enqueue({type:"tool-input-delta",toolCallId:e.id,inputTextDelta:e.delta});break;case"tool-call":{p[e.toolCallId]=e.toolName;let a=d(e.toolCallId);e.invalid?t.enqueue({type:"tool-input-error",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{},...null!=a?{dynamic:a}:{},errorText:l(e.error)}):t.enqueue({type:"tool-input-available",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{},...null!=a?{dynamic:a}:{}});break}case"tool-result":{let a=d(e.toolCallId);t.enqueue({type:"tool-output-available",toolCallId:e.toolCallId,output:e.output,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.preliminary?{preliminary:e.preliminary}:{},...null!=a?{dynamic:a}:{}});break}case"tool-error":{let a=d(e.toolCallId);t.enqueue({type:"tool-output-error",toolCallId:e.toolCallId,errorText:l(e.error),...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=a?{dynamic:a}:{}});break}case"error":t.enqueue({type:"error",errorText:l(e.error)});break;case"start-step":t.enqueue({type:"start-step"});break;case"finish-step":t.enqueue({type:"finish-step"});break;case"start":i&&t.enqueue({type:"start",...null!=a?{messageMetadata:a}:{},...null!=u?{messageId:u}:{}});break;case"finish":n&&t.enqueue({type:"finish",...null!=a?{messageMetadata:a}:{}});break;case"abort":t.enqueue(e);break;case"tool-input-end":case"raw":break;default:throw Error(`Unknown chunk type: ${c}`)}null!=a&&"start"!==c&&"finish"!==c&&t.enqueue({type:"message-metadata",messageMetadata:a})}})),messageId:null!=u?u:null==t?void 0:t(),originalMessages:e,onFinish:a,onError:l}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:a,onFinish:r,messageMetadata:s,sendReasoning:o,sendSources:i,sendFinish:n,sendStart:l,onError:u,...p}={}){!function({response:e,status:t,statusText:a,headers:r,stream:s,consumeSseStream:o}){let i=s.pipeThrough(new te);if(o){let[e,t]=i.tee();i=e,o({stream:t})}e9({response:e,status:t,statusText:a,headers:Object.fromEntries(e5(r,tt).entries()),stream:i.pipeThrough(new TextEncoderStream)})}({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:a,onFinish:r,messageMetadata:s,sendReasoning:o,sendSources:i,sendFinish:n,sendStart:l,onError:u}),...p})}pipeTextStreamToResponse(e,t){!function({response:e,status:t,statusText:a,headers:r,textStream:s}){e9({response:e,status:t,statusText:a,headers:Object.fromEntries(e5(r,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:s.pipeThrough(new TextEncoderStream)})}({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:r,sendReasoning:s,sendSources:o,sendFinish:i,sendStart:n,onError:l,...u}={}){return function({status:e,statusText:t,headers:a,stream:r,consumeSseStream:s}){let o=r.pipeThrough(new te);if(s){let[e,t]=o.tee();o=e,s({stream:t})}return new Response(o.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:e5(a,tt)})}({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:r,sendReasoning:s,sendSources:o,sendFinish:i,sendStart:n,onError:l}),...u})}toTextStreamResponse(e){return function({status:e,statusText:t,headers:a,textStream:r}){return new Response(r.pipeThrough(new TextEncoderStream),{status:null!=e?e:200,statusText:t,headers:e5(a,{"content-type":"text/plain; charset=utf-8"})})}({textStream:this.textStream,...e})}};async function tv({model:e,value:t,providerOptions:a,maxRetries:r,abortSignal:s,headers:o,experimental_telemetry:i}){let n=eh(e),{maxRetries:l,retry:u}=eQ({maxRetries:r,abortSignal:s}),p=eU({model:n,telemetry:i,headers:o,settings:{maxRetries:l}}),d=eL(i);return eG({name:"ai.embed",attributes:eW({telemetry:i,attributes:{...e$({operationId:"ai.embed",telemetry:i}),...p,"ai.value":{input:()=>JSON.stringify(t)}}}),tracer:d,fn:async e=>{let{embedding:r,usage:l,response:c,providerMetadata:m}=await u(()=>eG({name:"ai.embed.doEmbed",attributes:eW({telemetry:i,attributes:{...e$({operationId:"ai.embed.doEmbed",telemetry:i}),...p,"ai.values":{input:()=>[JSON.stringify(t)]}}}),tracer:d,fn:async e=>{var r;let l=await n.doEmbed({values:[t],abortSignal:s,headers:o,providerOptions:a}),u=l.embeddings[0],p=null!=(r=l.usage)?r:{tokens:NaN};return e.setAttributes(eW({telemetry:i,attributes:{"ai.embeddings":{output:()=>l.embeddings.map(e=>JSON.stringify(e))},"ai.usage.tokens":p.tokens}})),{embedding:u,usage:p,providerMetadata:l.providerMetadata,response:l.response}}}));return e.setAttributes(eW({telemetry:i,attributes:{"ai.embedding":{output:()=>JSON.stringify(r)},"ai.usage.tokens":l.tokens}})),new tb({value:t,embedding:r,usage:l,providerMetadata:m,response:c})}})}var tb=class{constructor(e){this.value=e.value,this.embedding=e.embedding,this.usage=e.usage,this.providerMetadata=e.providerMetadata,this.response=e.response}};function tI(e,t){if(t<=0)throw Error("chunkSize must be greater than 0");let a=[];for(let r=0;r<e.length;r+=t)a.push(e.slice(r,r+t));return a}async function tx({model:e,values:t,maxParallelCalls:a=1/0,maxRetries:r,abortSignal:s,headers:o,providerOptions:i,experimental_telemetry:n}){let l=eh(e),{maxRetries:u,retry:p}=eQ({maxRetries:r,abortSignal:s}),d=eU({model:l,telemetry:n,headers:o,settings:{maxRetries:u}}),c=eL(n);return eG({name:"ai.embedMany",attributes:eW({telemetry:n,attributes:{...e$({operationId:"ai.embedMany",telemetry:n}),...d,"ai.values":{input:()=>t.map(e=>JSON.stringify(e))}}}),tracer:c,fn:async e=>{var r;let u;let[m,h]=await Promise.all([l.maxEmbeddingsPerCall,l.supportsParallelCalls]);if(null==m||m===1/0){let{embeddings:a,usage:r,response:u,providerMetadata:m}=await p(()=>eG({name:"ai.embedMany.doEmbed",attributes:eW({telemetry:n,attributes:{...e$({operationId:"ai.embedMany.doEmbed",telemetry:n}),...d,"ai.values":{input:()=>t.map(e=>JSON.stringify(e))}}}),tracer:c,fn:async e=>{var a;let r=await l.doEmbed({values:t,abortSignal:s,headers:o,providerOptions:i}),u=r.embeddings,p=null!=(a=r.usage)?a:{tokens:NaN};return e.setAttributes(eW({telemetry:n,attributes:{"ai.embeddings":{output:()=>u.map(e=>JSON.stringify(e))},"ai.usage.tokens":p.tokens}})),{embeddings:u,usage:p,providerMetadata:r.providerMetadata,response:r.response}}}));return e.setAttributes(eW({telemetry:n,attributes:{"ai.embeddings":{output:()=>a.map(e=>JSON.stringify(e))},"ai.usage.tokens":r.tokens}})),new tw({values:t,embeddings:a,usage:r,providerMetadata:m,responses:[u]})}let f=tI(t,m),y=[],g=[],v=0;for(let e of tI(f,h?a:1))for(let t of(await Promise.all(e.map(e=>p(()=>eG({name:"ai.embedMany.doEmbed",attributes:eW({telemetry:n,attributes:{...e$({operationId:"ai.embedMany.doEmbed",telemetry:n}),...d,"ai.values":{input:()=>e.map(e=>JSON.stringify(e))}}}),tracer:c,fn:async t=>{var a;let r=await l.doEmbed({values:e,abortSignal:s,headers:o,providerOptions:i}),u=r.embeddings,p=null!=(a=r.usage)?a:{tokens:NaN};return t.setAttributes(eW({telemetry:n,attributes:{"ai.embeddings":{output:()=>u.map(e=>JSON.stringify(e))},"ai.usage.tokens":p.tokens}})),{embeddings:u,usage:p,providerMetadata:r.providerMetadata,response:r.response}}}))))))if(y.push(...t.embeddings),g.push(t.response),v+=t.usage.tokens,t.providerMetadata){if(u)for(let[e,a]of Object.entries(t.providerMetadata))u[e]={...null!=(r=u[e])?r:{},...a};else u={...t.providerMetadata}}return e.setAttributes(eW({telemetry:n,attributes:{"ai.embeddings":{output:()=>y.map(e=>JSON.stringify(e))},"ai.usage.tokens":v}})),new tw({values:t,embeddings:y,usage:{tokens:v},providerMetadata:u,responses:g})}})}var tw=class{constructor(e){this.values=e.values,this.embeddings=e.embeddings,this.usage=e.usage,this.providerMetadata=e.providerMetadata,this.responses=e.responses}};(0,h.bF)({prefix:"aiobj",size:24});var tT=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,a)=>{this.queue.push(async()=>{try{await e(),t()}catch(e){a(e)}}),this.processQueue()})}};(0,h.bF)({prefix:"aiobj",size:24}),((e,t)=>{for(var a in t)b(e,a,{get:t[a],enumerable:!0})})({},{object:()=>tE,text:()=>t_});var t_=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:e})=>({partial:e}),parseOutput:async({text:e})=>e}),tE=({schema:e})=>{let t=(0,h.C3)(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:e}){let t=await tr(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput({text:e},a){let r=await (0,h.NX)({text:e});if(!r.success)throw new P({message:"No object generated: could not parse the response.",cause:r.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});let s=await (0,h.pW)({value:r.value,schema:t});if(!s.success)throw new P({message:"No object generated: response did not match schema.",cause:s.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});return s.value}}};function tS({tagName:e,separator:t="\n",startWithReasoning:a=!1}){let r=`<${e}>`,s=`</${e}>`;return{middlewareVersion:"v2",wrapGenerate:async({doGenerate:e})=>{let{content:o,...i}=await e(),n=[];for(let e of o){if("text"!==e.type){n.push(e);continue}let o=a?r+e.text:e.text,i=RegExp(`${r}(.*?)${s}`,"gs"),l=Array.from(o.matchAll(i));if(!l.length){n.push(e);continue}let u=l.map(e=>e[1]).join(t),p=o;for(let e=l.length-1;e>=0;e--){let a=l[e],r=p.slice(0,a.index),s=p.slice(a.index+a[0].length);p=r+(r.length>0&&s.length>0?t:"")+s}n.push({type:"reasoning",text:u}),n.push({type:"text",text:p})}return{content:n,...i}},wrapStream:async({doStream:e})=>{let o;let{stream:i,...n}=await e(),l={};return{stream:i.pipeThrough(new TransformStream({transform:(e,i)=>{if("text-start"===e.type){o=e;return}if("text-end"===e.type&&o&&(i.enqueue(o),o=void 0),"text-delta"!==e.type){i.enqueue(e);return}null==l[e.id]&&(l[e.id]={isFirstReasoning:!0,isFirstText:!0,afterSwitch:!1,isReasoning:a,buffer:"",idCounter:0,textId:e.id});let n=l[e.id];function u(e){if(e.length>0){let a=!n.afterSwitch||(n.isReasoning?n.isFirstReasoning:n.isFirstText)?"":t;n.isReasoning&&(n.afterSwitch||n.isFirstReasoning)&&i.enqueue({type:"reasoning-start",id:`reasoning-${n.idCounter}`}),n.isReasoning?i.enqueue({type:"reasoning-delta",delta:a+e,id:`reasoning-${n.idCounter}`}):(o&&(i.enqueue(o),o=void 0),i.enqueue({type:"text-delta",delta:a+e,id:n.textId})),n.afterSwitch=!1,n.isReasoning?n.isFirstReasoning=!1:n.isFirstText=!1}}for(n.buffer+=e.delta;;){let e=n.isReasoning?s:r,t=function(e,t){if(0===t.length)return null;let a=e.indexOf(t);if(-1!==a)return a;for(let a=e.length-1;a>=0;a--){let r=e.substring(a);if(t.startsWith(r))return a}return null}(n.buffer,e);if(null==t){u(n.buffer),n.buffer="";break}if(u(n.buffer.slice(0,t)),t+e.length<=n.buffer.length)n.buffer=n.buffer.slice(t+e.length),n.isReasoning&&i.enqueue({type:"reasoning-end",id:`reasoning-${n.idCounter++}`}),n.isReasoning=!n.isReasoning,n.afterSwitch=!0;else{n.buffer=n.buffer.slice(t);break}}}})),...n}}}}var tM=({model:e,middleware:t,modelId:a,providerId:r})=>eK(t).reverse().reduce((e,t)=>tR({model:e,middleware:t,modelId:a,providerId:r}),e),tR=({model:e,middleware:{transformParams:t,wrapGenerate:a,wrapStream:r,overrideProvider:s,overrideModelId:o,overrideSupportedUrls:i},modelId:n,providerId:l})=>{var u,p,d;async function c({params:a,type:r}){return t?await t({params:a,type:r,model:e}):a}return{specificationVersion:"v2",provider:null!=(u=null!=l?l:null==s?void 0:s({model:e}))?u:e.provider,modelId:null!=(p=null!=n?n:null==o?void 0:o({model:e}))?p:e.modelId,supportedUrls:null!=(d=null==i?void 0:i({model:e}))?d:e.supportedUrls,async doGenerate(t){let r=await c({params:t,type:"generate"}),s=async()=>e.doGenerate(r),o=async()=>e.doStream(r);return a?a({doGenerate:s,doStream:o,params:r,model:e}):s()},async doStream(t){let a=await c({params:t,type:"stream"}),s=async()=>e.doGenerate(a),o=async()=>e.doStream(a);return r?r({doGenerate:s,doStream:o,params:a,model:e}):o()}}},tC=(Symbol.for("vercel.ai.error.AI_NoSuchProviderError"),g.d7({name:g.Z_(),version:g.Z_()})),tk=g.d7({_meta:g.jt(g.Ry({}).loose())}),tN=g.Ry({method:g.Z_(),params:g.jt(tk)}),tA=g.d7({experimental:g.jt(g.Ry({}).loose()),logging:g.jt(g.Ry({}).loose()),prompts:g.jt(g.d7({listChanged:g.jt(g.O7())})),resources:g.jt(g.d7({subscribe:g.jt(g.O7()),listChanged:g.jt(g.O7())})),tools:g.jt(g.d7({listChanged:g.jt(g.O7())}))});tk.extend({protocolVersion:g.Z_(),capabilities:tA,serverInfo:tC,instructions:g.jt(g.Z_())});var tO=tk.extend({nextCursor:g.jt(g.Z_())}),tq=g.Ry({name:g.Z_(),description:g.jt(g.Z_()),inputSchema:g.Ry({type:g.i0("object"),properties:g.jt(g.Ry({}).loose())}).loose()}).loose();tO.extend({tools:g.IX(tq)});var tZ=g.Ry({type:g.i0("text"),text:g.Z_()}).loose(),tD=g.Ry({type:g.i0("image"),data:g.US(),mimeType:g.Z_()}).loose(),tP=g.Ry({uri:g.Z_(),mimeType:g.jt(g.Z_())}).loose(),tj=tP.extend({text:g.Z_()}),t$=tP.extend({blob:g.US()}),tU=g.Ry({type:g.i0("resource"),resource:g.G0([tj,t$])}).loose();tk.extend({content:g.IX(g.G0([tZ,tD,tU])),isError:g.O7().default(!1).optional()}).or(tk.extend({toolResult:g._4()}));var tF=g.Ry({jsonrpc:g.i0("2.0"),id:g.G0([g.Z_(),g.Rx().int()])}).merge(tN).strict(),tJ=g.Ry({jsonrpc:g.i0("2.0"),id:g.G0([g.Z_(),g.Rx().int()]),result:tk}).strict(),tB=g.Ry({jsonrpc:g.i0("2.0"),id:g.G0([g.Z_(),g.Rx().int()]),error:g.Ry({code:g.Rx().int(),message:g.Z_(),data:g.jt(g._4())})}).strict(),tL=g.Ry({jsonrpc:g.i0("2.0")}).merge(g.Ry({method:g.Z_(),params:g.jt(tk)})).strict();async function tG(e){if(null==e)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(e).map(async e=>{let{name:t,type:a}=e;return{type:"file",mediaType:a,filename:t,url:await new Promise((t,a)=>{let r=new FileReader;r.onload=e=>{var a;t(null==(a=e.target)?void 0:a.result)},r.onerror=e=>a(e),r.readAsDataURL(e)})}}))}g.G0([tF,tL,tJ,tB]);var tX=class{constructor({api:e="/api/chat",credentials:t,headers:a,body:r,fetch:s,prepareSendMessagesRequest:o,prepareReconnectToStreamRequest:i}){this.api=e,this.credentials=t,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=o,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:e,...t}){var a,r,s,o,i;let n=await (0,h.DB)(this.body),l=await (0,h.DB)(this.headers),u=await (0,h.DB)(this.credentials),p=await (null==(a=this.prepareSendMessagesRequest)?void 0:a.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...n,...t.body},headers:{...l,...t.headers},credentials:u,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),d=null!=(r=null==p?void 0:p.api)?r:this.api,c=(null==p?void 0:p.headers)!==void 0?p.headers:{...l,...t.headers},m=(null==p?void 0:p.body)!==void 0?p.body:{...n,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},f=null!=(s=null==p?void 0:p.credentials)?s:u,y=null!=(o=this.fetch)?o:globalThis.fetch,g=await y(d,{method:"POST",headers:{"Content-Type":"application/json",...c},body:JSON.stringify(m),credentials:f,signal:e});if(!g.ok)throw Error(null!=(i=await g.text())?i:"Failed to fetch the chat response.");if(!g.body)throw Error("The response body is empty.");return this.processResponseStream(g.body)}async reconnectToStream(e){var t,a,r,s,o;let i=await (0,h.DB)(this.body),n=await (0,h.DB)(this.headers),l=await (0,h.DB)(this.credentials),u=await (null==(t=this.prepareReconnectToStreamRequest)?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...i,...e.body},headers:{...n,...e.headers},credentials:l,requestMetadata:e.metadata})),p=null!=(a=null==u?void 0:u.api)?a:`${this.api}/${e.chatId}/stream`,d=(null==u?void 0:u.headers)!==void 0?u.headers:{...n,...e.headers},c=null!=(r=null==u?void 0:u.credentials)?r:l,m=null!=(s=this.fetch)?s:globalThis.fetch,f=await m(p,{method:"GET",headers:d,credentials:c});if(204===f.status)return null;if(!f.ok)throw Error(null!=(o=await f.text())?o:"Failed to fetch the chat response.");if(!f.body)throw Error("The response body is empty.");return this.processResponseStream(f.body)}},tW=class extends tX{constructor(e={}){super(e)}processResponseStream(e){return(0,h.RF)({stream:e,schema:ta}).pipeThrough(new TransformStream({async transform(e,t){if(!e.success)throw e.error;t.enqueue(e.value)}}))}},tV=class{constructor({generateId:e=h.Ox,id:t=e(),transport:a=new tW,messageMetadataSchema:r,dataPartSchemas:s,state:o,onError:i,onToolCall:n,onFinish:l,onData:u,sendAutomaticallyWhen:p}){this.activeResponse=void 0,this.jobExecutor=new tT,this.sendMessage=async(e,t)=>{var a,r,s,o;let i;if(null==e){await this.makeRequest({trigger:"submit-message",messageId:null==(a=this.lastMessage)?void 0:a.id,...t});return}if(i="text"in e||"files"in e?{parts:[...Array.isArray(e.files)?e.files:await tG(e.files),..."text"in e&&null!=e.text?[{type:"text",text:e.text}]:[]]}:e,null!=e.messageId){let t=this.state.messages.findIndex(t=>t.id===e.messageId);if(-1===t)throw Error(`message with id ${e.messageId} not found`);if("user"!==this.state.messages[t].role)throw Error(`message with id ${e.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,t+1),this.state.replaceMessage(t,{...i,id:e.messageId,role:null!=(r=i.role)?r:"user",metadata:e.metadata})}else this.state.pushMessage({...i,id:null!=(s=i.id)?s:this.generateId(),role:null!=(o=i.role)?o:"user",metadata:e.metadata});await this.makeRequest({trigger:"submit-message",messageId:e.messageId,...t})},this.regenerate=async({messageId:e,...t}={})=>{let a=null==e?this.state.messages.length-1:this.state.messages.findIndex(t=>t.id===e);if(-1===a)throw Error(`message ${e} not found`);this.state.messages=this.state.messages.slice(0,"assistant"===this.messages[a].role?a:a+1),await this.makeRequest({trigger:"regenerate-message",messageId:e,...t})},this.resumeStream=async(e={})=>{await this.makeRequest({trigger:"resume-stream",...e})},this.clearError=()=>{"error"===this.status&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolResult=async({tool:e,toolCallId:t,output:a})=>this.jobExecutor.run(async()=>{var e,r;let s=this.state.messages,o=s[s.length-1];this.state.replaceMessage(s.length-1,{...o,parts:o.parts.map(e=>to(e)&&e.toolCallId===t?{...e,state:"output-available",output:a}:e)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(e=>to(e)&&e.toolCallId===t?{...e,state:"output-available",output:a,errorText:void 0}:e)),"streaming"!==this.status&&"submitted"!==this.status&&(null==(e=this.sendAutomaticallyWhen)?void 0:e.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:null==(r=this.lastMessage)?void 0:r.id})}),this.stop=async()=>{var e;("streaming"===this.status||"submitted"===this.status)&&(null==(e=this.activeResponse)?void 0:e.abortController)&&this.activeResponse.abortController.abort()},this.id=t,this.transport=a,this.generateId=e,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=o,this.onError=i,this.onToolCall=n,this.onFinish=l,this.onData=u,this.sendAutomaticallyWhen=p}get status(){return this.state.status}setStatus({status:e,error:t}){this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async makeRequest({trigger:e,metadata:t,headers:a,body:r,messageId:s}){var o,i,n;this.setStatus({status:"submitted",error:void 0});let l=this.lastMessage,u=!1,p=!1,d=!1;try{let o;let i={state:tn({lastMessage:this.state.snapshot(l),messageId:this.generateId()}),abortController:new AbortController};if(i.abortController.signal.addEventListener("abort",()=>{u=!0}),this.activeResponse=i,"resume-stream"===e){let e=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:a,body:r});if(null==e){this.setStatus({status:"ready"});return}o=e}else o=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:i.abortController.signal,metadata:t,headers:a,body:r,trigger:e,messageId:s});await td({stream:tl({stream:o,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:e=>this.jobExecutor.run(()=>e({state:i.state,write:()=>{var e;this.setStatus({status:"streaming"}),i.state.message.id===(null==(e=this.lastMessage)?void 0:e.id)?this.state.replaceMessage(this.state.messages.length-1,i.state.message):this.state.pushMessage(i.state.message)}})),onError:e=>{throw e}}),onError:e=>{throw e}}),this.setStatus({status:"ready"})}catch(e){if(u||"AbortError"===e.name)return u=!0,this.setStatus({status:"ready"}),null;d=!0,e instanceof TypeError&&(e.message.toLowerCase().includes("fetch")||e.message.toLowerCase().includes("network"))&&(p=!0),this.onError&&e instanceof Error&&this.onError(e),this.setStatus({status:"error",error:e})}finally{try{null==(o=this.onFinish)||o.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:u,isDisconnect:p,isError:d})}catch(e){console.error(e)}this.activeResponse=void 0}(null==(i=this.sendAutomaticallyWhen)?void 0:i.call(this,{messages:this.state.messages}))&&await this.makeRequest({trigger:"submit-message",messageId:null==(n=this.lastMessage)?void 0:n.id,metadata:t,headers:a,body:r})}};function tK(e,t){let a=[];for(let r of((null==t?void 0:t.ignoreIncompleteToolCalls)&&(e=e.map(e=>({...e,parts:e.parts.filter(e=>!to(e)||"input-streaming"!==e.state&&"input-available"!==e.state)}))),e))switch(r.role){case"system":{let e=r.parts.filter(e=>"text"===e.type),t=e.reduce((e,t)=>null!=t.providerMetadata?{...e,...t.providerMetadata}:e,{});a.push({role:"system",content:e.map(e=>e.text).join(""),...Object.keys(t).length>0?{providerOptions:t}:{}});break}case"user":a.push({role:"user",content:r.parts.filter(e=>"text"===e.type||"file"===e.type).map(e=>{switch(e.type){case"text":return{type:"text",text:e.text,...null!=e.providerMetadata?{providerOptions:e.providerMetadata}:{}};case"file":return{type:"file",mediaType:e.mediaType,filename:e.filename,data:e.url,...null!=e.providerMetadata?{providerOptions:e.providerMetadata}:{}};default:return e}})});break;case"assistant":if(null!=r.parts){let e=function(){var e,r;if(0===s.length)return;let o=[];for(let a of s)if("text"===a.type)o.push({type:"text",text:a.text,...null!=a.providerMetadata?{providerOptions:a.providerMetadata}:{}});else if("file"===a.type)o.push({type:"file",mediaType:a.mediaType,filename:a.filename,data:a.url});else if("reasoning"===a.type)o.push({type:"reasoning",text:a.text,providerOptions:a.providerMetadata});else if("dynamic-tool"===a.type){let e=a.toolName;"input-streaming"!==a.state&&o.push({type:"tool-call",toolCallId:a.toolCallId,toolName:e,input:a.input,...null!=a.callProviderMetadata?{providerOptions:a.callProviderMetadata}:{}})}else if(ts(a)){let s=ti(a);"input-streaming"!==a.state&&(o.push({type:"tool-call",toolCallId:a.toolCallId,toolName:s,input:"output-error"===a.state?null!=(e=a.input)?e:a.rawInput:a.input,providerExecuted:a.providerExecuted,...null!=a.callProviderMetadata?{providerOptions:a.callProviderMetadata}:{}}),!0===a.providerExecuted&&("output-available"===a.state||"output-error"===a.state)&&o.push({type:"tool-result",toolCallId:a.toolCallId,toolName:s,output:e6({output:"output-error"===a.state?a.errorText:a.output,tool:null==(r=null==t?void 0:t.tools)?void 0:r[s],errorMode:"output-error"===a.state?"json":"none"})}))}else throw Error(`Unsupported part: ${a}`);a.push({role:"assistant",content:o});let i=s.filter(e=>ts(e)&&!0!==e.providerExecuted||"dynamic-tool"===e.type);i.length>0&&a.push({role:"tool",content:i.map(e=>{var a;switch(e.state){case"output-error":case"output-available":{let r="dynamic-tool"===e.type?e.toolName:ti(e);return{type:"tool-result",toolCallId:e.toolCallId,toolName:r,output:e6({output:"output-error"===e.state?e.errorText:e.output,tool:null==(a=null==t?void 0:t.tools)?void 0:a[r],errorMode:"output-error"===e.state?"text":"none"})}}default:return null}}).filter(e=>null!=e)}),s=[]},s=[];for(let t of r.parts)"text"===t.type||"reasoning"===t.type||"file"===t.type||"dynamic-tool"===t.type||ts(t)?s.push(t):"step-start"===t.type&&e();e()}break;default:{let e=r.role;throw new es({originalMessage:r,message:`Unsupported role: ${e}`})}}return a}var tY=g.Ry({type:g.i0("text"),text:g.Z_(),state:g.Km(["streaming","done"]).optional(),providerMetadata:eE.optional()}),tz=g.Ry({type:g.i0("reasoning"),text:g.Z_(),state:g.Km(["streaming","done"]).optional(),providerMetadata:eE.optional()}),tQ=g.Ry({type:g.i0("source-url"),sourceId:g.Z_(),url:g.Z_(),title:g.Z_().optional(),providerMetadata:eE.optional()}),tH=g.Ry({type:g.i0("source-document"),sourceId:g.Z_(),mediaType:g.Z_(),title:g.Z_(),filename:g.Z_().optional(),providerMetadata:eE.optional()}),t0=g.Ry({type:g.i0("file"),mediaType:g.Z_(),filename:g.Z_().optional(),url:g.Z_(),providerMetadata:eE.optional()}),t1=g.Ry({type:g.i0("step-start")}),t7=g.Ry({type:g.Z_().startsWith("data-"),id:g.Z_().optional(),data:g._4()}),t4=[g.Ry({type:g.i0("dynamic-tool"),toolName:g.Z_(),toolCallId:g.Z_(),state:g.i0("input-streaming"),input:g._4().optional(),output:g.Fi().optional(),errorText:g.Fi().optional()}),g.Ry({type:g.i0("dynamic-tool"),toolName:g.Z_(),toolCallId:g.Z_(),state:g.i0("input-available"),input:g._4(),output:g.Fi().optional(),errorText:g.Fi().optional(),callProviderMetadata:eE.optional()}),g.Ry({type:g.i0("dynamic-tool"),toolName:g.Z_(),toolCallId:g.Z_(),state:g.i0("output-available"),input:g._4(),output:g._4(),errorText:g.Fi().optional(),callProviderMetadata:eE.optional(),preliminary:g.O7().optional()}),g.Ry({type:g.i0("dynamic-tool"),toolName:g.Z_(),toolCallId:g.Z_(),state:g.i0("output-error"),input:g._4(),output:g.Fi().optional(),errorText:g.Z_(),callProviderMetadata:eE.optional()})],t2=[g.Ry({type:g.Z_().startsWith("tool-"),toolCallId:g.Z_(),state:g.i0("input-streaming"),input:g._4().optional(),output:g.Fi().optional(),errorText:g.Fi().optional()}),g.Ry({type:g.Z_().startsWith("tool-"),toolCallId:g.Z_(),state:g.i0("input-available"),input:g._4(),output:g.Fi().optional(),errorText:g.Fi().optional(),callProviderMetadata:eE.optional()}),g.Ry({type:g.Z_().startsWith("tool-"),toolCallId:g.Z_(),state:g.i0("output-available"),input:g._4(),output:g._4(),errorText:g.Fi().optional(),callProviderMetadata:eE.optional(),preliminary:g.O7().optional()}),g.Ry({type:g.Z_().startsWith("tool-"),toolCallId:g.Z_(),state:g.i0("output-error"),input:g._4(),output:g.Fi().optional(),errorText:g.Z_(),callProviderMetadata:eE.optional()})];function t6({execute:e,onError:t=h.e$,originalMessages:a,onFinish:r,generateId:s=h.Ox}){let o;let i=[],n=new ReadableStream({start(e){o=e}});function l(e){try{o.enqueue(e)}catch(e){}}try{let a=e({writer:{write(e){l(e)},merge(e){i.push((async()=>{let t=e.getReader();for(;;){let{done:e,value:a}=await t.read();if(e)break;l(a)}})().catch(e=>{l({type:"error",errorText:t(e)})}))},onError:t}});a&&i.push(a.catch(e=>{l({type:"error",errorText:t(e)})}))}catch(e){l({type:"error",errorText:t(e)})}return new Promise(async e=>{for(;i.length>0;)await i.shift();e()}).finally(()=>{try{o.close()}catch(e){}}),tu({stream:n,messageId:s(),originalMessages:a,onFinish:r,onError:t})}g.Ry({id:g.Z_(),role:g.Km(["system","user","assistant"]),metadata:g._4().optional(),parts:g.IX(g.G0([tY,tz,tQ,tH,t0,t1,t7,...t4,...t2]))})}}]);